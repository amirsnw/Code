/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, forwardRef, Input, ViewChild } from '@angular/core';
import { TaminDataGridComponent } from '../../tamin-data-grid/tamin-data-grid.component';
import { FieldBaseComponent } from '../../../base/field-base.component';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { TaminDataGridConfiguration } from '../../../helpers/tamin.data.grid.configuration/tamin.data.grid.configuration';
import { PickerContainerComponent } from '../../containers/picker-container/picker-container.component';
import { SearchOperator } from '../../../models/search-param.model';
export class TaminFieldComboBoxComponent extends FieldBaseComponent {
    constructor() {
        super(...arguments);
        this.searchOperatorType = SearchOperator.EQUAL;
    }
    /**
     * @return {?}
     */
    initializeComponent() {
        this.initializeGrid();
        this.picker.parent = this.inputElement;
        this.picker.button = this.iconElement;
        if (this.casecadeControlName) {
            this.parent = this.controlContainer.control.get(this.casecadeControlName);
            this.subscription.add(this.parent.valueChanges.subscribe((/**
             * @param {?} value
             * @return {?}
             */
            value => {
                this.parentValue = value;
            })));
        }
    }
    /**
     * @private
     * @return {?}
     */
    initializeGrid() {
        this.theGrid.configuration = this.dataGridConfiguration;
        this.theGrid.loadDataOnInit = false;
    }
    /**
     * @return {?}
     */
    onClearContent() {
        this.onChange('');
        this.inputElement.nativeElement.value = '';
        this.picker.hide();
    }
    /**
     * @return {?}
     */
    onShowPicker() {
        this.picker.toggle();
        this.theGrid.refreshData();
    }
    /**
     * @param {?} val
     * @return {?}
     */
    onItemSelected(val) {
        if (!val) {
            this.onChange('');
            this.hidePopup();
            return;
        }
        /** @type {?} */
        const displayField = this.deepFind(val, this.displayField);
        /** @type {?} */
        const valueField = this.deepFind(val, this.valueField);
        if (!displayField || !valueField) {
            this.inputElement.nativeElement.value = '';
            this.onChange('');
            return;
        }
        this.inputElement.nativeElement.value = displayField;
        this.onChange(valueField);
        this.hidePopup();
    }
    /**
     * @return {?}
     */
    hidePopup() {
        this.picker.hide();
    }
    /**
     * @return {?}
     */
    showPopup() {
        this.picker.show();
        if (this.parentValue && this.parentValue !== '') {
            /** @type {?} */
            const tmp = this.theGrid.searchParams.find((/**
             * @param {?} c
             * @return {?}
             */
            c => c.property === this.parentValue));
            if (tmp) {
                this.theGrid.searchParams = this.theGrid.searchParams.filter((/**
                 * @param {?} obj
                 * @return {?}
                 */
                obj => obj !== tmp));
            }
            this.theGrid.searchParams.push({
                property: this.casecadeControlFieldName,
                value: this.parentValue,
                operator: this.searchOperatorType
            });
        }
        this.theGrid.refreshData();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        // const theValue = value == null ? '' : value;
        // if (theValue !== '') {
        //   this.loadData(theValue);
        // }
        /** @type {?} */
        const theValue = value == null ? '' : value;
        if (theValue !== '') {
            this.loadData(theValue);
        }
        else {
            this.inputElement.nativeElement.value = '';
        }
    }
    /**
     * @private
     * @param {?} theValue
     * @return {?}
     */
    loadData(theValue) {
        /** @type {?} */
        const theUrl = this.dataGridConfiguration.serviceUrl;
        /** @type {?} */
        const id = this.dataGridConfiguration.id;
        /** @type {?} */
        const searchParam = [
            {
                property: id,
                value: theValue,
                operator: this.searchOperatorType
            }
        ];
        if (this.parentValue && this.parentValue !== '') {
            searchParam.push({
                property: this.casecadeControlFieldName,
                value: this.parentValue,
                operator: this.searchOperatorType
            });
        }
        this.startWaiting();
        this.restService
            .getAll(theUrl, searchParam)
            .then((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            this.stopWaiting();
            if (value.data.list.length === 0) {
                this.onChange('');
            }
            this.onItemSelected(value.data.list[0]);
            this.theGrid.dataItems = [];
            this.theGrid.dataItems.push(value.data.list[0]);
        }))
            .catch((/**
         * @param {?} reason
         * @return {?}
         */
        reason => {
            this.stopWaiting();
            this.onChange('');
        }));
    }
}
TaminFieldComboBoxComponent.decorators = [
    { type: Component, args: [{
                selector: 'tamin-field-combo-box',
                template: "<div class=\"input-wrapper\">\n  <input\n    id=\"textbox\"\n    readonly=\"readonly\"\n    [disabled] = \"control.disabled\"\n    style=\"padding-left: 35px;cursor: pointer\"\n    type=\"text\"\n    class=\"tamin-form-control-input\"\n    (click)=\"onShowPicker()\"\n    [class.tamin-form-control-valid]=\"control.touched && control.valid\"\n    [class.tamin-form-control-invalid]=\"control.touched && !control.valid\"\n    #inputElement [attr.placeholder]=\"placeHolder\">\n  <span class=\"icon\" style=\"margin-left:20px\" *ngIf=\"showClearButton\" (click)=\"onClearContent()\">\n    <i\n      class=\"icon-cancel\"\n      style=\"font-size: 1.5em\"\n      [class.tamin-form-control-valid-icon]=\"control.touched && control.valid\"\n      [class.tamin-form-control-invalid-icon]=\"control.touched && !control.valid\"></i>\n  </span>\n\n  <span class=\"icon\" #icon (click)=\"onShowPicker()\">\n    <i\n      class=\"icon-down-open\"\n      style=\"font-size: 1.5em\"\n      [class.tamin-form-control-valid-icon]=\"control.touched && control.valid\"\n      [class.tamin-form-control-invalid-icon]=\"control.touched && !control.valid\"\n    ></i>\n  </span>\n</div>\n<tamin-picker-container #picker>\n  <tamin-data-grid #theGrid (itemSelect)=\"onItemSelected($event)\" [allowBreakPoints]=\"false\" [showHover]=\"true\"></tamin-data-grid>\n</tamin-picker-container>\n",
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => TaminFieldComboBoxComponent)),
                        multi: true
                    }
                ],
                styles: [".input-wrapper{position:relative}.icon{position:absolute;top:23%;left:5px;height:10px;margin-top:-5px;cursor:pointer}"]
            }] }
];
TaminFieldComboBoxComponent.propDecorators = {
    dataGridConfiguration: [{ type: Input }],
    displayField: [{ type: Input }],
    valueField: [{ type: Input }],
    casecadeControlName: [{ type: Input }],
    casecadeControlFieldName: [{ type: Input }],
    showClearButton: [{ type: Input }],
    searchOperatorType: [{ type: Input }],
    theGrid: [{ type: ViewChild, args: ['theGrid',] }],
    picker: [{ type: ViewChild, args: ['picker',] }],
    iconElement: [{ type: ViewChild, args: ['icon',] }]
};
if (false) {
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.dataGridConfiguration;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.displayField;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.valueField;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.casecadeControlName;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.casecadeControlFieldName;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.showClearButton;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.searchOperatorType;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.theGrid;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.picker;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.iconElement;
    /**
     * @type {?}
     * @private
     */
    TaminFieldComboBoxComponent.prototype.parent;
    /**
     * @type {?}
     * @private
     */
    TaminFieldComboBoxComponent.prototype.parentValue;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFtaW4tZmllbGQtY29tYm8tYm94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RhbWluLWZyYW1ld29yay8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpZWxkcy90YW1pbi1maWVsZC1jb21iby1ib3gvdGFtaW4tZmllbGQtY29tYm8tYm94LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFDLHNCQUFzQixFQUFDLE1BQU0saURBQWlELENBQUM7QUFDdkYsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0sb0NBQW9DLENBQUM7QUFDdEUsT0FBTyxFQUFrQixpQkFBaUIsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2xFLE9BQU8sRUFBQywwQkFBMEIsRUFBQyxNQUFNLDhFQUE4RSxDQUFDO0FBQ3hILE9BQU8sRUFBQyx3QkFBd0IsRUFBQyxNQUFNLDhEQUE4RCxDQUFDO0FBQ3RHLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSxvQ0FBb0MsQ0FBQztBQWNsRSxNQUFNLE9BQU8sMkJBQTRCLFNBQVEsa0JBQWtCO0lBWm5FOztRQW1CVyx1QkFBa0IsR0FBbUIsY0FBYyxDQUFDLEtBQUssQ0FBQztJQStIckUsQ0FBQzs7OztJQXZIQyxtQkFBbUI7UUFDakIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDdkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUN0QyxJQUFJLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtZQUM1QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFP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QUFzRDs7SUFDdEQsNkNBQXNEOztJQUN0RCxrREFBMkM7Ozs7O0lBQzNDLDZDQUFnQzs7Ozs7SUFDaEMsa0RBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEVsZW1lbnRSZWYsIGZvcndhcmRSZWYsIElucHV0LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtUYW1pbkRhdGFHcmlkQ29tcG9uZW50fSBmcm9tICcuLi8uLi90YW1pbi1kYXRhLWdyaWQvdGFtaW4tZGF0YS1ncmlkLmNvbXBvbmVudCc7XG5pbXBvcnQge0ZpZWxkQmFzZUNvbXBvbmVudH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9maWVsZC1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQge0Fic3RyYWN0Q29udHJvbCwgTkdfVkFMVUVfQUNDRVNTT1J9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7VGFtaW5EYXRhR3JpZENvbmZpZ3VyYXRpb259IGZyb20gJy4uLy4uLy4uL2hlbHBlcnMvdGFtaW4uZGF0YS5ncmlkLmNvbmZpZ3VyYXRpb24vdGFtaW4uZGF0YS5ncmlkLmNvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IHtQaWNrZXJDb250YWluZXJDb21wb25lbnR9IGZyb20gJy4uLy4uL2NvbnRhaW5lcnMvcGlja2VyLWNvbnRhaW5lci9waWNrZXItY29udGFpbmVyLmNvbXBvbmVudCc7XG5pbXBvcnQge1NlYXJjaE9wZXJhdG9yfSBmcm9tICcuLi8uLi8uLi9tb2RlbHMvc2VhcmNoLXBhcmFtLm1vZGVsJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGFtaW4tZmllbGQtY29tYm8tYm94JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RhbWluLWZpZWxkLWNvbWJvLWJveC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RhbWluLWZpZWxkLWNvbWJvLWJveC5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFRhbWluRmllbGRDb21ib0JveENvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZVxuICAgIH1cbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBUYW1pbkZpZWxkQ29tYm9Cb3hDb21wb25lbnQgZXh0ZW5kcyBGaWVsZEJhc2VDb21wb25lbnQge1xuICBASW5wdXQoKSBkYXRhR3JpZENvbmZpZ3VyYXRpb246IFRhbWluRGF0YUdyaWRDb25maWd1cmF0aW9uO1xuICBASW5wdXQoKSBkaXNwbGF5RmllbGQ6IHN0cmluZztcbiAgQElucHV0KCkgdmFsdWVGaWVsZDogc3RyaW5nO1xuICBASW5wdXQoKSBjYXNlY2FkZUNvbnRyb2xOYW1lOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGNhc2VjYWRlQ29udHJvbEZpZWxkTmFtZTogc3RyaW5nO1xuICBASW5wdXQoKSBzaG93Q2xlYXJCdXR0b246IGJvb2xlYW47XG4gIEBJbnB1dCgpIHNlYXJjaE9wZXJhdG9yVHlwZTogU2VhcmNoT3BlcmF0b3IgPSBTZWFyY2hPcGVyYXRvci5FUVVBTDtcbiAgQFZpZXdDaGlsZCgndGhlR3JpZCcpIHRoZUdyaWQ6IFRhbWluRGF0YUdyaWRDb21wb25lbnQ7XG4gIEBWaWV3Q2hpbGQoJ3BpY2tlcicpIHBpY2tlcjogUGlja2VyQ29udGFpbmVyQ29tcG9uZW50O1xuICBAVmlld0NoaWxkKCdpY29uJykgaWNvbkVsZW1lbnQ6IEVsZW1lbnRSZWY7XG4gIHByaXZhdGUgcGFyZW50OiBBYnN0cmFjdENvbnRyb2w7XG4gIHByaXZhdGUgcGFyZW50VmFsdWU6IHN0cmluZztcblxuXG4gIGluaXRpYWxpemVDb21wb25lbnQoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplR3JpZCgpO1xuICAgIHRoaXMucGlja2VyLnBhcmVudCA9IHRoaXMuaW5wdXRFbGVtZW50O1xuICAgIHRoaXMucGlja2VyLmJ1dHRvbiA9IHRoaXMuaWNvbkVsZW1lbnQ7XG4gICAgaWYgKHRoaXMuY2FzZWNhZGVDb250cm9sTmFtZSkge1xuICAgICAgdGhpcy5wYXJlbnQgPSB0aGlzLmNvbnRyb2xDb250YWluZXIuY29udHJvbC5nZXQodGhpcy5jYXNlY2FkZUNvbnRyb2xOYW1lKTtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLmFkZCh0aGlzLnBhcmVudC52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgICAgdGhpcy5wYXJlbnRWYWx1ZSA9IHZhbHVlO1xuICAgICAgfSkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZUdyaWQoKSB7XG4gICAgdGhpcy50aGVHcmlkLmNvbmZpZ3VyYXRpb24gPSB0aGlzLmRhdGFHcmlkQ29uZmlndXJhdGlvbjtcbiAgICB0aGlzLnRoZUdyaWQubG9hZERhdGFPbkluaXQgPSBmYWxzZTtcbiAgfVxuXG4gIG9uQ2xlYXJDb250ZW50KCkge1xuICAgIHRoaXMub25DaGFuZ2UoJycpO1xuICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSAnJztcbiAgICB0aGlzLnBpY2tlci5oaWRlKCk7XG4gIH1cblxuXG4gIG9uU2hvd1BpY2tlcigpIHtcbiAgICB0aGlzLnBpY2tlci50b2dnbGUoKTtcbiAgICB0aGlzLnRoZUdyaWQucmVmcmVzaERhdGEoKTtcbiAgfVxuXG4gIG9uSXRlbVNlbGVjdGVkKHZhbDogYW55KSB7XG4gICAgaWYgKCF2YWwpIHtcbiAgICAgIHRoaXMub25DaGFuZ2UoJycpO1xuICAgICAgdGhpcy5oaWRlUG9wdXAoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZGlzcGxheUZpZWxkID0gdGhpcy5kZWVwRmluZCh2YWwsIHRoaXMuZGlzcGxheUZpZWxkKTtcbiAgICBjb25zdCB2YWx1ZUZpZWxkID0gdGhpcy5kZWVwRmluZCh2YWwsIHRoaXMudmFsdWVGaWVsZCk7XG4gICAgaWYgKCFkaXNwbGF5RmllbGQgfHwgIXZhbHVlRmllbGQpIHtcbiAgICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSAnJztcbiAgICAgIHRoaXMub25DaGFuZ2UoJycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlID0gZGlzcGxheUZpZWxkO1xuICAgIHRoaXMub25DaGFuZ2UodmFsdWVGaWVsZCk7XG4gICAgdGhpcy5oaWRlUG9wdXAoKTtcbiAgfVxuXG4gIGhpZGVQb3B1cCgpIHtcbiAgICB0aGlzLnBpY2tlci5oaWRlKCk7XG4gIH1cblxuICBzaG93UG9wdXAoKSB7XG4gICAgdGhpcy5waWNrZXIuc2hvdygpO1xuICAgIGlmICh0aGlzLnBhcmVudFZhbHVlICYmIHRoaXMucGFyZW50VmFsdWUgIT09ICcnKSB7XG4gICAgICBjb25zdCB0bXAgPSB0aGlzLnRoZUdyaWQuc2VhcmNoUGFyYW1zLmZpbmQoYyA9PiBjLnByb3BlcnR5ID09PSB0aGlzLnBhcmVudFZhbHVlKTtcbiAgICAgIGlmICh0bXApIHtcbiAgICAgICAgdGhpcy50aGVHcmlkLnNlYXJjaFBhcmFtcyA9IHRoaXMudGhlR3JpZC5zZWFyY2hQYXJhbXMuZmlsdGVyKG9iaiA9PiBvYmogIT09IHRtcCk7XG4gICAgICB9XG4gICAgICB0aGlzLnRoZUdyaWQuc2VhcmNoUGFyYW1zLnB1c2goe1xuICAgICAgICBwcm9wZXJ0eTogdGhpcy5jYXNlY2FkZUNvbnRyb2xGaWVsZE5hbWUsXG4gICAgICAgIHZhbHVlOiB0aGlzLnBhcmVudFZhbHVlLFxuICAgICAgICBvcGVyYXRvcjogdGhpcy5zZWFyY2hPcGVyYXRvclR5cGVcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMudGhlR3JpZC5yZWZyZXNoRGF0YSgpO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgLy8gY29uc3QgdGhlVmFsdWUgPSB2YWx1ZSA9PSBudWxsID8gJycgOiB2YWx1ZTtcbiAgICAvLyBpZiAodGhlVmFsdWUgIT09ICcnKSB7XG4gICAgLy8gICB0aGlzLmxvYWREYXRhKHRoZVZhbHVlKTtcbiAgICAvLyB9XG4gICAgY29uc3QgdGhlVmFsdWUgPSB2YWx1ZSA9PSBudWxsID8gJycgOiB2YWx1ZTtcbiAgICBpZiAodGhlVmFsdWUgIT09ICcnKSB7XG4gICAgICB0aGlzLmxvYWREYXRhKHRoZVZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZSA9ICcnO1xuICAgIH1cblxuICB9XG5cblxuICBwcml2YXRlIGxvYWREYXRhKHRoZVZhbHVlKSB7XG4gICAgY29uc3QgdGhlVXJsID0gdGhpcy5kYXRhR3JpZENvbmZpZ3VyYXRpb24uc2VydmljZVVybDtcbiAgICBjb25zdCBpZCA9IHRoaXMuZGF0YUdyaWRDb25maWd1cmF0aW9uLmlkO1xuICAgIGNvbnN0IHNlYXJjaFBhcmFtID0gW1xuICAgICAge1xuICAgICAgICBwcm9wZXJ0eTogaWQsXG4gICAgICAgIHZhbHVlOiB0aGVWYWx1ZSxcbiAgICAgICAgb3BlcmF0b3I6IHRoaXMuc2VhcmNoT3BlcmF0b3JUeXBlXG4gICAgICB9XG4gICAgXTtcblxuICAgIGlmICh0aGlzLnBhcmVudFZhbHVlICYmIHRoaXMucGFyZW50VmFsdWUgIT09ICcnKSB7XG4gICAgICBzZWFyY2hQYXJhbS5wdXNoKHtcbiAgICAgICAgcHJvcGVydHk6IHRoaXMuY2FzZWNhZGVDb250cm9sRmllbGROYW1lLFxuICAgICAgICB2YWx1ZTogdGhpcy5wYXJlbnRWYWx1ZSxcbiAgICAgICAgb3BlcmF0b3I6IHRoaXMuc2VhcmNoT3BlcmF0b3JUeXBlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLnN0YXJ0V2FpdGluZygpO1xuICAgIHRoaXMucmVzdFNlcnZpY2VcbiAgICAgIC5nZXRBbGwodGhlVXJsLCBzZWFyY2hQYXJhbSlcbiAgICAgIC50aGVuKHZhbHVlID0+IHtcbiAgICAgICAgdGhpcy5zdG9wV2FpdGluZygpO1xuICAgICAgICBpZiAodmFsdWUuZGF0YS5saXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMub25DaGFuZ2UoJycpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub25JdGVtU2VsZWN0ZWQodmFsdWUuZGF0YS5saXN0WzBdKTtcbiAgICAgICAgdGhpcy50aGVHcmlkLmRhdGFJdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLnRoZUdyaWQuZGF0YUl0ZW1zLnB1c2godmFsdWUuZGF0YS5saXN0WzBdKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2gocmVhc29uID0+IHtcbiAgICAgICAgdGhpcy5zdG9wV2FpdGluZygpO1xuICAgICAgICB0aGlzLm9uQ2hhbmdlKCcnKTtcbiAgICAgIH0pO1xuICB9XG59XG4iXX0=