/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
var TaminImageUploadComponent = /** @class */ (function () {
    function TaminImageUploadComponent(http) {
        this.http = http;
        this.onImageUploaded = new EventEmitter();
        this.onImageDeleted = new EventEmitter();
        this.displayPreview = 'none';
    }
    Object.defineProperty(TaminImageUploadComponent.prototype, "imageGuid", {
        get: /**
         * @return {?}
         */
        function () {
            return this._imageGuid;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (!value) {
                return;
            }
            this._imageGuid = value;
            this.loadImage(this._imageGuid);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    TaminImageUploadComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} imageGuid
     * @return {?}
     */
    TaminImageUploadComponent.prototype.loadImage = /**
     * @param {?} imageGuid
     * @return {?}
     */
    function (imageGuid) {
        var _this = this;
        this._imageGuid = imageGuid;
        /** @type {?} */
        var url = this.restUrl + "/" + this.imageGuid;
        /** @type {?} */
        var image = this.previewImage.nativeElement;
        this.http.get(url)
            .toPromise()
            .then((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            image.src = "data:image/jpeg;base64," + ((/** @type {?} */ (value))).data;
            _this.displayPreview = 'unset';
        }))
            .catch((/**
         * @param {?} reason
         * @return {?}
         */
        function (reason) {
            console.error(reason);
        }));
    };
    // loadImage(imageGuid: string) {
    //   this.imageGuid = imageGuid;
    //   let url = `${this.restUrl}/${this.imageGuid}`;
    //   let headers = new HttpHeaders({ 'Content-Type': 'image/jpg' });
    //   let params = new HttpParams();
    //   params.append('responseType', 'blob');
    //   params = params.append('_dc', (new Date()).getTime().toString());
    //   let image = this.previewImage.nativeElement;
    //   this.http.get(url, { headers,  params }).subscribe(
    //       data => {
    //         //let blob = new Blob([data.arrayBuffer()], { type: data.headers.get('Content-Type') });
    //         let imageurl = window.URL.createObjectURL(data);
    //         image.src = imageurl;
    //         // image.src = 'data:image/jpeg;base64,' + data.arrayBuffer();
    //         // this.onImageUploaded.emit(this.imageGuid);
    //         this.displayPreview = "unset";
    //       },
    //       error => {
    //        // console.log(error);
    //         this.imageGuid = '';
    //       }
    //     );
    // }
    /*upload(event) {
      this.imageGuid = 'در حال بارگزاری';
      let inputfile = event.dataTransfer ? event.dataTransfer : event.target;
      let image = this.previewImage.nativeElement;
      let reader = new FileReader();
      reader.onload = function (e) {
        let src = (e.target as FileReader).result;
        image.src = src;
      };
      if (inputfile.files.length > 0) {
        let file: File = inputfile.files[0];
        let formData = new FormData();
        formData.append('file', file, file.name);
        //let headers = new HttpHeaders({'Content-Type': 'multipart/form-data'});
        this.http.post(this.restUrl, formData).subscribe(
          data => {
            reader.readAsDataURL(event.target.files[0]);
            this.imageGuid = data.toString();//.text();
            if (this.onImageUploaded)
              this.onImageUploaded.emit(this.imageGuid);
            this.displayPreview = 'unset';
          },
          error => {
            //console.log(error);
            this.imageGuid = '';
          }
        );
      }
    }*/
    // loadImage(imageGuid: string) {
    //   this.imageGuid = imageGuid;
    //   let url = `${this.restUrl}/${this.imageGuid}`;
    //   let headers = new HttpHeaders({ 'Content-Type': 'image/jpg' });
    //   let params = new HttpParams();
    //   params.append('responseType', 'blob');
    //   params = params.append('_dc', (new Date()).getTime().toString());
    //   let image = this.previewImage.nativeElement;
    //   this.http.get(url, { headers,  params }).subscribe(
    //       data => {
    //         //let blob = new Blob([data.arrayBuffer()], { type: data.headers.get('Content-Type') });
    //         let imageurl = window.URL.createObjectURL(data);
    //         image.src = imageurl;
    //         // image.src = 'data:image/jpeg;base64,' + data.arrayBuffer();
    //         // this.onImageUploaded.emit(this.imageGuid);
    //         this.displayPreview = "unset";
    //       },
    //       error => {
    //        // console.log(error);
    //         this.imageGuid = '';
    //       }
    //     );
    // }
    /*upload(event) {
        this.imageGuid = 'در حال بارگزاری';
        let inputfile = event.dataTransfer ? event.dataTransfer : event.target;
        let image = this.previewImage.nativeElement;
        let reader = new FileReader();
        reader.onload = function (e) {
          let src = (e.target as FileReader).result;
          image.src = src;
        };
        if (inputfile.files.length > 0) {
          let file: File = inputfile.files[0];
          let formData = new FormData();
          formData.append('file', file, file.name);
          //let headers = new HttpHeaders({'Content-Type': 'multipart/form-data'});
          this.http.post(this.restUrl, formData).subscribe(
            data => {
              reader.readAsDataURL(event.target.files[0]);
              this.imageGuid = data.toString();//.text();
              if (this.onImageUploaded)
                this.onImageUploaded.emit(this.imageGuid);
              this.displayPreview = 'unset';
            },
            error => {
              //console.log(error);
              this.imageGuid = '';
            }
          );
        }
      }*/
    /**
     * @param {?} event
     * @return {?}
     */
    TaminImageUploadComponent.prototype.upload = 
    // loadImage(imageGuid: string) {
    //   this.imageGuid = imageGuid;
    //   let url = `${this.restUrl}/${this.imageGuid}`;
    //   let headers = new HttpHeaders({ 'Content-Type': 'image/jpg' });
    //   let params = new HttpParams();
    //   params.append('responseType', 'blob');
    //   params = params.append('_dc', (new Date()).getTime().toString());
    //   let image = this.previewImage.nativeElement;
    //   this.http.get(url, { headers,  params }).subscribe(
    //       data => {
    //         //let blob = new Blob([data.arrayBuffer()], { type: data.headers.get('Content-Type') });
    //         let imageurl = window.URL.createObjectURL(data);
    //         image.src = imageurl;
    //         // image.src = 'data:image/jpeg;base64,' + data.arrayBuffer();
    //         // this.onImageUploaded.emit(this.imageGuid);
    //         this.displayPreview = "unset";
    //       },
    //       error => {
    //        // console.log(error);
    //         this.imageGuid = '';
    //       }
    //     );
    // }
    /*upload(event) {
        this.imageGuid = 'در حال بارگزاری';
        let inputfile = event.dataTransfer ? event.dataTransfer : event.target;
        let image = this.previewImage.nativeElement;
        let reader = new FileReader();
        reader.onload = function (e) {
          let src = (e.target as FileReader).result;
          image.src = src;
        };
        if (inputfile.files.length > 0) {
          let file: File = inputfile.files[0];
          let formData = new FormData();
          formData.append('file', file, file.name);
          //let headers = new HttpHeaders({'Content-Type': 'multipart/form-data'});
          this.http.post(this.restUrl, formData).subscribe(
            data => {
              reader.readAsDataURL(event.target.files[0]);
              this.imageGuid = data.toString();//.text();
              if (this.onImageUploaded)
                this.onImageUploaded.emit(this.imageGuid);
              this.displayPreview = 'unset';
            },
            error => {
              //console.log(error);
              this.imageGuid = '';
            }
          );
        }
      }*/
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        this.imageGuid = 'در حال بارگذاری';
        /** @type {?} */
        var inputfile = event.dataTransfer ? event.dataTransfer : event.target;
        /** @type {?} */
        var image = this.previewImage.nativeElement;
        /** @type {?} */
        var reader = new FileReader();
        if (inputfile.files.length > 0) {
            /** @type {?} */
            var file_1 = inputfile.files[0];
            reader.readAsDataURL(file_1);
            reader.onload = (/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var formData = new FormData();
                formData.append('file', file_1, file_1.name);
                _this.http.post(_this.restUrl, formData).toPromise()
                    .then((/**
                 * @param {?} response
                 * @return {?}
                 */
                function (response) {
                    /** @type {?} */
                    var src = reader.result;
                    image.src = src;
                    _this.imageGuid = response['guid'];
                    if (_this.onImageUploaded) {
                        _this.onImageUploaded.emit(_this.imageGuid);
                    }
                    _this.displayPreview = 'unset';
                }))
                    .catch((/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    // console.log("Upload error:", error);
                    _this.imageGuid = '';
                }));
            });
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    TaminImageUploadComponent.prototype.uploadBase64 = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        this.imageGuid = 'در حال بارگذاری';
        /** @type {?} */
        var inputfile = event.dataTransfer ? event.dataTransfer : event.target;
        /** @type {?} */
        var image = this.previewImage.nativeElement;
        /** @type {?} */
        var reader = new FileReader();
        if (inputfile.files.length > 0) {
            /** @type {?} */
            var file = inputfile.files[0];
            reader.readAsDataURL(file);
            reader.onload = (/**
             * @return {?}
             */
            function () {
                // let headers = new HttpHeaders({'Content-Type': 'text/plain'});
                /** @type {?} */
                var headers = new HttpHeaders({ 'Content-Type': 'application/json' });
                _this.http.post(_this.restUrl, ((/** @type {?} */ (reader.result))).split(',')[1], { headers: headers }).toPromise()
                    .then((/**
                 * @param {?} response
                 * @return {?}
                 */
                function (response) {
                    /** @type {?} */
                    var src = reader.result;
                    image.src = src;
                    _this.imageGuid = response['guid'];
                    if (_this.onImageUploaded) {
                        _this.onImageUploaded.emit(_this.imageGuid);
                    }
                    _this.displayPreview = 'unset';
                }))
                    .catch((/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    // console.log("Upload error:", error);
                    _this.imageGuid = '';
                }));
            });
        }
    };
    /**
     * @return {?}
     */
    TaminImageUploadComponent.prototype.removeImage = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var url = this.restUrl + "/" + this.imageGuid;
        /** @type {?} */
        var image = this.previewImage.nativeElement;
        image.src = '';
        this.onImageDeleted.emit(this.imageGuid);
        this.imageGuid = '';
        this.http.delete(url).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
        }));
    };
    TaminImageUploadComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tamin-field-image-upload',
                    template: "<div class=\"divTable\" style=\"width: 100%;\">\n  <div class=\"divTableHeading\">\n\t\t<div class=\"divTableRow\">\n\t\t\t<div class=\"divTableHead\"  style=\"width: 128px; font-size: 0.8em\">\u067E\u06CC\u0634 \u0646\u0645\u0627\u06CC\u0634</div>\n\t\t\t<div class=\"divTableHead\"  style=\"font-size: 0.8em\">\u0639\u0645\u0644\u06CC\u0627\u062A</div>\n\t\t</div>\n\t</div>\n\t<div class=\"divTableBody\">\n\t\t<div class=\"divTableRow\">\n\t\t\t<div class=\"divTableCell\">\n\t\t\t\t\t<img #previewImage alt=\"\u0628\u062F\u0648\u0646 \u062A\u0635\u0648\u06CC\u0631\" [style.display]=\"displayPreview\" style=\"width: 128px;\" />\n      </div>\n\t\t\t<div class=\"divTableCell\">\n          <label attr.for=\"{{controlName}}\" class=\"inputfile\" style=\"width: 116px; white-space: nowrap;\">\n            <label class=\"icon-upload\" style=\"margin-left: 3px; vertical-align: middle;\"></label>\n            \u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0641\u0627\u06CC\u0644\n\t\t\t\t\t</label>\n          <input type=\"file\" attr.id=\"{{controlName}}\" accept=\".jpg,.jpeg,.png\"/>\n          <br/>\n\t\t\t\t\t<button type=\"button\" class=\"button normal dark icon-trash\" (click)=\"removeImage()\">\u062D\u0630\u0641 \u062A\u0635\u0648\u06CC\u0631</button>\n          <br/>\n          <label style=\"font-size: 0.8em;\">\u0648\u0636\u0639\u06CC\u062A: {{imageGuid}} </label>\n      </div>\n\t\t</div>\n\t</div>\n  <!--<div class=\"divTableFoot\">\n\t\t<div class=\"divTableRow\">\n\t\t\t<div class=\"divTableCell\">&nbsp;</div>\n\t\t\t<div class=\"divTableCell\">&nbsp;</div>\n\t\t</div>\n\t</div>-->\n</div>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    TaminImageUploadComponent.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    TaminImageUploadComponent.propDecorators = {
        controlName: [{ type: Input }],
        onImageUploaded: [{ type: Output }],
        onImageDeleted: [{ type: Output }],
        previewImage: [{ type: ViewChild, args: ['previewImage',] }],
        restUrl: [{ type: Input }],
        imageGuid: [{ type: Input }]
    };
    return TaminImageUploadComponent;
}());
export { TaminImageUploadComponent };
if (false) {
    /** @type {?} */
    TaminImageUploadComponent.prototype.controlName;
    /**
     * @type {?}
     * @private
     */
    TaminImageUploadComponent.prototype._imageGuid;
    /** @type {?} */
    TaminImageUploadComponent.prototype.onImageUploaded;
    /** @type {?} */
    TaminImageUploadComponent.prototype.onImageDeleted;
    /** @type {?} */
    TaminImageUploadComponent.prototype.previewImage;
    /** @type {?} */
    TaminImageUploadComponent.prototype.restUrl;
    /** @type {?} */
    TaminImageUploadComponent.prototype.displayPreview;
    /**
     * @type {?}
     * @private
     */
    TaminImageUploadComponent.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFtaW4taW1hZ2UtdXBsb2FkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RhbWluLWZyYW1ld29yay8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RhbWluLWltYWdlLXVwbG9hZC90YW1pbi1pbWFnZS11cGxvYWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDcEcsT0FBTyxFQUFDLFVBQVUsRUFBRSxXQUFXLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQUU3RDtJQTBCRSxtQ0FBb0IsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQWxCMUIsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQzdDLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUd0RCxtQkFBYyxHQUFHLE1BQU0sQ0FBQztJQWV4QixDQUFDO0lBYkQsc0JBQWEsZ0RBQVM7Ozs7UUFRdEI7WUFDRSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDekIsQ0FBQzs7Ozs7UUFWRCxVQUF1QixLQUFhO1lBQ2xDLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ1YsT0FBTzthQUNSO1lBQ0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7WUFDeEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDbEMsQ0FBQzs7O09BQUE7Ozs7SUFTRCw0Q0FBUTs7O0lBQVI7SUFDQSxDQUFDOzs7OztJQUVELDZDQUFTOzs7O0lBQVQsVUFBVSxTQUFpQjtRQUEzQixpQkFhQztRQVpDLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDOztZQUN0QixHQUFHLEdBQU0sSUFBSSxDQUFDLE9BQU8sU0FBSSxJQUFJLENBQUMsU0FB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OztJQUNwRCw0Q0FBeUI7O0lBQ3pCLG1EQUF3Qjs7Ozs7SUFjWix5Q0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0h0dHBDbGllbnQsIEh0dHBIZWFkZXJzfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RhbWluLWZpZWxkLWltYWdlLXVwbG9hZCcsXG4gIHRlbXBsYXRlVXJsOiAnLi90YW1pbi1pbWFnZS11cGxvYWQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi90YW1pbi1pbWFnZS11cGxvYWQuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUYW1pbkltYWdlVXBsb2FkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCkgY29udHJvbE5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSBfaW1hZ2VHdWlkOiBzdHJpbmc7XG4gIEBPdXRwdXQoKSBvbkltYWdlVXBsb2FkZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcbiAgQE91dHB1dCgpIG9uSW1hZ2VEZWxldGVkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG4gIEBWaWV3Q2hpbGQoJ3ByZXZpZXdJbWFnZScpIHByZXZpZXdJbWFnZTogRWxlbWVudFJlZjtcbiAgQElucHV0KCkgcmVzdFVybDogc3RyaW5nO1xuICBkaXNwbGF5UHJldmlldyA9ICdub25lJztcblxuICBASW5wdXQoKSBzZXQgaW1hZ2VHdWlkKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX2ltYWdlR3VpZCA9IHZhbHVlO1xuICAgIHRoaXMubG9hZEltYWdlKHRoaXMuX2ltYWdlR3VpZCk7XG4gIH1cblxuICBnZXQgaW1hZ2VHdWlkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX2ltYWdlR3VpZDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gIH1cblxuICBsb2FkSW1hZ2UoaW1hZ2VHdWlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9pbWFnZUd1aWQgPSBpbWFnZUd1aWQ7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5yZXN0VXJsfS8ke3RoaXMuaW1hZ2VHdWlkfWA7XG4gICAgY29uc3QgaW1hZ2UgPSB0aGlzLnByZXZpZXdJbWFnZS5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbih2YWx1ZSA9PiB7XG4gICAgICAgIGltYWdlLnNyYyA9IGBkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCR7KDxhbnk+dmFsdWUpLmRhdGF9YDtcbiAgICAgICAgdGhpcy5kaXNwbGF5UHJldmlldyA9ICd1bnNldCc7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKHJlYXNvbiA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLy8gbG9hZEltYWdlKGltYWdlR3VpZDogc3RyaW5nKSB7XG4gIC8vICAgdGhpcy5pbWFnZUd1aWQgPSBpbWFnZUd1aWQ7XG4gIC8vICAgbGV0IHVybCA9IGAke3RoaXMucmVzdFVybH0vJHt0aGlzLmltYWdlR3VpZH1gO1xuICAvLyAgIGxldCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKHsgJ0NvbnRlbnQtVHlwZSc6ICdpbWFnZS9qcGcnIH0pO1xuICAvLyAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAvLyAgIHBhcmFtcy5hcHBlbmQoJ3Jlc3BvbnNlVHlwZScsICdibG9iJyk7XG4gIC8vICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnX2RjJywgKG5ldyBEYXRlKCkpLmdldFRpbWUoKS50b1N0cmluZygpKTtcbiAgLy8gICBsZXQgaW1hZ2UgPSB0aGlzLnByZXZpZXdJbWFnZS5uYXRpdmVFbGVtZW50O1xuICAvLyAgIHRoaXMuaHR0cC5nZXQodXJsLCB7IGhlYWRlcnMsICBwYXJhbXMgfSkuc3Vic2NyaWJlKFxuICAvLyAgICAgICBkYXRhID0+IHtcbiAgLy8gICAgICAgICAvL2xldCBibG9iID0gbmV3IEJsb2IoW2RhdGEuYXJyYXlCdWZmZXIoKV0sIHsgdHlwZTogZGF0YS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgfSk7XG4gIC8vICAgICAgICAgbGV0IGltYWdldXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoZGF0YSk7XG4gIC8vICAgICAgICAgaW1hZ2Uuc3JjID0gaW1hZ2V1cmw7XG4gIC8vICAgICAgICAgLy8gaW1hZ2Uuc3JjID0gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJyArIGRhdGEuYXJyYXlCdWZmZXIoKTtcbiAgLy8gICAgICAgICAvLyB0aGlzLm9uSW1hZ2VVcGxvYWRlZC5lbWl0KHRoaXMuaW1hZ2VHdWlkKTtcbiAgLy8gICAgICAgICB0aGlzLmRpc3BsYXlQcmV2aWV3ID0gXCJ1bnNldFwiO1xuICAvLyAgICAgICB9LFxuICAvLyAgICAgICBlcnJvciA9PiB7XG4gIC8vICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcik7XG4gIC8vICAgICAgICAgdGhpcy5pbWFnZUd1aWQgPSAnJztcbiAgLy8gICAgICAgfVxuICAvLyAgICAgKTtcbiAgLy8gfVxuXG4gIC8qdXBsb2FkKGV2ZW50KSB7XG4gICAgdGhpcy5pbWFnZUd1aWQgPSAn2K/YsSDYrdin2YQg2KjYp9ix2q/Ystin2LHbjCc7XG4gICAgbGV0IGlucHV0ZmlsZSA9IGV2ZW50LmRhdGFUcmFuc2ZlciA/IGV2ZW50LmRhdGFUcmFuc2ZlciA6IGV2ZW50LnRhcmdldDtcbiAgICBsZXQgaW1hZ2UgPSB0aGlzLnByZXZpZXdJbWFnZS5uYXRpdmVFbGVtZW50O1xuICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgbGV0IHNyYyA9IChlLnRhcmdldCBhcyBGaWxlUmVhZGVyKS5yZXN1bHQ7XG4gICAgICBpbWFnZS5zcmMgPSBzcmM7XG4gICAgfTtcbiAgICBpZiAoaW5wdXRmaWxlLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBmaWxlOiBGaWxlID0gaW5wdXRmaWxlLmZpbGVzWzBdO1xuICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlLCBmaWxlLm5hbWUpO1xuICAgICAgLy9sZXQgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7J0NvbnRlbnQtVHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJ30pO1xuICAgICAgdGhpcy5odHRwLnBvc3QodGhpcy5yZXN0VXJsLCBmb3JtRGF0YSkuc3Vic2NyaWJlKFxuICAgICAgICBkYXRhID0+IHtcbiAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChldmVudC50YXJnZXQuZmlsZXNbMF0pO1xuICAgICAgICAgIHRoaXMuaW1hZ2VHdWlkID0gZGF0YS50b1N0cmluZygpOy8vLnRleHQoKTtcbiAgICAgICAgICBpZiAodGhpcy5vbkltYWdlVXBsb2FkZWQpXG4gICAgICAgICAgICB0aGlzLm9uSW1hZ2VVcGxvYWRlZC5lbWl0KHRoaXMuaW1hZ2VHdWlkKTtcbiAgICAgICAgICB0aGlzLmRpc3BsYXlQcmV2aWV3ID0gJ3Vuc2V0JztcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIC8vY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgIHRoaXMuaW1hZ2VHdWlkID0gJyc7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICB9Ki9cblxuICB1cGxvYWQoZXZlbnQpIHtcbiAgICB0aGlzLmltYWdlR3VpZCA9ICfYr9ixINit2KfZhCDYqNin2LHar9iw2KfYsduMJztcbiAgICBjb25zdCBpbnB1dGZpbGUgPSBldmVudC5kYXRhVHJhbnNmZXIgPyBldmVudC5kYXRhVHJhbnNmZXIgOiBldmVudC50YXJnZXQ7XG4gICAgY29uc3QgaW1hZ2UgPSB0aGlzLnByZXZpZXdJbWFnZS5uYXRpdmVFbGVtZW50O1xuICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgaWYgKGlucHV0ZmlsZS5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBmaWxlOiBGaWxlID0gaW5wdXRmaWxlLmZpbGVzWzBdO1xuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlLCBmaWxlLm5hbWUpO1xuICAgICAgICB0aGlzLmh0dHAucG9zdCh0aGlzLnJlc3RVcmwsIGZvcm1EYXRhKS50b1Byb21pc2UoKVxuICAgICAgICAgIC50aGVuKChyZXNwb25zZTogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNyYyA9IHJlYWRlci5yZXN1bHQ7XG4gICAgICAgICAgICBpbWFnZS5zcmMgPSBzcmM7XG4gICAgICAgICAgICB0aGlzLmltYWdlR3VpZCA9IHJlc3BvbnNlWydndWlkJ107XG4gICAgICAgICAgICBpZiAodGhpcy5vbkltYWdlVXBsb2FkZWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5vbkltYWdlVXBsb2FkZWQuZW1pdCh0aGlzLmltYWdlR3VpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlQcmV2aWV3ID0gJ3Vuc2V0JztcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyb3I6IFJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiVXBsb2FkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIHRoaXMuaW1hZ2VHdWlkID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgdXBsb2FkQmFzZTY0KGV2ZW50KSB7XG4gICAgdGhpcy5pbWFnZUd1aWQgPSAn2K/YsSDYrdin2YQg2KjYp9ix2q/YsNin2LHbjCc7XG4gICAgY29uc3QgaW5wdXRmaWxlID0gZXZlbnQuZGF0YVRyYW5zZmVyID8gZXZlbnQuZGF0YVRyYW5zZmVyIDogZXZlbnQudGFyZ2V0O1xuICAgIGNvbnN0IGltYWdlID0gdGhpcy5wcmV2aWV3SW1hZ2UubmF0aXZlRWxlbWVudDtcbiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIGlmIChpbnB1dGZpbGUuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgZmlsZTogRmlsZSA9IGlucHV0ZmlsZS5maWxlc1swXTtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgLy8gbGV0IGhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoeydDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbid9KTtcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30pO1xuICAgICAgICB0aGlzLmh0dHAucG9zdCh0aGlzLnJlc3RVcmwsICg8YW55PnJlYWRlci5yZXN1bHQpLnNwbGl0KCcsJylbMV0sIHtoZWFkZXJzOiBoZWFkZXJzfSkudG9Qcm9taXNlKClcbiAgICAgICAgICAudGhlbigocmVzcG9uc2U6IFJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzcmMgPSByZWFkZXIucmVzdWx0O1xuICAgICAgICAgICAgaW1hZ2Uuc3JjID0gc3JjO1xuICAgICAgICAgICAgdGhpcy5pbWFnZUd1aWQgPSByZXNwb25zZVsnZ3VpZCddO1xuICAgICAgICAgICAgaWYgKHRoaXMub25JbWFnZVVwbG9hZGVkKSB7XG4gICAgICAgICAgICAgIHRoaXMub25JbWFnZVVwbG9hZGVkLmVtaXQodGhpcy5pbWFnZUd1aWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5UHJldmlldyA9ICd1bnNldCc7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKGVycm9yOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlVwbG9hZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB0aGlzLmltYWdlR3VpZCA9ICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZUltYWdlKCkge1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMucmVzdFVybH0vJHt0aGlzLmltYWdlR3VpZH1gO1xuICAgIGNvbnN0IGltYWdlID0gdGhpcy5wcmV2aWV3SW1hZ2UubmF0aXZlRWxlbWVudDtcbiAgICBpbWFnZS5zcmMgPSAnJztcbiAgICB0aGlzLm9uSW1hZ2VEZWxldGVkLmVtaXQodGhpcy5pbWFnZUd1aWQpO1xuICAgIHRoaXMuaW1hZ2VHdWlkID0gJyc7XG4gICAgdGhpcy5odHRwLmRlbGV0ZSh1cmwpLnN1YnNjcmliZShcbiAgICAgIGRhdGEgPT4ge1xuICAgICAgfSxcbiAgICAgIGVycm9yID0+IHtcbiAgICAgIH1cbiAgICApO1xuICB9XG59XG4iXX0=