/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, forwardRef, Input, ViewChild } from '@angular/core';
// import * as momentNs from 'jalali-moment';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { FieldBaseComponent } from '../../../base/field-base.component';
import { TaminPersianDatePickerComponent } from '../../tamin-persian-date-picker/tamin-persian-date-picker.component';
import { PickerContainerComponent } from '../../containers/picker-container/picker-container.component';
import { TaminPersianDate } from '../../../tamin-persian-date';
// const moment = momentNs;
// declare let persianDate: any;
var TaminFieldPersianDateComponent = /** @class */ (function (_super) {
    tslib_1.__extends(TaminFieldPersianDateComponent, _super);
    function TaminFieldPersianDateComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(TaminFieldPersianDateComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            // return moment.from(this.inputElement.nativeElement.value, 'fa', 'YYYY/MM/DD').toDate();
            /** @type {?} */
            var tmp = this.inputElement.nativeElement.value.split('/');
            /** @type {?} */
            var input = [Number(tmp[0]), Number(tmp[1]), Number(tmp[2]), 0, 0, 0];
            // return (new persianDate(input)).toDate();
            return (TaminPersianDate.JalaliToGregorian(Number(tmp[0]), Number(tmp[1]), Number(tmp[2])));
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            // const tmp = moment(new Date(val));
            // const tmp = new persianDate(new Date(val));
            /** @type {?} */
            var tmp = TaminPersianDate.GregorianToJalali(new Date(val));
            // this.inputElement.nativeElement.value = tmp.toLocale('en').format('YYYY/MM/DD');
            this.inputElement.nativeElement.value = tmp;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @protected
     * @param {?} val
     * @return {?}
     */
    TaminFieldPersianDateComponent.prototype.getValue = /**
     * @protected
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val.length === 8) {
            /** @type {?} */
            var yyyy = val.substr(0, 4);
            /** @type {?} */
            var mm = val.substr(4, 2);
            /** @type {?} */
            var dd = val.substr(6, 2);
            /** @type {?} */
            var input = [Number(yyyy), Number(mm), Number(dd), 0, 0, 0];
            // return (new persianDate(input)).toDate();
            return TaminPersianDate.JalaliToGregorian(Number(yyyy), Number(mm), Number(dd));
        }
        return '';
    };
    /**
     * @param {?} value
     * @return {?}
     */
    TaminFieldPersianDateComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (value === '' || value === undefined || value === null) {
                _this.inputElement.nativeElement.value = '';
                return;
            }
            // const tmp = new persianDate(new Date(value));
            /** @type {?} */
            var tmp = TaminPersianDate.GregorianToJalali(new Date(value));
            // this.inputElement.nativeElement.value = tmp.toLocale('en').format('YYYY/MM/DD'); // tmp.locale('fa').format('YYYY/MM/DD');
            _this.inputElement.nativeElement.value = tmp;
            /*
                  if (!this.maskRef) {
                    this._setInputMask();
                  }
                  this.maskRef.updateValue();
            */
            _this.maskRef.updateValue();
            _this.onChange(value);
        }), 0);
    };
    /**
     * @return {?}
     */
    TaminFieldPersianDateComponent.prototype.initializeComponent = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._setInputMask();
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.picker.parent = _this.inputElement;
            _this.picker.button = _this.iconElement;
        }), 0);
    };
    /**
     * @return {?}
     */
    TaminFieldPersianDateComponent.prototype.onShowPicker = /**
     * @return {?}
     */
    function () {
        if (this.control.disabled) {
            return;
        }
        this.inputElement.nativeElement.focus();
        this.picker.toggle();
    };
    /**
     * @return {?}
     */
    TaminFieldPersianDateComponent.prototype.hidePopup = /**
     * @return {?}
     */
    function () {
        // this.pickerVisibility = 'hidden';
        this.picker.hide();
        this.inputElement.nativeElement.readOnly = false;
    };
    /**
     * @return {?}
     */
    TaminFieldPersianDateComponent.prototype.showPopup = /**
     * @return {?}
     */
    function () {
        this.inputElement.nativeElement.readOnly = true;
        /** @type {?} */
        var val = this.inputElement.nativeElement.value;
        // const tmp = moment.from(val, 'fa', 'YYYY/MM/DD');
        /** @type {?} */
        var t = this.inputElement.nativeElement.value.split('/');
        /** @type {?} */
        var input = [Number(t[0]), Number(t[1]), Number(t[2]), 23, 0, 0];
        // const tmp = (new persianDate(input));
        /** @type {?} */
        var tmp = TaminPersianDate.JalaliToGregorian(Number(t[0]), Number(t[1]), Number(t[2]));
        // if (tmp.isValid()) {
        // this.persianDatePicker.currentDate = new Date(tmp.toDate());
        this.persianDatePicker.currentDate = tmp;
        // }
        this.persianDatePicker.setView();
        this.picker.show();
        // this._thePopper.update();
    };
    /**
     * @param {?} val
     * @return {?}
     */
    TaminFieldPersianDateComponent.prototype.onPickerChange = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val !== undefined) {
            this.inputElement.nativeElement.focus();
            this.value = val;
            this.onChange(this.value);
            this.hidePopup();
        }
    };
    /**
     * @private
     * @return {?}
     */
    TaminFieldPersianDateComponent.prototype._setInputMask = /**
     * @private
     * @return {?}
     */
    function () {
        this.maskRef = new IMask(this.inputElement.nativeElement, {
            mask: 'YYYY/MM/DD',
            blocks: {
                DD: {
                    mask: IMask.MaskedRange,
                    from: 1,
                    to: 31,
                    validate: (/**
                     * @param {?} value
                     * @param {?} masked
                     * @return {?}
                     */
                    function (value, masked) {
                        try {
                            /** @type {?} */
                            var tmp = masked.parent._value.split('/');
                            /** @type {?} */
                            var yyyy = tmp[0];
                            /** @type {?} */
                            var mm = tmp[1];
                            /** @type {?} */
                            var dd = value;
                            // let theDate;
                            // theDate = moment.from(`${yyyy}/${mm}/${dd}`, 'fa', 'YYYY/MM/DD');
                            // return theDate.isValid();
                            // const result = new persianDate([Number(yyyy), Number(mm), Number(dd), 0, 0, 0, 0]);
                            /** @type {?} */
                            var result = TaminPersianDate.JalaliToGregorian(Number(yyyy), Number(mm), Number(dd));
                            return result !== null;
                        }
                        catch (e) {
                            return false;
                        }
                    })
                },
                MM: {
                    mask: IMask.MaskedRange,
                    from: 1,
                    to: 12
                },
                YYYY: {
                    mask: IMask.MaskedRange,
                    from: 1000,
                    to: 9999
                },
            },
            placeholderLazy: false,
        });
    };
    TaminFieldPersianDateComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tamin-field-persian-date',
                    template: "<div class=\"input-wrapper\">\n  <input\n    id=\"textbox\"\n    style=\"direction: ltr; padding-left: 35px;\"\n    type=\"text\"\n    [disabled]=\"control.disabled\"\n    class=\"tamin-form-control-input\"\n    [class.tamin-form-control-valid]=\"control.touched && control.valid\"\n    [class.tamin-form-control-invalid]=\"control.touched && !control.valid\"\n    #inputElement>\n  <span class=\"icon\" #icon>\n    <i\n      class=\"icon-calendar\"\n      style=\"font-size: 1.5em\"\n      (click)=\"onShowPicker()\"\n      [class.tamin-form-control-valid-icon]=\"control.touched && control.valid\"\n      [class.tamin-form-control-invalid-icon]=\"control.touched && !control.valid\"\n      #iconElement></i>\n  </span>\n</div>\n\n\n<tamin-picker-container #picker [adjustWidth]=\"false\" placement=\"bottom-start\">\n  <tamin-persian-date-picker\n    #persianDatePicker\n    (dateChanged)=\"onPickerChange($event)\"\n    (cancel)=\"hidePopup()\">\n  </tamin-persian-date-picker>\n</tamin-picker-container>\n\n<!--<div #picker class=\"picker-container\" style=\"visibility: hidden;margin-top: 5px;margin-bottom: 5px\"-->\n<!--[style.visibility]=\"pickerVisibility\">-->\n<!--</div>-->\n\n",
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return TaminFieldPersianDateComponent; })),
                            multi: true
                        }
                    ],
                    styles: [".input-wrapper{position:relative}.icon{position:absolute;top:25%;left:5px;height:10px;margin-top:-5px;cursor:pointer}"]
                }] }
    ];
    TaminFieldPersianDateComponent.propDecorators = {
        picker: [{ type: ViewChild, args: ['picker',] }],
        persianDatePicker: [{ type: ViewChild, args: ['persianDatePicker',] }],
        iconElement: [{ type: ViewChild, args: ['icon',] }],
        value: [{ type: Input }]
    };
    return TaminFieldPersianDateComponent;
}(FieldBaseComponent));
export { TaminFieldPersianDateComponent };
if (false) {
    /** @type {?} */
    TaminFieldPersianDateComponent.prototype.picker;
    /** @type {?} */
    TaminFieldPersianDateComponent.prototype.persianDatePicker;
    /** @type {?} */
    TaminFieldPersianDateComponent.prototype.iconElement;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFtaW4tZmllbGQtcGVyc2lhbi1kYXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RhbWluLWZyYW1ld29yay8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpZWxkcy90YW1pbi1maWVsZC1wZXJzaWFuLWRhdGUvdGFtaW4tZmllbGQtcGVyc2lhbi1kYXRlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDOztBQUVsRixPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRCxPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxvQ0FBb0MsQ0FBQztBQUN0RSxPQUFPLEVBQUMsK0JBQStCLEVBQUMsTUFBTSxxRUFBcUUsQ0FBQztBQUNwSCxPQUFPLEVBQUMsd0JBQXdCLEVBQUMsTUFBTSw4REFBOEQsQ0FBQztBQUN0RyxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSw2QkFBNkIsQ0FBQzs7O0FBUTdEO0lBWW9ELDBEQUFrQjtJQVp0RTs7SUEwSkEsQ0FBQztJQXpJQyxzQkFBYSxpREFBSzs7OztRQWtEbEI7OztnQkFFUSxHQUFHLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7O2dCQUN0RCxLQUFLLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN2RSw0Q0FBNEM7WUFDNUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFD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VztvQkFDdkIsSUFBSSxFQUFFLENBQUM7b0JBQ1AsRUFBRSxFQUFFLEVBQUU7aUJBQ1A7Z0JBQ0QsSUFBSSxFQUFFO29CQUNKLElBQUksRUFBRSxLQUFLLENBQUMsV0FBVztvQkFDdkIsSUFBSSxFQUFFLElBQUk7b0JBQ1YsRUFBRSxFQUFFLElBQUk7aUJBQ1Q7YUFDRjtZQUNELGVBQWUsRUFBRSxLQUFLO1NBQ3ZCLENBQUMsQ0FBQztJQUNMLENBQUM7O2dCQXpKRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLDBCQUEwQjtvQkFDcEMsaXJDQUF3RDtvQkFFeEQsU0FBUyxFQUFFO3dCQUNUOzRCQUNFLE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLFdBQVcsRUFBRSxVQUFVOzs7NEJBQUMsY0FBTSxPQUFBLDhCQUE4QixFQUE5QixDQUE4QixFQUFDOzRCQUM3RCxLQUFLLEVBQUUsSUFBSTt5QkFDWjtxQkFDRjs7aUJBQ0Y7Ozt5QkFFRSxTQUFTLFNBQUMsUUFBUTtvQ0FDbEIsU0FBUyxTQUFDLG1CQUFtQjs4QkFDN0IsU0FBUyxTQUFDLE1BQU07d0JBRWhCLEtBQUs7O0lBeUlSLHFDQUFDO0NBQUEsQUExSkQsQ0FZb0Qsa0JBQWtCLEdBOElyRTtTQTlJWSw4QkFBOEI7OztJQUN6QyxnREFBc0Q7O0lBQ3RELDJEQUFtRjs7SUFDbkYscURBQTJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEVsZW1lbnRSZWYsIGZvcndhcmRSZWYsIElucHV0LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuLy8gaW1wb3J0ICogYXMgbW9tZW50TnMgZnJvbSAnamFsYWxpLW1vbWVudCc7XG5pbXBvcnQge05HX1ZBTFVFX0FDQ0VTU09SfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQge0ZpZWxkQmFzZUNvbXBvbmVudH0gZnJvbSAnLi4vLi4vLi4vYmFzZS9maWVsZC1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQge1RhbWluUGVyc2lhbkRhdGVQaWNrZXJDb21wb25lbnR9IGZyb20gJy4uLy4uL3RhbWluLXBlcnNpYW4tZGF0ZS1waWNrZXIvdGFtaW4tcGVyc2lhbi1kYXRlLXBpY2tlci5jb21wb25lbnQnO1xuaW1wb3J0IHtQaWNrZXJDb250YWluZXJDb21wb25lbnR9IGZyb20gJy4uLy4uL2NvbnRhaW5lcnMvcGlja2VyLWNvbnRhaW5lci9waWNrZXItY29udGFpbmVyLmNvbXBvbmVudCc7XG5pbXBvcnQge1RhbWluUGVyc2lhbkRhdGV9IGZyb20gJy4uLy4uLy4uL3RhbWluLXBlcnNpYW4tZGF0ZSc7XG5cbmRlY2xhcmUgbGV0IElNYXNrOiBhbnk7XG5cbi8vIGNvbnN0IG1vbWVudCA9IG1vbWVudE5zO1xuXG4vLyBkZWNsYXJlIGxldCBwZXJzaWFuRGF0ZTogYW55O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0YW1pbi1maWVsZC1wZXJzaWFuLWRhdGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGFtaW4tZmllbGQtcGVyc2lhbi1kYXRlLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGFtaW4tZmllbGQtcGVyc2lhbi1kYXRlLmNvbXBvbmVudC5zY3NzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gVGFtaW5GaWVsZFBlcnNpYW5EYXRlQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIFRhbWluRmllbGRQZXJzaWFuRGF0ZUNvbXBvbmVudCBleHRlbmRzIEZpZWxkQmFzZUNvbXBvbmVudCB7XG4gIEBWaWV3Q2hpbGQoJ3BpY2tlcicpIHBpY2tlcjogUGlja2VyQ29udGFpbmVyQ29tcG9uZW50O1xuICBAVmlld0NoaWxkKCdwZXJzaWFuRGF0ZVBpY2tlcicpIHBlcnNpYW5EYXRlUGlja2VyOiBUYW1pblBlcnNpYW5EYXRlUGlja2VyQ29tcG9uZW50O1xuICBAVmlld0NoaWxkKCdpY29uJykgaWNvbkVsZW1lbnQ6IEVsZW1lbnRSZWY7XG5cbiAgQElucHV0KCkgc2V0IHZhbHVlKHZhbDogRGF0ZSkge1xuICAgIC8vIGNvbnN0IHRtcCA9IG1vbWVudChuZXcgRGF0ZSh2YWwpKTtcbiAgICAvLyBjb25zdCB0bXAgPSBuZXcgcGVyc2lhbkRhdGUobmV3IERhdGUodmFsKSk7XG4gICAgY29uc3QgdG1wID0gVGFtaW5QZXJzaWFuRGF0ZS5HcmVnb3JpYW5Ub0phbGFsaShuZXcgRGF0ZSh2YWwpKTtcbiAgICAvLyB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlID0gdG1wLnRvTG9jYWxlKCdlbicpLmZvcm1hdCgnWVlZWS9NTS9ERCcpO1xuICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB0bXA7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0VmFsdWUodmFsOiBzdHJpbmcpIHtcbiAgICBpZiAodmFsLmxlbmd0aCA9PT0gOCkge1xuICAgICAgY29uc3QgeXl5eSA9IHZhbC5zdWJzdHIoMCwgNCk7XG4gICAgICBjb25zdCBtbSA9IHZhbC5zdWJzdHIoNCwgMik7XG4gICAgICBjb25zdCBkZCA9IHZhbC5zdWJzdHIoNiwgMik7XG4gICAgICBjb25zdCBpbnB1dCA9IFtOdW1iZXIoeXl5eSksIE51bWJlcihtbSksIE51bWJlcihkZCksIDAsIDAsIDBdO1xuICAgICAgLy8gcmV0dXJuIChuZXcgcGVyc2lhbkRhdGUoaW5wdXQpKS50b0RhdGUoKTtcbiAgICAgIHJldHVybiBUYW1pblBlcnNpYW5EYXRlLkphbGFsaVRvR3JlZ29yaWFuKE51bWJlcih5eXl5KSwgTnVtYmVyKG1tKSwgTnVtYmVyKGRkKSk7XG4gICAgfVxuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSk6IHZvaWQge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSAnJztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gY29uc3QgdG1wID0gbmV3IHBlcnNpYW5EYXRlKG5ldyBEYXRlKHZhbHVlKSk7XG4gICAgICBjb25zdCB0bXAgPSBUYW1pblBlcnNpYW5EYXRlLkdyZWdvcmlhblRvSmFsYWxpKG5ldyBEYXRlKHZhbHVlKSk7XG4gICAgICAvLyB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlID0gdG1wLnRvTG9jYWxlKCdlbicpLmZvcm1hdCgnWVlZWS9NTS9ERCcpOyAvLyB0bXAubG9jYWxlKCdmYScpLmZvcm1hdCgnWVlZWS9NTS9ERCcpO1xuICAgICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZSA9IHRtcDtcbi8qXG4gICAgICBpZiAoIXRoaXMubWFza1JlZikge1xuICAgICAgICB0aGlzLl9zZXRJbnB1dE1hc2soKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubWFza1JlZi51cGRhdGVWYWx1ZSgpO1xuKi9cbiAgICAgIHRoaXMubWFza1JlZi51cGRhdGVWYWx1ZSgpO1xuICAgICAgdGhpcy5vbkNoYW5nZSh2YWx1ZSk7XG4gICAgfSwgMCk7XG4gIH1cblxuICBpbml0aWFsaXplQ29tcG9uZW50KCkge1xuICAgIHRoaXMuX3NldElucHV0TWFzaygpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5waWNrZXIucGFyZW50ID0gdGhpcy5pbnB1dEVsZW1lbnQ7XG4gICAgICB0aGlzLnBpY2tlci5idXR0b24gPSB0aGlzLmljb25FbGVtZW50O1xuXG4gICAgfSwgMCk7XG4gIH1cblxuICBnZXQgdmFsdWUoKTogRGF0ZSB7XG4gICAgLy8gcmV0dXJuIG1vbWVudC5mcm9tKHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWUsICdmYScsICdZWVlZL01NL0REJykudG9EYXRlKCk7XG4gICAgY29uc3QgdG1wID0gdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZS5zcGxpdCgnLycpO1xuICAgIGNvbnN0IGlucHV0ID0gW051bWJlcih0bXBbMF0pLCBOdW1iZXIodG1wWzFdKSwgTnVtYmVyKHRtcFsyXSksIDAsIDAsIDBdO1xuICAgIC8vIHJldHVybiAobmV3IHBlcnNpYW5EYXRlKGlucHV0KSkudG9EYXRlKCk7XG4gICAgcmV0dXJuIChUYW1pblBlcnNpYW5EYXRlLkphbGFsaVRvR3JlZ29yaWFuKE51bWJlcih0bXBbMF0pLCBOdW1iZXIodG1wWzFdKSwgTnVtYmVyKHRtcFsyXSkpKTtcbiAgfVxuXG4gIG9uU2hvd1BpY2tlcigpIHtcbiAgICBpZiAodGhpcy5jb250cm9sLmRpc2FibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB0aGlzLnBpY2tlci50b2dnbGUoKTtcbiAgfVxuXG4gIGhpZGVQb3B1cCgpIHtcbiAgICAvLyB0aGlzLnBpY2tlclZpc2liaWxpdHkgPSAnaGlkZGVuJztcbiAgICB0aGlzLnBpY2tlci5oaWRlKCk7XG4gICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC5yZWFkT25seSA9IGZhbHNlO1xuICB9XG5cbiAgc2hvd1BvcHVwKCkge1xuICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQucmVhZE9ubHkgPSB0cnVlO1xuICAgIGNvbnN0IHZhbCA9IHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWU7XG4gICAgLy8gY29uc3QgdG1wID0gbW9tZW50LmZyb20odmFsLCAnZmEnLCAnWVlZWS9NTS9ERCcpO1xuICAgIGNvbnN0IHQgPSB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlLnNwbGl0KCcvJyk7XG4gICAgY29uc3QgaW5wdXQgPSBbTnVtYmVyKHRbMF0pLCBOdW1iZXIodFsxXSksIE51bWJlcih0WzJdKSwgMjMsIDAsIDBdO1xuICAgIC8vIGNvbnN0IHRtcCA9IChuZXcgcGVyc2lhbkRhdGUoaW5wdXQpKTtcbiAgICBjb25zdCB0bXAgPSBUYW1pblBlcnNpYW5EYXRlLkphbGFsaVRvR3JlZ29yaWFuKE51bWJlcih0WzBdKSwgTnVtYmVyKHRbMV0pLCBOdW1iZXIodFsyXSkpO1xuICAgIC8vIGlmICh0bXAuaXNWYWxpZCgpKSB7XG4gICAgLy8gdGhpcy5wZXJzaWFuRGF0ZVBpY2tlci5jdXJyZW50RGF0ZSA9IG5ldyBEYXRlKHRtcC50b0RhdGUoKSk7XG4gICAgdGhpcy5wZXJzaWFuRGF0ZVBpY2tlci5jdXJyZW50RGF0ZSA9IHRtcDtcbiAgICAvLyB9XG4gICAgdGhpcy5wZXJzaWFuRGF0ZVBpY2tlci5zZXRWaWV3KCk7XG4gICAgdGhpcy5waWNrZXIuc2hvdygpO1xuICAgIC8vIHRoaXMuX3RoZVBvcHBlci51cGRhdGUoKTtcbiAgfVxuXG4gIG9uUGlja2VyQ2hhbmdlKHZhbDogYW55KSB7XG4gICAgaWYgKHZhbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgICB0aGlzLnZhbHVlID0gdmFsO1xuICAgICAgdGhpcy5vbkNoYW5nZSh0aGlzLnZhbHVlKTtcbiAgICAgIHRoaXMuaGlkZVBvcHVwKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfc2V0SW5wdXRNYXNrKCkge1xuICAgIHRoaXMubWFza1JlZiA9IG5ldyBJTWFzayh0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LCB7XG4gICAgICBtYXNrOiAnWVlZWS9NTS9ERCcsXG4gICAgICBibG9ja3M6IHtcbiAgICAgICAgREQ6IHtcbiAgICAgICAgICBtYXNrOiBJTWFzay5NYXNrZWRSYW5nZSxcbiAgICAgICAgICBmcm9tOiAxLFxuICAgICAgICAgIHRvOiAzMSxcbiAgICAgICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKHZhbHVlLCBtYXNrZWQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNvbnN0IHRtcCA9IG1hc2tlZC5wYXJlbnQuX3ZhbHVlLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAgIGNvbnN0IHl5eXkgPSB0bXBbMF07XG4gICAgICAgICAgICAgIGNvbnN0IG1tID0gdG1wWzFdO1xuICAgICAgICAgICAgICBjb25zdCBkZCA9IHZhbHVlO1xuICAgICAgICAgICAgICAvLyBsZXQgdGhlRGF0ZTtcbiAgICAgICAgICAgICAgLy8gdGhlRGF0ZSA9IG1vbWVudC5mcm9tKGAke3l5eXl9LyR7bW19LyR7ZGR9YCwgJ2ZhJywgJ1lZWVkvTU0vREQnKTtcbiAgICAgICAgICAgICAgLy8gcmV0dXJuIHRoZURhdGUuaXNWYWxpZCgpO1xuICAgICAgICAgICAgICAvLyBjb25zdCByZXN1bHQgPSBuZXcgcGVyc2lhbkRhdGUoW051bWJlcih5eXl5KSwgTnVtYmVyKG1tKSwgTnVtYmVyKGRkKSwgMCwgMCwgMCwgMF0pO1xuICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBUYW1pblBlcnNpYW5EYXRlLkphbGFsaVRvR3JlZ29yaWFuKE51bWJlcih5eXl5KSwgTnVtYmVyKG1tKSwgTnVtYmVyKGRkKSk7XG4gICAgICAgICAgICAgIHJldHVybiByZXN1bHQgIT09IG51bGw7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIE1NOiB7XG4gICAgICAgICAgbWFzazogSU1hc2suTWFza2VkUmFuZ2UsXG4gICAgICAgICAgZnJvbTogMSxcbiAgICAgICAgICB0bzogMTJcbiAgICAgICAgfSxcbiAgICAgICAgWVlZWToge1xuICAgICAgICAgIG1hc2s6IElNYXNrLk1hc2tlZFJhbmdlLFxuICAgICAgICAgIGZyb206IDEwMDAsXG4gICAgICAgICAgdG86IDk5OTlcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBwbGFjZWhvbGRlckxhenk6IGZhbHNlLFxuICAgIH0pO1xuICB9XG59XG4iXX0=