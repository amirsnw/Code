/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
  Created by: k_kaviani
  Revised by: a_amiri
*/
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';
// import { Observable } from "rxjs";
import { timeout } from 'rxjs/operators';
/**
 * @template T
 */
export class GenericRestService {
    /**
     * @param {?} http
     */
    constructor(http) {
        this.http = http;
        this.restUrl = '';
        this.timeout = 180000;
        this.pagingPath = '';
    }
    /**
     * @param {?} querySearchParams
     * @param {?} querySortParams
     * @return {?}
     */
    getAll(querySearchParams, querySortParams) {
        /** @type {?} */
        const headers = new HttpHeaders();
        /** @type {?} */
        let params = new HttpParams();
        params.append('filter', JSON.stringify(querySearchParams));
        params.append('sort', JSON.stringify(querySortParams));
        params = params.append('_dc', (new Date()).getTime().toString());
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http.get(this.restUrl, { headers, params })
                .pipe(timeout(this.timeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => resolve(response)))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => reject(this.handleError(error))));
        }));
    }
    /**
     * @param {?} includeMetaData
     * @param {?} pageNo
     * @param {?} pageSize
     * @param {?} querySearchParams
     * @param {?} querySortParams
     * @return {?}
     */
    getPagedEntity(includeMetaData, pageNo, pageSize, querySearchParams, querySortParams) {
        /** @type {?} */
        let params = new HttpParams();
        /** @type {?} */
        const headers = new HttpHeaders();
        params = params.append('filter', JSON.stringify(querySearchParams));
        params = params.append('sort', JSON.stringify(querySortParams));
        //params = params.append('start', pageNo.toString());
        params = params.append('start', ((pageNo - 1) * pageSize).toString());
        params = params.append('limit', pageSize.toString());
        params = params.append('_dc', (new Date()).getTime().toString());
        /** @type {?} */
        const url = `${this.restUrl}/${this.pagingPath}`;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http.get(url, { headers, params })
                .pipe(timeout(this.timeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => resolve(response)))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => reject(this.handleError(error))));
        }));
    }
    /**
     * @param {?} includeMetaData
     * @param {?} pageNo
     * @param {?} pageSize
     * @param {?} querySearchParams
     * @param {?} querySortParams
     * @return {?}
     */
    getPagedObject(includeMetaData, pageNo, pageSize, querySearchParams, querySortParams) {
        /** @type {?} */
        let params = new HttpParams();
        /** @type {?} */
        const headers = new HttpHeaders();
        params = params.append('filter', JSON.stringify(querySearchParams));
        params = params.append('sort', JSON.stringify(querySortParams));
        // params = params.append('start', pageNo.toString());
        params = params.append('start', ((pageNo - 1) * pageSize).toString());
        params = params.append('limit', pageSize.toString());
        params = params.append('_dc', (new Date()).getTime().toString());
        /** @type {?} */
        const url = `${this.restUrl}/${this.pagingPath}`;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http.get(url, { headers, params })
                .pipe(timeout(this.timeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => resolve(response)))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => reject(this.handleError(error))));
        }));
    }
    /**
     * @param {?} id
     * @return {?}
     */
    getById(id) {
        /** @type {?} */
        const url = `${this.restUrl}/${id}`;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http.get(url)
                .pipe(timeout(this.timeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => resolve(response)))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => reject(this.handleError(error))));
        }));
    }
    /**
     * @param {?} ids
     * @return {?}
     */
    getByMultipleId(ids) {
        /** @type {?} */
        let url = `${this.restUrl}`;
        ids.forEach((/**
         * @param {?} id
         * @return {?}
         */
        id => {
            url += `/${id}`;
        }));
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http.get(url)
                .pipe(timeout(this.timeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => resolve(response)))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => reject(this.handleError(error))));
        }));
    }
    /**
     * @param {?} dataItem
     * @return {?}
     */
    create(dataItem) {
        /** @type {?} */
        const url = this.restUrl;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http
                .post(url, dataItem)
                .pipe(timeout(this.timeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => resolve(response)))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => reject(this.handleError(error))));
        }));
    }
    /**
     * @param {?} dataItem
     * @return {?}
     */
    update(dataItem) {
        /** @type {?} */
        const url = this.restUrl;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http
                .put(url, dataItem)
                .pipe(timeout(this.timeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => resolve(response)))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => reject(this.handleError(error))));
        }));
    }
    /**
     * @param {?} id
     * @return {?}
     */
    delete(id) {
        /** @type {?} */
        const url = `${this.restUrl}/${id}`;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http
                .delete(url)
                .pipe(timeout(this.timeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => resolve(response)))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => reject(this.handleError(error))));
        }));
    }
    /**
     * @protected
     * @param {?} error
     * @return {?}
     */
    handleError(error) {
        return error;
    }
}
GenericRestService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
GenericRestService.ctorParameters = () => [
    { type: HttpClient }
];
if (false) {
    /** @type {?} */
    GenericRestService.prototype.restUrl;
    /** @type {?} */
    GenericRestService.prototype.timeout;
    /**
     * @type {?}
     * @private
     */
    GenericRestService.prototype.pagingPath;
    /**
     * @type {?}
     * @private
     */
    GenericRestService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJpYy1yZXN0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90YW1pbi1mcmFtZXdvcmsvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZ2VuZXJpYy1yZXN0LXNlcnZpY2UvZ2VuZXJpYy1yZXN0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFLQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDOztBQU0zRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7QUFHekMsTUFBTSxPQUFPLGtCQUFrQjs7OztJQUs3QixZQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBSjdCLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFDYixZQUFPLEdBQUcsTUFBTSxDQUFDO1FBQ2hCLGVBQVUsR0FBRyxFQUFFLENBQUM7SUFHeEIsQ0FBQzs7Ozs7O0lBRUQsTUFBTSxDQUFDLGlCQUFnQyxFQUFFLGVBQTRCOztjQUM3RCxPQUFPLEdBQUcsSUFBSSxXQUFXLEVBQUU7O1lBQzdCLE1BQU0sR0FBRyxJQUFJLFVBQVUsRUFBRTtRQUM3QixNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztRQUMzRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7UUFDdkQsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDakUsT0FBTyxJQUFJLE9BQU87Ozs7O1FBQXNCLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1lBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFzQixJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDO2lCQUNsRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDM0IsU0FBUyxFQUFFO2lCQUNYLElBQUk7Ozs7WUFBQyxDQUFDLFFBQTZCLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBQztpQkFDMUQsS0FBSzs7OztZQUFDLENBQUMsS0FBZSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDakUsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7Ozs7Ozs7SUFFRCxjQUFjLENBQUMsZUFBd0IsRUFBRSxNQUFjLEVBQUUsUUFBZ0IsRUFBRSxpQkFBZ0MsRUFDekcsZUFBNEI7O1lBQ3hCLE1BQU0sR0FBRyxJQUFJLFVBQVUsRUFBRTs7Y0FDdkIsT0FBTyxHQUFHLElBQUksV0FBVyxFQUFFO1FBQ2pDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztRQUNwRSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO1FBQ2hFLHFEQUFxRDtRQUNyRCxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUNyRCxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQzs7Y0FDM0QsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1FBQ2hELE9BQU8sSUFBSSxPQUFPOzs7OztRQUF5QixDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUM3RCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBeUIsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDO2lCQUM1RCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDM0IsU0FBUyxFQUFFO2lCQUNYLElBQUk7Ozs7WUFBQyxDQUFDLFFBQWdDLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBQztpQkFDN0QsS0FBSzs7OztZQUFDLENBQUMsS0FBZSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDakUsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7Ozs7Ozs7SUFFRCxjQUFjLENBQUMsZUFBd0IsRUFBRSxNQUFjLEVBQUUsUUFBZ0IsRUFBRSxpQkFBZ0MsRUFDekcsZUFBNEI7O1lBQ3hCLE1BQU0sR0FBRyxJQUFJLFVBQVUsRUFBRTs7Y0FDdkIsT0FBTyxHQUFHLElBQUksV0FBVyxFQUFFO1FBQ2pDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztRQUNwRSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO1FBQ2hFLHNEQUFzRDtRQUN0RCxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUNyRCxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQzs7Y0FDM0QsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1FBQ2hELE9BQU8sSUFBSSxPQUFPOzs7OztRQUFzQixDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUMxRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBc0IsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDO2lCQUN6RCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDM0IsU0FBUyxFQUFFO2lCQUNYLElBQUk7Ozs7WUFBQyxDQUFDLFFBQTZCLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBQztpQkFDMUQsS0FBSzs7OztZQUFDLENBQUMsS0FBZSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDakUsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7OztJQUVELE9BQU8sQ0FBQyxFQUFVOztjQUNWLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLElBQUksRUFBRSxFQUFFO1FBQ25DLE9BQU8sSUFBSSxPQUFPOzs7OztRQUFzQixDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUMxRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBc0IsR0FBRyxDQUFDO2lCQUNwQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDM0IsU0FBUyxFQUFFO2lCQUNYLElBQUk7Ozs7WUFBQyxDQUFDLFFBQTZCLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBQztpQkFDMUQsS0FBSzs7OztZQUFDLENBQUMsS0FBZSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDakUsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7OztJQUVELGVBQWUsQ0FBQyxHQUFhOztZQUN2QixHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQzNCLEdBQUcsQ0FBQyxPQUFPOzs7O1FBQUMsRUFBRSxDQUFDLEVBQUU7WUFDZixHQUFHLElBQUksSUFBSSxFQUFFLEVBQUUsQ0FBQztRQUNsQixDQUFDLEVBQUMsQ0FBQztRQUNILE9BQU8sSUFBSSxPQUFPOzs7OztRQUFzQixDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUMxRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBc0IsR0FBRyxDQUFDO2lCQUNwQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDM0IsU0FBUyxFQUFFO2lCQUNYLElBQUk7Ozs7WUFBQyxDQUFDLFFBQTZCLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBQztpQkFDMUQsS0FBSzs7OztZQUFDLENBQUMsS0FBZSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDakUsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7OztJQUVELE1BQU0sQ0FBQyxRQUFXOztjQUNWLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTztRQUN4QixPQUFPLElBQUksT0FBTzs7Ozs7UUFBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUN4QyxJQUFJLENBQUMsSUFBSTtpQkFDTixJQUFJLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQztpQkFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQzNCLFNBQVMsRUFBRTtpQkFDWCxJQUFJOzs7O1lBQUMsQ0FBQyxRQUFXLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBQztpQkFDeEMsS0FBSzs7OztZQUFDLENBQUMsS0FBZSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDakUsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7OztJQUVELE1BQU0sQ0FBQyxRQUFXOztjQUNWLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTztRQUN4QixPQUFPLElBQUksT0FBTzs7Ozs7UUFBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUN4QyxJQUFJLENBQUMsSUFBSTtpQkFDTixHQUFHLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQztpQkFDbEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQzNCLFNBQVMsRUFBRTtpQkFDWCxJQUFJOzs7O1lBQUMsQ0FBQyxRQUFXLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBQztpQkFDeEMsS0FBSzs7OztZQUFDLENBQUMsS0FBZSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDakUsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7OztJQUVELE1BQU0sQ0FBQyxFQUFVOztjQUNULEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLElBQUksRUFBRSxFQUFFO1FBQ25DLE9BQU8sSUFBSSxPQUFPOzs7OztRQUFPLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1lBQzNDLElBQUksQ0FBQyxJQUFJO2lCQUNOLE1BQU0sQ0FBQyxHQUFHLENBQUM7aUJBQ1gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQzNCLFNBQVMsRUFBRTtpQkFDWCxJQUFJOzs7O1lBQUMsQ0FBQyxRQUFhLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBQztpQkFDMUMsS0FBSzs7OztZQUFDLENBQUMsS0FBZSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDakUsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7Ozs7SUFFUyxXQUFXLENBQUMsS0FBVTtRQUM5QixPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7OztZQS9IRixVQUFVOzs7O1lBUkYsVUFBVTs7OztJQVVqQixxQ0FBb0I7O0lBQ3BCLHFDQUF3Qjs7Ozs7SUFDeEIsd0NBQXdCOzs7OztJQUVaLGtDQUF3QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gIENyZWF0ZWQgYnk6IGtfa2F2aWFuaVxuICBSZXZpc2VkIGJ5OiBhX2FtaXJpXG4qL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycywgSHR0cFBhcmFtcyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IFNlYXJjaFBhcmFtIH0gZnJvbSAnLi4vLi4vbW9kZWxzL3NlYXJjaC1wYXJhbS5tb2RlbCc7XG5pbXBvcnQgeyBTb3J0UGFyYW0gfSBmcm9tICcuLi8uLi9tb2RlbHMvc29ydC1wYXJhbS5tb2RlbCc7XG5pbXBvcnQgeyBFbnRpdHlSZXN1bHRXcmFwcGVyIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2VudGl0eS1yZXN1bHQtd3JhcHBlci5tb2RlbCc7XG5pbXBvcnQgeyBPYmplY3RSZXN1bHRXcmFwcGVyIH0gZnJvbSAnLi4vLi4vbW9kZWxzL29iamVjdC1yZXN1bHQtd3JhcHBlci5tb2RlbCc7XG4vLyBpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7IHRpbWVvdXQgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBHZW5lcmljUmVzdFNlcnZpY2U8VD4ge1xuICBwdWJsaWMgcmVzdFVybCA9ICcnO1xuICBwdWJsaWMgdGltZW91dCA9IDE4MDAwMDtcbiAgcHJpdmF0ZSBwYWdpbmdQYXRoID0gJyc7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7XG4gIH1cblxuICBnZXRBbGwocXVlcnlTZWFyY2hQYXJhbXM6IFNlYXJjaFBhcmFtW10sIHF1ZXJ5U29ydFBhcmFtczogU29ydFBhcmFtW10pOiBQcm9taXNlPE9iamVjdFJlc3VsdFdyYXBwZXI+IHtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgcGFyYW1zLmFwcGVuZCgnZmlsdGVyJywgSlNPTi5zdHJpbmdpZnkocXVlcnlTZWFyY2hQYXJhbXMpKTtcbiAgICBwYXJhbXMuYXBwZW5kKCdzb3J0JywgSlNPTi5zdHJpbmdpZnkocXVlcnlTb3J0UGFyYW1zKSk7XG4gICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnX2RjJywgKG5ldyBEYXRlKCkpLmdldFRpbWUoKS50b1N0cmluZygpKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8T2JqZWN0UmVzdWx0V3JhcHBlcj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwLmdldDxPYmplY3RSZXN1bHRXcmFwcGVyPih0aGlzLnJlc3RVcmwsIHsgaGVhZGVycywgcGFyYW1zIH0pXG4gICAgICAgIC5waXBlKHRpbWVvdXQodGhpcy50aW1lb3V0KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKChyZXNwb25zZTogT2JqZWN0UmVzdWx0V3JhcHBlcikgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3I6IFJlc3BvbnNlKSA9PiByZWplY3QodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFBhZ2VkRW50aXR5KGluY2x1ZGVNZXRhRGF0YTogYm9vbGVhbiwgcGFnZU5vOiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIHF1ZXJ5U2VhcmNoUGFyYW1zOiBTZWFyY2hQYXJhbVtdLFxuICAgIHF1ZXJ5U29ydFBhcmFtczogU29ydFBhcmFtW10pOiBQcm9taXNlPEVudGl0eVJlc3VsdFdyYXBwZXI8VD4+IHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnZmlsdGVyJywgSlNPTi5zdHJpbmdpZnkocXVlcnlTZWFyY2hQYXJhbXMpKTtcbiAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdzb3J0JywgSlNPTi5zdHJpbmdpZnkocXVlcnlTb3J0UGFyYW1zKSk7XG4gICAgLy9wYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdzdGFydCcsIHBhZ2VOby50b1N0cmluZygpKTtcbiAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdzdGFydCcsICgocGFnZU5vIC0gMSkgKiBwYWdlU2l6ZSkudG9TdHJpbmcoKSk7XG4gICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnbGltaXQnLCBwYWdlU2l6ZS50b1N0cmluZygpKTtcbiAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdfZGMnLCAobmV3IERhdGUoKSkuZ2V0VGltZSgpLnRvU3RyaW5nKCkpO1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMucmVzdFVybH0vJHt0aGlzLnBhZ2luZ1BhdGh9YDtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8RW50aXR5UmVzdWx0V3JhcHBlcjxUPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwLmdldDxFbnRpdHlSZXN1bHRXcmFwcGVyPFQ+Pih1cmwsIHsgaGVhZGVycywgcGFyYW1zIH0pXG4gICAgICAgIC5waXBlKHRpbWVvdXQodGhpcy50aW1lb3V0KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKChyZXNwb25zZTogRW50aXR5UmVzdWx0V3JhcHBlcjxUPikgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3I6IFJlc3BvbnNlKSA9PiByZWplY3QodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFBhZ2VkT2JqZWN0KGluY2x1ZGVNZXRhRGF0YTogYm9vbGVhbiwgcGFnZU5vOiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIHF1ZXJ5U2VhcmNoUGFyYW1zOiBTZWFyY2hQYXJhbVtdLFxuICAgIHF1ZXJ5U29ydFBhcmFtczogU29ydFBhcmFtW10pOiBQcm9taXNlPE9iamVjdFJlc3VsdFdyYXBwZXI+IHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnZmlsdGVyJywgSlNPTi5zdHJpbmdpZnkocXVlcnlTZWFyY2hQYXJhbXMpKTtcbiAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdzb3J0JywgSlNPTi5zdHJpbmdpZnkocXVlcnlTb3J0UGFyYW1zKSk7XG4gICAgLy8gcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnc3RhcnQnLCBwYWdlTm8udG9TdHJpbmcoKSk7XG4gICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnc3RhcnQnLCAoKHBhZ2VObyAtIDEpICogcGFnZVNpemUpLnRvU3RyaW5nKCkpO1xuICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2xpbWl0JywgcGFnZVNpemUudG9TdHJpbmcoKSk7XG4gICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnX2RjJywgKG5ldyBEYXRlKCkpLmdldFRpbWUoKS50b1N0cmluZygpKTtcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLnJlc3RVcmx9LyR7dGhpcy5wYWdpbmdQYXRofWA7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPE9iamVjdFJlc3VsdFdyYXBwZXI+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuaHR0cC5nZXQ8T2JqZWN0UmVzdWx0V3JhcHBlcj4odXJsLCB7IGhlYWRlcnMsIHBhcmFtcyB9KVxuICAgICAgICAucGlwZSh0aW1lb3V0KHRoaXMudGltZW91dCkpXG4gICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAudGhlbigocmVzcG9uc2U6IE9iamVjdFJlc3VsdFdyYXBwZXIpID0+IHJlc29sdmUocmVzcG9uc2UpKVxuICAgICAgICAuY2F0Y2goKGVycm9yOiBSZXNwb25zZSkgPT4gcmVqZWN0KHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpKSk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRCeUlkKGlkOiBudW1iZXIpOiBQcm9taXNlPE9iamVjdFJlc3VsdFdyYXBwZXI+IHtcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLnJlc3RVcmx9LyR7aWR9YDtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8T2JqZWN0UmVzdWx0V3JhcHBlcj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwLmdldDxPYmplY3RSZXN1bHRXcmFwcGVyPih1cmwpXG4gICAgICAgIC5waXBlKHRpbWVvdXQodGhpcy50aW1lb3V0KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKChyZXNwb25zZTogT2JqZWN0UmVzdWx0V3JhcHBlcikgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3I6IFJlc3BvbnNlKSA9PiByZWplY3QodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEJ5TXVsdGlwbGVJZChpZHM6IHN0cmluZ1tdKTogUHJvbWlzZTxPYmplY3RSZXN1bHRXcmFwcGVyPiB7XG4gICAgbGV0IHVybCA9IGAke3RoaXMucmVzdFVybH1gO1xuICAgIGlkcy5mb3JFYWNoKGlkID0+IHtcbiAgICAgIHVybCArPSBgLyR7aWR9YDtcbiAgICB9KTtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8T2JqZWN0UmVzdWx0V3JhcHBlcj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwLmdldDxPYmplY3RSZXN1bHRXcmFwcGVyPih1cmwpXG4gICAgICAgIC5waXBlKHRpbWVvdXQodGhpcy50aW1lb3V0KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKChyZXNwb25zZTogT2JqZWN0UmVzdWx0V3JhcHBlcikgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3I6IFJlc3BvbnNlKSA9PiByZWplY3QodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNyZWF0ZShkYXRhSXRlbTogVCk6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IHVybCA9IHRoaXMucmVzdFVybDtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8VD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwXG4gICAgICAgIC5wb3N0KHVybCwgZGF0YUl0ZW0pXG4gICAgICAgIC5waXBlKHRpbWVvdXQodGhpcy50aW1lb3V0KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKChyZXNwb25zZTogVCkgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3I6IFJlc3BvbnNlKSA9PiByZWplY3QodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZShkYXRhSXRlbTogVCk6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IHVybCA9IHRoaXMucmVzdFVybDtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8VD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwXG4gICAgICAgIC5wdXQodXJsLCBkYXRhSXRlbSlcbiAgICAgICAgLnBpcGUodGltZW91dCh0aGlzLnRpbWVvdXQpKVxuICAgICAgICAudG9Qcm9taXNlKClcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlOiBUKSA9PiByZXNvbHZlKHJlc3BvbnNlKSlcbiAgICAgICAgLmNhdGNoKChlcnJvcjogUmVzcG9uc2UpID0+IHJlamVjdCh0aGlzLmhhbmRsZUVycm9yKGVycm9yKSkpO1xuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlKGlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLnJlc3RVcmx9LyR7aWR9YDtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwXG4gICAgICAgIC5kZWxldGUodXJsKVxuICAgICAgICAucGlwZSh0aW1lb3V0KHRoaXMudGltZW91dCkpXG4gICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3I6IFJlc3BvbnNlKSA9PiByZWplY3QodGhpcy5oYW5kbGVFcnJvcihlcnJvcikpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBoYW5kbGVFcnJvcihlcnJvcjogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gZXJyb3I7XG4gIH1cbn1cbiJdfQ==