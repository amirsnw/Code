/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
export class TaminImageUploadComponent {
    /**
     * @param {?} http
     */
    constructor(http) {
        this.http = http;
        this.onImageUploaded = new EventEmitter();
        this.onImageDeleted = new EventEmitter();
        this.displayPreview = 'none';
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set imageGuid(value) {
        if (!value) {
            return;
        }
        this._imageGuid = value;
        this.loadImage(this._imageGuid);
    }
    /**
     * @return {?}
     */
    get imageGuid() {
        return this._imageGuid;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} imageGuid
     * @return {?}
     */
    loadImage(imageGuid) {
        this._imageGuid = imageGuid;
        /** @type {?} */
        const url = `${this.restUrl}/${this.imageGuid}`;
        /** @type {?} */
        const image = this.previewImage.nativeElement;
        this.http.get(url)
            .toPromise()
            .then((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            image.src = `data:image/jpeg;base64,${((/** @type {?} */ (value))).data}`;
            this.displayPreview = 'unset';
        }))
            .catch((/**
         * @param {?} reason
         * @return {?}
         */
        reason => {
            console.error(reason);
        }));
    }
    // loadImage(imageGuid: string) {
    //   this.imageGuid = imageGuid;
    //   let url = `${this.restUrl}/${this.imageGuid}`;
    //   let headers = new HttpHeaders({ 'Content-Type': 'image/jpg' });
    //   let params = new HttpParams();
    //   params.append('responseType', 'blob');
    //   params = params.append('_dc', (new Date()).getTime().toString());
    //   let image = this.previewImage.nativeElement;
    //   this.http.get(url, { headers,  params }).subscribe(
    //       data => {
    //         //let blob = new Blob([data.arrayBuffer()], { type: data.headers.get('Content-Type') });
    //         let imageurl = window.URL.createObjectURL(data);
    //         image.src = imageurl;
    //         // image.src = 'data:image/jpeg;base64,' + data.arrayBuffer();
    //         // this.onImageUploaded.emit(this.imageGuid);
    //         this.displayPreview = "unset";
    //       },
    //       error => {
    //        // console.log(error);
    //         this.imageGuid = '';
    //       }
    //     );
    // }
    /*upload(event) {
        this.imageGuid = 'در حال بارگزاری';
        let inputfile = event.dataTransfer ? event.dataTransfer : event.target;
        let image = this.previewImage.nativeElement;
        let reader = new FileReader();
        reader.onload = function (e) {
          let src = (e.target as FileReader).result;
          image.src = src;
        };
        if (inputfile.files.length > 0) {
          let file: File = inputfile.files[0];
          let formData = new FormData();
          formData.append('file', file, file.name);
          //let headers = new HttpHeaders({'Content-Type': 'multipart/form-data'});
          this.http.post(this.restUrl, formData).subscribe(
            data => {
              reader.readAsDataURL(event.target.files[0]);
              this.imageGuid = data.toString();//.text();
              if (this.onImageUploaded)
                this.onImageUploaded.emit(this.imageGuid);
              this.displayPreview = 'unset';
            },
            error => {
              //console.log(error);
              this.imageGuid = '';
            }
          );
        }
      }*/
    /**
     * @param {?} event
     * @return {?}
     */
    upload(event) {
        this.imageGuid = 'در حال بارگذاری';
        /** @type {?} */
        const inputfile = event.dataTransfer ? event.dataTransfer : event.target;
        /** @type {?} */
        const image = this.previewImage.nativeElement;
        /** @type {?} */
        const reader = new FileReader();
        if (inputfile.files.length > 0) {
            /** @type {?} */
            const file = inputfile.files[0];
            reader.readAsDataURL(file);
            reader.onload = (/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const formData = new FormData();
                formData.append('file', file, file.name);
                this.http.post(this.restUrl, formData).toPromise()
                    .then((/**
                 * @param {?} response
                 * @return {?}
                 */
                (response) => {
                    /** @type {?} */
                    const src = reader.result;
                    image.src = src;
                    this.imageGuid = response['guid'];
                    if (this.onImageUploaded) {
                        this.onImageUploaded.emit(this.imageGuid);
                    }
                    this.displayPreview = 'unset';
                }))
                    .catch((/**
                 * @param {?} error
                 * @return {?}
                 */
                (error) => {
                    // console.log("Upload error:", error);
                    this.imageGuid = '';
                }));
            });
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    uploadBase64(event) {
        this.imageGuid = 'در حال بارگذاری';
        /** @type {?} */
        const inputfile = event.dataTransfer ? event.dataTransfer : event.target;
        /** @type {?} */
        const image = this.previewImage.nativeElement;
        /** @type {?} */
        const reader = new FileReader();
        if (inputfile.files.length > 0) {
            /** @type {?} */
            const file = inputfile.files[0];
            reader.readAsDataURL(file);
            reader.onload = (/**
             * @return {?}
             */
            () => {
                // let headers = new HttpHeaders({'Content-Type': 'text/plain'});
                /** @type {?} */
                const headers = new HttpHeaders({ 'Content-Type': 'application/json' });
                this.http.post(this.restUrl, ((/** @type {?} */ (reader.result))).split(',')[1], { headers: headers }).toPromise()
                    .then((/**
                 * @param {?} response
                 * @return {?}
                 */
                (response) => {
                    /** @type {?} */
                    const src = reader.result;
                    image.src = src;
                    this.imageGuid = response['guid'];
                    if (this.onImageUploaded) {
                        this.onImageUploaded.emit(this.imageGuid);
                    }
                    this.displayPreview = 'unset';
                }))
                    .catch((/**
                 * @param {?} error
                 * @return {?}
                 */
                (error) => {
                    // console.log("Upload error:", error);
                    this.imageGuid = '';
                }));
            });
        }
    }
    /**
     * @return {?}
     */
    removeImage() {
        /** @type {?} */
        const url = `${this.restUrl}/${this.imageGuid}`;
        /** @type {?} */
        const image = this.previewImage.nativeElement;
        image.src = '';
        this.onImageDeleted.emit(this.imageGuid);
        this.imageGuid = '';
        this.http.delete(url).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
        }));
    }
}
TaminImageUploadComponent.decorators = [
    { type: Component, args: [{
                selector: 'tamin-field-image-upload',
                template: "<div class=\"divTable\" style=\"width: 100%;\">\n  <div class=\"divTableHeading\">\n\t\t<div class=\"divTableRow\">\n\t\t\t<div class=\"divTableHead\"  style=\"width: 128px; font-size: 0.8em\">\u067E\u06CC\u0634 \u0646\u0645\u0627\u06CC\u0634</div>\n\t\t\t<div class=\"divTableHead\"  style=\"font-size: 0.8em\">\u0639\u0645\u0644\u06CC\u0627\u062A</div>\n\t\t</div>\n\t</div>\n\t<div class=\"divTableBody\">\n\t\t<div class=\"divTableRow\">\n\t\t\t<div class=\"divTableCell\">\n\t\t\t\t\t<img #previewImage alt=\"\u0628\u062F\u0648\u0646 \u062A\u0635\u0648\u06CC\u0631\" [style.display]=\"displayPreview\" style=\"width: 128px;\" />\n      </div>\n\t\t\t<div class=\"divTableCell\">\n          <label attr.for=\"{{controlName}}\" class=\"inputfile\" style=\"width: 116px; white-space: nowrap;\">\n            <label class=\"icon-upload\" style=\"margin-left: 3px; vertical-align: middle;\"></label>\n            \u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0641\u0627\u06CC\u0644\n\t\t\t\t\t</label>\n          <input type=\"file\" attr.id=\"{{controlName}}\" accept=\".jpg,.jpeg,.png\"/>\n          <br/>\n\t\t\t\t\t<button type=\"button\" class=\"button normal dark icon-trash\" (click)=\"removeImage()\">\u062D\u0630\u0641 \u062A\u0635\u0648\u06CC\u0631</button>\n          <br/>\n          <label style=\"font-size: 0.8em;\">\u0648\u0636\u0639\u06CC\u062A: {{imageGuid}} </label>\n      </div>\n\t\t</div>\n\t</div>\n  <!--<div class=\"divTableFoot\">\n\t\t<div class=\"divTableRow\">\n\t\t\t<div class=\"divTableCell\">&nbsp;</div>\n\t\t\t<div class=\"divTableCell\">&nbsp;</div>\n\t\t</div>\n\t</div>-->\n</div>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
TaminImageUploadComponent.ctorParameters = () => [
    { type: HttpClient }
];
TaminImageUploadComponent.propDecorators = {
    controlName: [{ type: Input }],
    onImageUploaded: [{ type: Output }],
    onImageDeleted: [{ type: Output }],
    previewImage: [{ type: ViewChild, args: ['previewImage',] }],
    restUrl: [{ type: Input }],
    imageGuid: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    TaminImageUploadComponent.prototype.controlName;
    /**
     * @type {?}
     * @private
     */
    TaminImageUploadComponent.prototype._imageGuid;
    /** @type {?} */
    TaminImageUploadComponent.prototype.onImageUploaded;
    /** @type {?} */
    TaminImageUploadComponent.prototype.onImageDeleted;
    /** @type {?} */
    TaminImageUploadComponent.prototype.previewImage;
    /** @type {?} */
    TaminImageUploadComponent.prototype.restUrl;
    /** @type {?} */
    TaminImageUploadComponent.prototype.displayPreview;
    /**
     * @type {?}
     * @private
     */
    TaminImageUploadComponent.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFtaW4taW1hZ2UtdXBsb2FkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RhbWluLWZyYW1ld29yay8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RhbWluLWltYWdlLXVwbG9hZC90YW1pbi1pbWFnZS11cGxvYWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDcEcsT0FBTyxFQUFDLFVBQVUsRUFBRSxXQUFXLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQU83RCxNQUFNLE9BQU8seUJBQXlCOzs7O0lBcUJwQyxZQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBbEIxQixvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFDN0MsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBR3RELG1CQUFjLEdBQUcsTUFBTSxDQUFDO0lBZXhCLENBQUM7Ozs7O0lBYkQsSUFBYSxTQUFTLENBQUMsS0FBYTtRQUNsQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFDeEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbEMsQ0FBQzs7OztJQUVELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDOzs7O0lBS0QsUUFBUTtJQUNSLENBQUM7Ozs7O0lBRUQsU0FBUyxDQUFDLFNBQWlCO1FBQ3pCLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDOztjQUN0QixHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7O2NB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QVksQ0FBQyxhQUFhO1FBQzdDLEtBQUssQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVM7Ozs7UUFDN0IsSUFBSSxDQUFDLEVBQUU7UUFDUCxDQUFDOzs7O1FBQ0QsS0FBSyxDQUFDLEVBQUU7UUFDUixDQUFDLEVBQ0YsQ0FBQztJQUNKLENBQUM7OztZQTdLRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLDBCQUEwQjtnQkFDcEMsc21EQUFrRDs7YUFFbkQ7Ozs7WUFOTyxVQUFVOzs7MEJBUWYsS0FBSzs4QkFFTCxNQUFNOzZCQUNOLE1BQU07MkJBQ04sU0FBUyxTQUFDLGNBQWM7c0JBQ3hCLEtBQUs7d0JBR0wsS0FBSzs7OztJQVJOLGdEQUE2Qjs7Ozs7SUFDN0IsK0NBQTJCOztJQUMzQixvREFBdUQ7O0lBQ3ZELG1EQUFzRDs7SUFDdEQsaURBQW9EOztJQUNwRCw0Q0FBeUI7O0lBQ3pCLG1EQUF3Qjs7Ozs7SUFjWix5Q0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0h0dHBDbGllbnQsIEh0dHBIZWFkZXJzfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RhbWluLWZpZWxkLWltYWdlLXVwbG9hZCcsXG4gIHRlbXBsYXRlVXJsOiAnLi90YW1pbi1pbWFnZS11cGxvYWQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi90YW1pbi1pbWFnZS11cGxvYWQuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUYW1pbkltYWdlVXBsb2FkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCkgY29udHJvbE5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSBfaW1hZ2VHdWlkOiBzdHJpbmc7XG4gIEBPdXRwdXQoKSBvbkltYWdlVXBsb2FkZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcbiAgQE91dHB1dCgpIG9uSW1hZ2VEZWxldGVkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG4gIEBWaWV3Q2hpbGQoJ3ByZXZpZXdJbWFnZScpIHByZXZpZXdJbWFnZTogRWxlbWVudFJlZjtcbiAgQElucHV0KCkgcmVzdFVybDogc3RyaW5nO1xuICBkaXNwbGF5UHJldmlldyA9ICdub25lJztcblxuICBASW5wdXQoKSBzZXQgaW1hZ2VHdWlkKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX2ltYWdlR3VpZCA9IHZhbHVlO1xuICAgIHRoaXMubG9hZEltYWdlKHRoaXMuX2ltYWdlR3VpZCk7XG4gIH1cblxuICBnZXQgaW1hZ2VHdWlkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX2ltYWdlR3VpZDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gIH1cblxuICBsb2FkSW1hZ2UoaW1hZ2VHdWlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9pbWFnZUd1aWQgPSBpbWFnZUd1aWQ7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5yZXN0VXJsfS8ke3RoaXMuaW1hZ2VHdWlkfWA7XG4gICAgY29uc3QgaW1hZ2UgPSB0aGlzLnByZXZpZXdJbWFnZS5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbih2YWx1ZSA9PiB7XG4gICAgICAgIGltYWdlLnNyYyA9IGBkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCR7KDxhbnk+dmFsdWUpLmRhdGF9YDtcbiAgICAgICAgdGhpcy5kaXNwbGF5UHJldmlldyA9ICd1bnNldCc7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKHJlYXNvbiA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLy8gbG9hZEltYWdlKGltYWdlR3VpZDogc3RyaW5nKSB7XG4gIC8vICAgdGhpcy5pbWFnZUd1aWQgPSBpbWFnZUd1aWQ7XG4gIC8vICAgbGV0IHVybCA9IGAke3RoaXMucmVzdFVybH0vJHt0aGlzLmltYWdlR3VpZH1gO1xuICAvLyAgIGxldCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKHsgJ0NvbnRlbnQtVHlwZSc6ICdpbWFnZS9qcGcnIH0pO1xuICAvLyAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAvLyAgIHBhcmFtcy5hcHBlbmQoJ3Jlc3BvbnNlVHlwZScsICdibG9iJyk7XG4gIC8vICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnX2RjJywgKG5ldyBEYXRlKCkpLmdldFRpbWUoKS50b1N0cmluZygpKTtcbiAgLy8gICBsZXQgaW1hZ2UgPSB0aGlzLnByZXZpZXdJbWFnZS5uYXRpdmVFbGVtZW50O1xuICAvLyAgIHRoaXMuaHR0cC5nZXQodXJsLCB7IGhlYWRlcnMsICBwYXJhbXMgfSkuc3Vic2NyaWJlKFxuICAvLyAgICAgICBkYXRhID0+IHtcbiAgLy8gICAgICAgICAvL2xldCBibG9iID0gbmV3IEJsb2IoW2RhdGEuYXJyYXlCdWZmZXIoKV0sIHsgdHlwZTogZGF0YS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgfSk7XG4gIC8vICAgICAgICAgbGV0IGltYWdldXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoZGF0YSk7XG4gIC8vICAgICAgICAgaW1hZ2Uuc3JjID0gaW1hZ2V1cmw7XG4gIC8vICAgICAgICAgLy8gaW1hZ2Uuc3JjID0gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJyArIGRhdGEuYXJyYXlCdWZmZXIoKTtcbiAgLy8gICAgICAgICAvLyB0aGlzLm9uSW1hZ2VVcGxvYWRlZC5lbWl0KHRoaXMuaW1hZ2VHdWlkKTtcbiAgLy8gICAgICAgICB0aGlzLmRpc3BsYXlQcmV2aWV3ID0gXCJ1bnNldFwiO1xuICAvLyAgICAgICB9LFxuICAvLyAgICAgICBlcnJvciA9PiB7XG4gIC8vICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcik7XG4gIC8vICAgICAgICAgdGhpcy5pbWFnZUd1aWQgPSAnJztcbiAgLy8gICAgICAgfVxuICAvLyAgICAgKTtcbiAgLy8gfVxuXG4gIC8qdXBsb2FkKGV2ZW50KSB7XG4gICAgdGhpcy5pbWFnZUd1aWQgPSAn2K/YsSDYrdin2YQg2KjYp9ix2q/Ystin2LHbjCc7XG4gICAgbGV0IGlucHV0ZmlsZSA9IGV2ZW50LmRhdGFUcmFuc2ZlciA/IGV2ZW50LmRhdGFUcmFuc2ZlciA6IGV2ZW50LnRhcmdldDtcbiAgICBsZXQgaW1hZ2UgPSB0aGlzLnByZXZpZXdJbWFnZS5uYXRpdmVFbGVtZW50O1xuICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgbGV0IHNyYyA9IChlLnRhcmdldCBhcyBGaWxlUmVhZGVyKS5yZXN1bHQ7XG4gICAgICBpbWFnZS5zcmMgPSBzcmM7XG4gICAgfTtcbiAgICBpZiAoaW5wdXRmaWxlLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBmaWxlOiBGaWxlID0gaW5wdXRmaWxlLmZpbGVzWzBdO1xuICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlLCBmaWxlLm5hbWUpO1xuICAgICAgLy9sZXQgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7J0NvbnRlbnQtVHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJ30pO1xuICAgICAgdGhpcy5odHRwLnBvc3QodGhpcy5yZXN0VXJsLCBmb3JtRGF0YSkuc3Vic2NyaWJlKFxuICAgICAgICBkYXRhID0+IHtcbiAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChldmVudC50YXJnZXQuZmlsZXNbMF0pO1xuICAgICAgICAgIHRoaXMuaW1hZ2VHdWlkID0gZGF0YS50b1N0cmluZygpOy8vLnRleHQoKTtcbiAgICAgICAgICBpZiAodGhpcy5vbkltYWdlVXBsb2FkZWQpXG4gICAgICAgICAgICB0aGlzLm9uSW1hZ2VVcGxvYWRlZC5lbWl0KHRoaXMuaW1hZ2VHdWlkKTtcbiAgICAgICAgICB0aGlzLmRpc3BsYXlQcmV2aWV3ID0gJ3Vuc2V0JztcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIC8vY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgIHRoaXMuaW1hZ2VHdWlkID0gJyc7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICB9Ki9cblxuICB1cGxvYWQoZXZlbnQpIHtcbiAgICB0aGlzLmltYWdlR3VpZCA9ICfYr9ixINit2KfZhCDYqNin2LHar9iw2KfYsduMJztcbiAgICBjb25zdCBpbnB1dGZpbGUgPSBldmVudC5kYXRhVHJhbnNmZXIgPyBldmVudC5kYXRhVHJhbnNmZXIgOiBldmVudC50YXJnZXQ7XG4gICAgY29uc3QgaW1hZ2UgPSB0aGlzLnByZXZpZXdJbWFnZS5uYXRpdmVFbGVtZW50O1xuICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgaWYgKGlucHV0ZmlsZS5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBmaWxlOiBGaWxlID0gaW5wdXRmaWxlLmZpbGVzWzBdO1xuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlLCBmaWxlLm5hbWUpO1xuICAgICAgICB0aGlzLmh0dHAucG9zdCh0aGlzLnJlc3RVcmwsIGZvcm1EYXRhKS50b1Byb21pc2UoKVxuICAgICAgICAgIC50aGVuKChyZXNwb25zZTogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNyYyA9IHJlYWRlci5yZXN1bHQ7XG4gICAgICAgICAgICBpbWFnZS5zcmMgPSBzcmM7XG4gICAgICAgICAgICB0aGlzLmltYWdlR3VpZCA9IHJlc3BvbnNlWydndWlkJ107XG4gICAgICAgICAgICBpZiAodGhpcy5vbkltYWdlVXBsb2FkZWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5vbkltYWdlVXBsb2FkZWQuZW1pdCh0aGlzLmltYWdlR3VpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlQcmV2aWV3ID0gJ3Vuc2V0JztcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyb3I6IFJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiVXBsb2FkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIHRoaXMuaW1hZ2VHdWlkID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgdXBsb2FkQmFzZTY0KGV2ZW50KSB7XG4gICAgdGhpcy5pbWFnZUd1aWQgPSAn2K/YsSDYrdin2YQg2KjYp9ix2q/YsNin2LHbjCc7XG4gICAgY29uc3QgaW5wdXRmaWxlID0gZXZlbnQuZGF0YVRyYW5zZmVyID8gZXZlbnQuZGF0YVRyYW5zZmVyIDogZXZlbnQudGFyZ2V0O1xuICAgIGNvbnN0IGltYWdlID0gdGhpcy5wcmV2aWV3SW1hZ2UubmF0aXZlRWxlbWVudDtcbiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIGlmIChpbnB1dGZpbGUuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgZmlsZTogRmlsZSA9IGlucHV0ZmlsZS5maWxlc1swXTtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgLy8gbGV0IGhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoeydDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbid9KTtcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30pO1xuICAgICAgICB0aGlzLmh0dHAucG9zdCh0aGlzLnJlc3RVcmwsICg8YW55PnJlYWRlci5yZXN1bHQpLnNwbGl0KCcsJylbMV0sIHtoZWFkZXJzOiBoZWFkZXJzfSkudG9Qcm9taXNlKClcbiAgICAgICAgICAudGhlbigocmVzcG9uc2U6IFJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzcmMgPSByZWFkZXIucmVzdWx0O1xuICAgICAgICAgICAgaW1hZ2Uuc3JjID0gc3JjO1xuICAgICAgICAgICAgdGhpcy5pbWFnZUd1aWQgPSByZXNwb25zZVsnZ3VpZCddO1xuICAgICAgICAgICAgaWYgKHRoaXMub25JbWFnZVVwbG9hZGVkKSB7XG4gICAgICAgICAgICAgIHRoaXMub25JbWFnZVVwbG9hZGVkLmVtaXQodGhpcy5pbWFnZUd1aWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5UHJldmlldyA9ICd1bnNldCc7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKGVycm9yOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlVwbG9hZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICB0aGlzLmltYWdlR3VpZCA9ICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZUltYWdlKCkge1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMucmVzdFVybH0vJHt0aGlzLmltYWdlR3VpZH1gO1xuICAgIGNvbnN0IGltYWdlID0gdGhpcy5wcmV2aWV3SW1hZ2UubmF0aXZlRWxlbWVudDtcbiAgICBpbWFnZS5zcmMgPSAnJztcbiAgICB0aGlzLm9uSW1hZ2VEZWxldGVkLmVtaXQodGhpcy5pbWFnZUd1aWQpO1xuICAgIHRoaXMuaW1hZ2VHdWlkID0gJyc7XG4gICAgdGhpcy5odHRwLmRlbGV0ZSh1cmwpLnN1YnNjcmliZShcbiAgICAgIGRhdGEgPT4ge1xuICAgICAgfSxcbiAgICAgIGVycm9yID0+IHtcbiAgICAgIH1cbiAgICApO1xuICB9XG59XG4iXX0=