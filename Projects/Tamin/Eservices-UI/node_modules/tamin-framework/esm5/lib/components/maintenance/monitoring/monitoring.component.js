/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { GenericRestService } from '../../../services/generic-rest-service/generic-rest.service';
import { Subscription, timer } from 'rxjs';
var MonitoringComponent = /** @class */ (function () {
    function MonitoringComponent(genericRestService) {
        this.genericRestService = genericRestService;
        this.refreshInterval = 60000;
        this.normalWaitingTime = 10000;
        this.warningWaitingTime = 30000;
        this.dangerWaitingTime = 50000;
        this.timeout = 60000;
        this.started = new EventEmitter();
        this.stopped = new EventEmitter();
        this.alive = false;
        this.serviceTotalRowsCollected = new Map();
        this.serviceWaitingTimes = new Map();
        this.serviceStartTimes = new Map();
        this.dbWaitingTimes = new Map();
        this.dbStartTimes = new Map();
        this.statusColor = '#bbbbbb';
        this.dbChartLabels = [];
        this.dbChartData = [];
        this.dbChartType = 'bar';
        this.dbChartOptions = {};
        this.serviceChartLabels = ['ResponseTime', 'TimeoutRange'];
        this.serviceChartData = [];
        this.serviceChartType = 'pie';
        this._subscription = new Subscription();
        this.dbChartOptions = {
            scales: {
                yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
            }
        };
    }
    /**
     * @return {?}
     */
    MonitoringComponent.prototype.startTimer = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.alive = true;
        this._subscription = timer(1000, this.refreshInterval).subscribe((/**
         * @return {?}
         */
        function () {
            _this.refreshData();
        }));
        this.started.emit();
    };
    /**
     * @return {?}
     */
    MonitoringComponent.prototype.stopTimer = /**
     * @return {?}
     */
    function () {
        if (this.alive) {
            this.alive = false;
            this._subscription.unsubscribe();
        }
        this.stopped.emit();
        this.statusColor = '#bbbbbb';
    };
    /**
     * @return {?}
     */
    MonitoringComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.serviceUrls) {
            for (var index = 0; index < this.serviceUrls.length; index++) {
                this.serviceStartTimes.set(this.serviceUrls[index], 0);
                this.serviceWaitingTimes.set(this.serviceUrls[index], 0);
                this.serviceTotalRowsCollected.set(this.serviceUrls[index], 0);
                this.serviceChartData.push({ data: [0, this.timeout], label: this.serviceUrls[index] });
            }
        }
        else {
            this.serviceChartData.push({ data: [0, 0], label: '' });
        }
        this.dbChartData.push({ data: [0, 0], label: '' });
        this.startTimer();
    };
    /**
     * @return {?}
     */
    MonitoringComponent.prototype.refreshData = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.serviceUrls.forEach((/**
         * @param {?} serviceUrl
         * @return {?}
         */
        function (serviceUrl) {
            _this.serviceStartTimes.set(serviceUrl, Date.now());
            _this.genericRestService.restUrl = serviceUrl;
            _this.genericRestService.timeout = _this.timeout;
            _this.genericRestService.getPagedObject(true, 0, 10, [], [])
                .then((/**
             * @param {?} objectResultWrapper
             * @return {?}
             */
            function (objectResultWrapper) {
                _this.serviceWaitingTimes.set(serviceUrl, Date.now() - _this.serviceStartTimes.get(serviceUrl));
                if (_this.serviceWaitingTimes.get(serviceUrl) <= _this.normalWaitingTime) {
                    _this.statusColor = 'green';
                }
                if (_this.serviceWaitingTimes.get(serviceUrl) > _this.normalWaitingTime && _this.serviceWaitingTimes.get(serviceUrl) <= _this.warningWaitingTime) {
                    _this.statusColor = 'green';
                }
                if (_this.serviceWaitingTimes.get(serviceUrl) > _this.warningWaitingTime) {
                    _this.statusColor = '#ff9900';
                }
                if (_this.serviceWaitingTimes.get(serviceUrl) > _this.dangerWaitingTime) {
                    _this.statusColor = 'red';
                }
                _this.refreshServiceChart();
            }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                _this.serviceWaitingTimes.set(serviceUrl, _this.timeout);
                _this.statusColor = 'red';
                _this.refreshServiceChart();
            }));
        }));
    };
    /**
     * @return {?}
     */
    MonitoringComponent.prototype.refreshServiceChart = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.serviceChartData = [];
        this.serviceUrls.forEach((/**
         * @param {?} serviceUrl
         * @return {?}
         */
        function (serviceUrl) {
            /** @type {?} */
            var newValue = _this.timeout - _this.serviceWaitingTimes.get(serviceUrl);
            if (newValue < 0) {
                newValue = 0;
            }
            _this.serviceChartData.push({ data: [_this.serviceWaitingTimes.get(serviceUrl), newValue], label: serviceUrl });
        }));
    };
    /**
     * @return {?}
     */
    MonitoringComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._subscription.unsubscribe();
    };
    /**
     * @param {?} e
     * @return {?}
     */
    MonitoringComponent.prototype.serviceChartClicked = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
    };
    /**
     * @param {?} e
     * @return {?}
     */
    MonitoringComponent.prototype.serviceChartHovered = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
    };
    /**
     * @param {?} e
     * @return {?}
     */
    MonitoringComponent.prototype.dbChartClicked = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
    };
    /**
     * @param {?} e
     * @return {?}
     */
    MonitoringComponent.prototype.dbChartHovered = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
    };
    MonitoringComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tamin-monitoring',
                    template: "<div class=\"mnt-container\">\n  <div class=\"mnt-item\">\n    <div class=\"mnt-title\" [style.background-color]=\"this.statusColor\">\n      <div style=\"float: right\">\n        <i\n          [class.icon-cog-alt]=\"type == 'service'\"\n          [class.icon-database]=\"type == 'database'\"\n        ></i>\n        <span style=\"margin-right: 5px;\">{{title}}</span>\n      </div>\n      <div style=\"float: left\">\n        <i (click)=\"alive ? stopTimer() : startTimer()\"\n           [style.color]=\"alive ? 'white' : 'red'\"\n           [class.icon-stop]=\"!alive\"\n           [class.icon-play]=\"alive\"></i>\n      </div>\n    </div>\n    <div [style.visibility]=\"alive ? 'visible' : 'hidden'\">\n      <tamin-chart\n        lib=\"assets/vendor/chart.min.js\"\n        [datasets]=\"serviceChartData\"\n        [labels]=\"serviceChartLabels\"\n        [chartType]=\"serviceChartType\"\n        (chartHover)=\"serviceChartHovered($event)\"\n        (chartClick)=\"serviceChartClicked($event)\">\n      </tamin-chart>\n    </div>\n    <div class=\"mnt-item\" *ngIf=\"viewType == 'full'\">\n      <div class=\"part-title\">\n        \u0627\u0637\u0644\u0627\u0639\u0627\u062A \u062A\u06A9\u0645\u06CC\u0644\u06CC\n      </div>\n      <div *ngFor=\"let serviceUrl of serviceUrls\" style=\"font-size: 1.0em;\">\n        <span>{{type == 'service' ? '\u0645\u0633\u06CC\u0631' :'\u06A9\u0648\u0626\u0631\u06CC'}}</span>\n        <span style=\"font-size: 0.7em;\">{{serviceUrl}}</span>\n        <br/>\n        \u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC : <span\n        [style.color]=\"statusColor\">{{serviceWaitingTimes.get(serviceUrl)}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n        <hr/>\n      </div>\n    </div>\n    <div class=\"mnt-item\" *ngIf=\"viewType == 'full'\">\n      <div class=\"part-title\">\n        \u062A\u0646\u0638\u06CC\u0645\u0627\u062A\n      </div>\n      <span style=\"font-size: 0.7em; color: green;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC \u0646\u0631\u0645\u0627\u0644 : {{normalWaitingTime}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n      <br/>\n      <span style=\"font-size: 0.7em; color: orange;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC \u0627\u062E\u0637\u0627\u0631 : {{warningWaitingTime}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n      <br/>\n      <span style=\"font-size: 0.7em; color: red;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC \u0628\u062D\u0631\u0627\u0646\u06CC : {{dangerWaitingTime}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n      <br/>\n      <span style=\"font-size: 0.7em;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u062A\u0627\u06CC\u0645 \u0627\u0648\u062A : {{timeout}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n      <br/>\n      <span style=\"font-size: 0.7em;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u062A\u0644\u0627\u0634 \u0645\u062C\u062F\u062F : {{refreshInterval}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n    </div>\n  </div>\n</div>\n\n<!--\n<div class=\"row\">\n  <div class=\"col-6\">\n    <div style=\"border: solid 1px #aaa; margin:1px; padding: 5px;\">\n      <div class=\"part-title\">\n        \u0648\u0636\u0639\u06CC\u062A \u0633\u0631\u0648\u06CC\u0633\n      </div>\n      <tamin-chart\n        lib=\"assets/vendor/chart.min.js\"\n        [datasets]=\"serviceChartData\"\n        [labels]=\"serviceChartLabels\"\n        [chartType]=\"serviceChartType\"\n        (chartHover)=\"serviceChartHovered($event)\"\n        (chartClick)=\"serviceChartClicked($event)\">\n      </tamin-chart>\n    </div>\n  </div>\n  <div class=\"col-6\">\n    <div style=\"border: solid 1px #aaa; margin:1px; padding: 5px;\">\n      <div class=\"part-title\">\n        \u0648\u0636\u0639\u06CC\u062A \u067E\u0627\u06CC\u06AF\u0627\u0647 \u062F\u0627\u062F\u0647\n      </div>\n      <tamin-chart\n        lib=\"assets/vendor/chart.min.js\"\n        [datasets]=\"dbChartData\"\n        [labels]=\"dbChartLabels\"\n        [chartType]=\"dbChartType\"\n        [options]=\"dbChartOptions\"\n        (chartHover)=\"dbChartHovered($event)\"\n        (chartClick)=\"dbChartClicked($event)\">\n      </tamin-chart>\n    </div>\n  </div>\n  <div class=\"col-12 \" *ngIf=\"viewType === 'full'\">\n    <div style=\"border: solid 1px #aaa; margin:1px; padding: 5px;\">\n      <div class=\"part-title\">\n        \u0627\u0637\u0644\u0627\u0639\u0627\u062A \u062A\u06A9\u0645\u06CC\u0644\u06CC\n      </div>\n      <div *ngFor=\"let serviceUrl of serviceUrls\" style=\"font-size: 1.0em;\">\n        \u0645\u0633\u06CC\u0631 \u0633\u0631\u0648\u06CC\u0633 : <span style=\"font-size: 0.7em;\">{{serviceUrl}}</span>\n        <br/>\n        \u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC \u0633\u0631\u0648\u06CC\u0633 : <span\n        [style.color]=\"statusColor\">{{serviceWaitingTimes.get(serviceUrl)}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n        <hr/>\n      </div>\n      <div *ngFor=\"let query of dbQueries\" style=\"font-size: 1.0em;\">\n        \u06A9\u0648\u0626\u0631\u06CC \u062F\u06CC\u062A\u0627\u0628\u06CC\u0633 : <span style=\"font-size: 0.7em;\">{{query}}</span>\n        <br/>\n        \u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC \u062F\u06CC\u062A\u0627\u0628\u06CC\u0633 : <span [style.color]=\"statusColor\">{{dbWaitingTimes.get(query)}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n        <hr/>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-12 col-s-12\" *ngIf=\"viewType === 'full'\">\n    <div style=\"border: solid 1px #aaa; margin:1px; padding: 5px;\">\n      <div class=\"part-title\">\n        \u062A\u0646\u0638\u06CC\u0645\u0627\u062A\n      </div>\n      <span style=\"font-size: 0.7em; color: green;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC \u0646\u0631\u0645\u0627\u0644 : {{normalWaitingTime}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n      <br/>\n      <span style=\"font-size: 0.7em; color: orange;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC \u0627\u062E\u0637\u0627\u0631 : {{warningWaitingTime}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n      <br/>\n      <span style=\"font-size: 0.7em; color: red;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u067E\u0627\u0633\u062E\u06AF\u0648\u06CC\u06CC \u0628\u062D\u0631\u0627\u0646\u06CC : {{dangerWaitingTime}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n      <br/>\n      <span style=\"font-size: 0.7em;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u062A\u0627\u06CC\u0645 \u0627\u0648\u062A : {{timeout}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n      <br/>\n      <span style=\"font-size: 0.7em;\">\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u062A\u0644\u0627\u0634 \u0645\u062C\u062F\u062F : {{refreshInterval}} \u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647</span>\n    </div>\n  </div>\n</div>\n-->\n",
                    styles: [".mnt-container{display:flex;flex-wrap:wrap;align-content:space-around;align-items:stretch}.mnt-item{border:1px solid #aaa;margin:1px;padding:5px}.mnt-title{overflow:hidden;margin:-4px;padding:5px;color:#fff}.blurred{-webkit-filter:blur(10px);filter:blur(10px)}"]
                }] }
    ];
    /** @nocollapse */
    MonitoringComponent.ctorParameters = function () { return [
        { type: GenericRestService }
    ]; };
    MonitoringComponent.propDecorators = {
        serviceUrls: [{ type: Input }],
        refreshInterval: [{ type: Input }],
        id: [{ type: Input }],
        type: [{ type: Input }],
        title: [{ type: Input }],
        normalWaitingTime: [{ type: Input }],
        warningWaitingTime: [{ type: Input }],
        dangerWaitingTime: [{ type: Input }],
        timeout: [{ type: Input }],
        viewType: [{ type: Input }],
        started: [{ type: Output }],
        stopped: [{ type: Output }]
    };
    return MonitoringComponent;
}());
export { MonitoringComponent };
if (false) {
    /** @type {?} */
    MonitoringComponent.prototype.serviceUrls;
    /** @type {?} */
    MonitoringComponent.prototype.refreshInterval;
    /** @type {?} */
    MonitoringComponent.prototype.id;
    /** @type {?} */
    MonitoringComponent.prototype.type;
    /** @type {?} */
    MonitoringComponent.prototype.title;
    /** @type {?} */
    MonitoringComponent.prototype.normalWaitingTime;
    /** @type {?} */
    MonitoringComponent.prototype.warningWaitingTime;
    /** @type {?} */
    MonitoringComponent.prototype.dangerWaitingTime;
    /** @type {?} */
    MonitoringComponent.prototype.timeout;
    /** @type {?} */
    MonitoringComponent.prototype.viewType;
    /** @type {?} */
    MonitoringComponent.prototype.started;
    /** @type {?} */
    MonitoringComponent.prototype.stopped;
    /** @type {?} */
    MonitoringComponent.prototype.lastStatus;
    /** @type {?} */
    MonitoringComponent.prototype.alive;
    /** @type {?} */
    MonitoringComponent.prototype.serviceTotalRowsCollected;
    /** @type {?} */
    MonitoringComponent.prototype.serviceWaitingTimes;
    /** @type {?} */
    MonitoringComponent.prototype.serviceStartTimes;
    /** @type {?} */
    MonitoringComponent.prototype.dbWaitingTimes;
    /** @type {?} */
    MonitoringComponent.prototype.dbStartTimes;
    /** @type {?} */
    MonitoringComponent.prototype.statusColor;
    /** @type {?} */
    MonitoringComponent.prototype.dbChartLabels;
    /** @type {?} */
    MonitoringComponent.prototype.dbChartData;
    /** @type {?} */
    MonitoringComponent.prototype.dbChartType;
    /** @type {?} */
    MonitoringComponent.prototype.dbChartOptions;
    /** @type {?} */
    MonitoringComponent.prototype.serviceChartLabels;
    /** @type {?} */
    MonitoringComponent.prototype.serviceChartData;
    /** @type {?} */
    MonitoringComponent.prototype.serviceChartType;
    /**
     * @type {?}
     * @private
     */
    MonitoringComponent.prototype._subscription;
    /**
     * @type {?}
     * @private
     */
    MonitoringComponent.prototype.genericRestService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uaXRvcmluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90YW1pbi1mcmFtZXdvcmsvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9tYWludGVuYW5jZS9tb25pdG9yaW5nL21vbml0b3JpbmcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXFCLE1BQU0sRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN4RixPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSw2REFBNkQsQ0FBQztBQUMvRixPQUFPLEVBQUMsWUFBWSxFQUFFLEtBQUssRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUV6QztJQXdDRSw2QkFBb0Isa0JBQTJDO1FBQTNDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBeUI7UUFqQ3RELG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBSXhCLHNCQUFpQixHQUFHLEtBQUssQ0FBQztRQUMxQix1QkFBa0IsR0FBRyxLQUFLLENBQUM7UUFDM0Isc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzFCLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFFZixZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUNuQyxZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUU3QyxVQUFLLEdBQUcsS0FBSyxDQUFDO1FBRWQsOEJBQXlCLEdBQXdCLElBQUksR0FBRyxFQUFrQixDQUFDO1FBQzNFLHdCQUFtQixHQUF3QixJQUFJLEdBQUcsRUFBa0IsQ0FBQztRQUNyRSxzQkFBaUIsR0FBd0IsSUFBSSxHQUFHLEVBQWtCLENBQUM7UUFDbkUsbUJBQWMsR0FBd0IsSUFBSSxHQUFHLEVBQWtCLENBQUM7UUFDaEUsaUJBQVksR0FBd0IsSUFBSSxHQUFHLEVBQWtCLENBQUM7UUFDOUQsZ0JBQVcsR0FBRyxTQUFTLENBQUM7UUFFeEIsa0JBQWEsR0FBYSxFQUFFLENBQUM7UUFD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QUVELGlEQUFtQjs7OztJQUFuQixVQUFvQixDQUFNO0lBQzFCLENBQUM7Ozs7O0lBRUQsNENBQWM7Ozs7SUFBZCxVQUFlLENBQU07SUFDckIsQ0FBQzs7Ozs7SUFFRCw0Q0FBYzs7OztJQUFkLFVBQWUsQ0FBTTtJQUNyQixDQUFDOztnQkFqSkYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxrQkFBa0I7b0JBQzVCLHVzT0FBMEM7O2lCQUUzQzs7OztnQkFQTyxrQkFBa0I7Ozs4QkFTdkIsS0FBSztrQ0FDTCxLQUFLO3FCQUNMLEtBQUs7dUJBQ0wsS0FBSzt3QkFDTCxLQUFLO29DQUNMLEtBQUs7cUNBQ0wsS0FBSztvQ0FDTCxLQUFLOzBCQUNMLEtBQUs7MkJBQ0wsS0FBSzswQkFDTCxNQUFNOzBCQUNOLE1BQU07O0lBaUlULDBCQUFDO0NBQUEsQUFsSkQsSUFrSkM7U0E3SVksbUJBQW1COzs7SUFDOUIsMENBQStCOztJQUMvQiw4Q0FBaUM7O0lBQ2pDLGlDQUFvQjs7SUFDcEIsbUNBQXNDOztJQUN0QyxvQ0FBdUI7O0lBQ3ZCLGdEQUFtQzs7SUFDbkMsaURBQW9DOztJQUNwQyxnREFBbUM7O0lBQ25DLHNDQUF5Qjs7SUFDekIsdUNBQXNDOztJQUN0QyxzQ0FBNkM7O0lBQzdDLHNDQUE2Qzs7SUFDN0MseUNBQTRDOztJQUM1QyxvQ0FBYzs7SUFFZCx3REFBMkU7O0lBQzNFLGtEQUFxRTs7SUFDckUsZ0RBQW1FOztJQUNuRSw2Q0FBZ0U7O0lBQ2hFLDJDQUE4RDs7SUFDOUQsMENBQXdCOztJQUV4Qiw0Q0FBNkI7O0lBQzdCLDBDQUF3Qjs7SUFDeEIsMENBQW9COztJQUNwQiw2Q0FBb0I7O0lBRXBCLGlEQUFnRTs7SUFDaEUsK0NBQTZCOztJQUM3QiwrQ0FBeUI7Ozs7O0lBRXpCLDRDQUEyQzs7Ozs7SUFHL0IsaURBQW1EIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtHZW5lcmljUmVzdFNlcnZpY2V9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL2dlbmVyaWMtcmVzdC1zZXJ2aWNlL2dlbmVyaWMtcmVzdC5zZXJ2aWNlJztcbmltcG9ydCB7U3Vic2NyaXB0aW9uLCB0aW1lcn0gZnJvbSAncnhqcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RhbWluLW1vbml0b3JpbmcnLFxuICB0ZW1wbGF0ZVVybDogJy4vbW9uaXRvcmluZy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL21vbml0b3JpbmcuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBNb25pdG9yaW5nQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBzZXJ2aWNlVXJsczogc3RyaW5nW107XG4gIEBJbnB1dCgpIHJlZnJlc2hJbnRlcnZhbCA9IDYwMDAwO1xuICBASW5wdXQoKSBpZDogc3RyaW5nO1xuICBASW5wdXQoKSB0eXBlOiAnc2VydmljZScgfCAnZGF0YWJhc2UnO1xuICBASW5wdXQoKSB0aXRsZTogc3RyaW5nO1xuICBASW5wdXQoKSBub3JtYWxXYWl0aW5nVGltZSA9IDEwMDAwO1xuICBASW5wdXQoKSB3YXJuaW5nV2FpdGluZ1RpbWUgPSAzMDAwMDtcbiAgQElucHV0KCkgZGFuZ2VyV2FpdGluZ1RpbWUgPSA1MDAwMDtcbiAgQElucHV0KCkgdGltZW91dCA9IDYwMDAwO1xuICBASW5wdXQoKSB2aWV3VHlwZTogJ2Z1bGwnIHwgJ2NvbXBhY3QnO1xuICBAT3V0cHV0KCkgc3RhcnRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgQE91dHB1dCgpIHN0b3BwZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG4gIGxhc3RTdGF0dXM6ICdub3JtYWwnIHwgJ3dhcm5pbmcnIHwgJ2Rhbmdlcic7XG4gIGFsaXZlID0gZmFsc2U7XG5cbiAgc2VydmljZVRvdGFsUm93c0NvbGxlY3RlZDogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gIHNlcnZpY2VXYWl0aW5nVGltZXM6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICBzZXJ2aWNlU3RhcnRUaW1lczogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gIGRiV2FpdGluZ1RpbWVzOiBNYXA8c3RyaW5nLCBudW1iZXI+ID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgZGJTdGFydFRpbWVzOiBNYXA8c3RyaW5nLCBudW1iZXI+ID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgc3RhdHVzQ29sb3IgPSAnI2JiYmJiYic7XG5cbiAgZGJDaGFydExhYmVsczogc3RyaW5nW10gPSBbXTtcbiAgZGJDaGFydERhdGE6IGFueVtdID0gW107XG4gIGRiQ2hhcnRUeXBlID0gJ2Jhcic7XG4gIGRiQ2hhcnRPcHRpb25zID0ge307XG5cbiAgc2VydmljZUNoYXJ0TGFiZWxzOiBzdHJpbmdbXSA9IFsnUmVzcG9uc2VUaW1lJywgJ1RpbWVvdXRSYW5nZSddO1xuICBzZXJ2aWNlQ2hhcnREYXRhOiBhbnlbXSA9IFtdO1xuICBzZXJ2aWNlQ2hhcnRUeXBlID0gJ3BpZSc7XG5cbiAgcHJpdmF0ZSBfc3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBnZW5lcmljUmVzdFNlcnZpY2U6IEdlbmVyaWNSZXN0U2VydmljZTxhbnk+KSB7XG4gICAgdGhpcy5kYkNoYXJ0T3B0aW9ucyA9IHtcbiAgICAgIHNjYWxlczoge1xuICAgICAgICB5QXhlczogW3tcbiAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHN0YXJ0VGltZXIoKSB7XG4gICAgdGhpcy5hbGl2ZSA9IHRydWU7XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uID0gdGltZXIoMTAwMCwgdGhpcy5yZWZyZXNoSW50ZXJ2YWwpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMucmVmcmVzaERhdGEoKTtcbiAgICAgIH1cbiAgICApO1xuICAgIHRoaXMuc3RhcnRlZC5lbWl0KCk7XG4gIH1cblxuICBzdG9wVGltZXIoKSB7XG4gICAgaWYgKHRoaXMuYWxpdmUpIHtcbiAgICAgIHRoaXMuYWxpdmUgPSBmYWxzZTtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICB0aGlzLnN0b3BwZWQuZW1pdCgpO1xuICAgIHRoaXMuc3RhdHVzQ29sb3IgPSAnI2JiYmJiYic7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAodGhpcy5zZXJ2aWNlVXJscykge1xuICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuc2VydmljZVVybHMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIHRoaXMuc2VydmljZVN0YXJ0VGltZXMuc2V0KHRoaXMuc2VydmljZVVybHNbaW5kZXhdLCAwKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlV2FpdGluZ1RpbWVzLnNldCh0aGlzLnNlcnZpY2VVcmxzW2luZGV4XSwgMCk7XG4gICAgICAgIHRoaXMuc2VydmljZVRvdGFsUm93c0NvbGxlY3RlZC5zZXQodGhpcy5zZXJ2aWNlVXJsc1tpbmRleF0sIDApO1xuICAgICAgICB0aGlzLnNlcnZpY2VDaGFydERhdGEucHVzaChcbiAgICAgICAgICB7ZGF0YTogWzAsIHRoaXMudGltZW91dF0sIGxhYmVsOiB0aGlzLnNlcnZpY2VVcmxzW2luZGV4XX1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXJ2aWNlQ2hhcnREYXRhLnB1c2goe2RhdGE6IFswLCAwXSwgbGFiZWw6ICcnfSk7XG4gICAgfVxuXG4gICAgdGhpcy5kYkNoYXJ0RGF0YS5wdXNoKHtkYXRhOiBbMCwgMF0sIGxhYmVsOiAnJ30pO1xuICAgIHRoaXMuc3RhcnRUaW1lcigpO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2hEYXRhKCkge1xuICAgIHRoaXMuc2VydmljZVVybHMuZm9yRWFjaChzZXJ2aWNlVXJsID0+IHtcbiAgICAgIHRoaXMuc2VydmljZVN0YXJ0VGltZXMuc2V0KHNlcnZpY2VVcmwsIERhdGUubm93KCkpO1xuICAgICAgdGhpcy5nZW5lcmljUmVzdFNlcnZpY2UucmVzdFVybCA9IHNlcnZpY2VVcmw7XG4gICAgICB0aGlzLmdlbmVyaWNSZXN0U2VydmljZS50aW1lb3V0ID0gdGhpcy50aW1lb3V0O1xuICAgICAgdGhpcy5nZW5lcmljUmVzdFNlcnZpY2UuZ2V0UGFnZWRPYmplY3QodHJ1ZSwgMCwgMTAsIFtdLCBbXSlcbiAgICAgICAgLnRoZW4ob2JqZWN0UmVzdWx0V3JhcHBlciA9PiB7XG4gICAgICAgICAgdGhpcy5zZXJ2aWNlV2FpdGluZ1RpbWVzLnNldChzZXJ2aWNlVXJsLCBEYXRlLm5vdygpIC0gdGhpcy5zZXJ2aWNlU3RhcnRUaW1lcy5nZXQoc2VydmljZVVybCkpO1xuICAgICAgICAgIGlmICh0aGlzLnNlcnZpY2VXYWl0aW5nVGltZXMuZ2V0KHNlcnZpY2VVcmwpIDw9IHRoaXMubm9ybWFsV2FpdGluZ1RpbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQ29sb3IgPSAnZ3JlZW4nO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5zZXJ2aWNlV2FpdGluZ1RpbWVzLmdldChzZXJ2aWNlVXJsKSA+IHRoaXMubm9ybWFsV2FpdGluZ1RpbWUgJiYgdGhpcy5zZXJ2aWNlV2FpdGluZ1RpbWVzLmdldChzZXJ2aWNlVXJsKSA8PSB0aGlzLndhcm5pbmdXYWl0aW5nVGltZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNDb2xvciA9ICdncmVlbic7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0aGlzLnNlcnZpY2VXYWl0aW5nVGltZXMuZ2V0KHNlcnZpY2VVcmwpID4gdGhpcy53YXJuaW5nV2FpdGluZ1RpbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQ29sb3IgPSAnI2ZmOTkwMCc7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0aGlzLnNlcnZpY2VXYWl0aW5nVGltZXMuZ2V0KHNlcnZpY2VVcmwpID4gdGhpcy5kYW5nZXJXYWl0aW5nVGltZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNDb2xvciA9ICdyZWQnO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnJlZnJlc2hTZXJ2aWNlQ2hhcnQoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICB0aGlzLnNlcnZpY2VXYWl0aW5nVGltZXMuc2V0KHNlcnZpY2VVcmwsIHRoaXMudGltZW91dCk7XG4gICAgICAgICAgdGhpcy5zdGF0dXNDb2xvciA9ICdyZWQnO1xuICAgICAgICAgIHRoaXMucmVmcmVzaFNlcnZpY2VDaGFydCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlZnJlc2hTZXJ2aWNlQ2hhcnQoKSB7XG4gICAgdGhpcy5zZXJ2aWNlQ2hhcnREYXRhID0gW107XG4gICAgdGhpcy5zZXJ2aWNlVXJscy5mb3JFYWNoKHNlcnZpY2VVcmwgPT4ge1xuICAgICAgbGV0IG5ld1ZhbHVlID0gdGhpcy50aW1lb3V0IC0gdGhpcy5zZXJ2aWNlV2FpdGluZ1RpbWVzLmdldChzZXJ2aWNlVXJsKTtcbiAgICAgIGlmIChuZXdWYWx1ZSA8IDApIHtcbiAgICAgICAgbmV3VmFsdWUgPSAwO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXJ2aWNlQ2hhcnREYXRhLnB1c2goXG4gICAgICAgIHtkYXRhOiBbdGhpcy5zZXJ2aWNlV2FpdGluZ1RpbWVzLmdldChzZXJ2aWNlVXJsKSwgbmV3VmFsdWVdLCBsYWJlbDogc2VydmljZVVybH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIHNlcnZpY2VDaGFydENsaWNrZWQoZTogYW55KTogdm9pZCB7XG4gIH1cblxuICBzZXJ2aWNlQ2hhcnRIb3ZlcmVkKGU6IGFueSk6IHZvaWQge1xuICB9XG5cbiAgZGJDaGFydENsaWNrZWQoZTogYW55KTogdm9pZCB7XG4gIH1cblxuICBkYkNoYXJ0SG92ZXJlZChlOiBhbnkpOiB2b2lkIHtcbiAgfVxufVxuIl19