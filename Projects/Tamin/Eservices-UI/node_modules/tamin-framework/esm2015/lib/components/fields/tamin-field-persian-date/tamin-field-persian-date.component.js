/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, forwardRef, Input, ViewChild } from '@angular/core';
// import * as momentNs from 'jalali-moment';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { FieldBaseComponent } from '../../../base/field-base.component';
import { TaminPersianDatePickerComponent } from '../../tamin-persian-date-picker/tamin-persian-date-picker.component';
import { PickerContainerComponent } from '../../containers/picker-container/picker-container.component';
import { TaminPersianDate } from '../../../tamin-persian-date';
// const moment = momentNs;
// declare let persianDate: any;
export class TaminFieldPersianDateComponent extends FieldBaseComponent {
    /**
     * @param {?} val
     * @return {?}
     */
    set value(val) {
        // const tmp = moment(new Date(val));
        // const tmp = new persianDate(new Date(val));
        /** @type {?} */
        const tmp = TaminPersianDate.GregorianToJalali(new Date(val));
        // this.inputElement.nativeElement.value = tmp.toLocale('en').format('YYYY/MM/DD');
        this.inputElement.nativeElement.value = tmp;
    }
    /**
     * @protected
     * @param {?} val
     * @return {?}
     */
    getValue(val) {
        if (val.length === 8) {
            /** @type {?} */
            const yyyy = val.substr(0, 4);
            /** @type {?} */
            const mm = val.substr(4, 2);
            /** @type {?} */
            const dd = val.substr(6, 2);
            /** @type {?} */
            const input = [Number(yyyy), Number(mm), Number(dd), 0, 0, 0];
            // return (new persianDate(input)).toDate();
            return TaminPersianDate.JalaliToGregorian(Number(yyyy), Number(mm), Number(dd));
        }
        return '';
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (value === '' || value === undefined || value === null) {
                this.inputElement.nativeElement.value = '';
                return;
            }
            // const tmp = new persianDate(new Date(value));
            /** @type {?} */
            const tmp = TaminPersianDate.GregorianToJalali(new Date(value));
            // this.inputElement.nativeElement.value = tmp.toLocale('en').format('YYYY/MM/DD'); // tmp.locale('fa').format('YYYY/MM/DD');
            this.inputElement.nativeElement.value = tmp;
            /*
                  if (!this.maskRef) {
                    this._setInputMask();
                  }
                  this.maskRef.updateValue();
            */
            this.maskRef.updateValue();
            this.onChange(value);
        }), 0);
    }
    /**
     * @return {?}
     */
    initializeComponent() {
        this._setInputMask();
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.picker.parent = this.inputElement;
            this.picker.button = this.iconElement;
        }), 0);
    }
    /**
     * @return {?}
     */
    get value() {
        // return moment.from(this.inputElement.nativeElement.value, 'fa', 'YYYY/MM/DD').toDate();
        /** @type {?} */
        const tmp = this.inputElement.nativeElement.value.split('/');
        /** @type {?} */
        const input = [Number(tmp[0]), Number(tmp[1]), Number(tmp[2]), 0, 0, 0];
        // return (new persianDate(input)).toDate();
        return (TaminPersianDate.JalaliToGregorian(Number(tmp[0]), Number(tmp[1]), Number(tmp[2])));
    }
    /**
     * @return {?}
     */
    onShowPicker() {
        if (this.control.disabled) {
            return;
        }
        this.inputElement.nativeElement.focus();
        this.picker.toggle();
    }
    /**
     * @return {?}
     */
    hidePopup() {
        // this.pickerVisibility = 'hidden';
        this.picker.hide();
        this.inputElement.nativeElement.readOnly = false;
    }
    /**
     * @return {?}
     */
    showPopup() {
        this.inputElement.nativeElement.readOnly = true;
        /** @type {?} */
        const val = this.inputElement.nativeElement.value;
        // const tmp = moment.from(val, 'fa', 'YYYY/MM/DD');
        /** @type {?} */
        const t = this.inputElement.nativeElement.value.split('/');
        /** @type {?} */
        const input = [Number(t[0]), Number(t[1]), Number(t[2]), 23, 0, 0];
        // const tmp = (new persianDate(input));
        /** @type {?} */
        const tmp = TaminPersianDate.JalaliToGregorian(Number(t[0]), Number(t[1]), Number(t[2]));
        // if (tmp.isValid()) {
        // this.persianDatePicker.currentDate = new Date(tmp.toDate());
        this.persianDatePicker.currentDate = tmp;
        // }
        this.persianDatePicker.setView();
        this.picker.show();
        // this._thePopper.update();
    }
    /**
     * @param {?} val
     * @return {?}
     */
    onPickerChange(val) {
        if (val !== undefined) {
            this.inputElement.nativeElement.focus();
            this.value = val;
            this.onChange(this.value);
            this.hidePopup();
        }
    }
    /**
     * @private
     * @return {?}
     */
    _setInputMask() {
        this.maskRef = new IMask(this.inputElement.nativeElement, {
            mask: 'YYYY/MM/DD',
            blocks: {
                DD: {
                    mask: IMask.MaskedRange,
                    from: 1,
                    to: 31,
                    validate: (/**
                     * @param {?} value
                     * @param {?} masked
                     * @return {?}
                     */
                    function (value, masked) {
                        try {
                            /** @type {?} */
                            const tmp = masked.parent._value.split('/');
                            /** @type {?} */
                            const yyyy = tmp[0];
                            /** @type {?} */
                            const mm = tmp[1];
                            /** @type {?} */
                            const dd = value;
                            // let theDate;
                            // theDate = moment.from(`${yyyy}/${mm}/${dd}`, 'fa', 'YYYY/MM/DD');
                            // return theDate.isValid();
                            // const result = new persianDate([Number(yyyy), Number(mm), Number(dd), 0, 0, 0, 0]);
                            /** @type {?} */
                            const result = TaminPersianDate.JalaliToGregorian(Number(yyyy), Number(mm), Number(dd));
                            return result !== null;
                        }
                        catch (e) {
                            return false;
                        }
                    })
                },
                MM: {
                    mask: IMask.MaskedRange,
                    from: 1,
                    to: 12
                },
                YYYY: {
                    mask: IMask.MaskedRange,
                    from: 1000,
                    to: 9999
                },
            },
            placeholderLazy: false,
        });
    }
}
TaminFieldPersianDateComponent.decorators = [
    { type: Component, args: [{
                selector: 'tamin-field-persian-date',
                template: "<div class=\"input-wrapper\">\n  <input\n    id=\"textbox\"\n    style=\"direction: ltr; padding-left: 35px;\"\n    type=\"text\"\n    [disabled]=\"control.disabled\"\n    class=\"tamin-form-control-input\"\n    [class.tamin-form-control-valid]=\"control.touched && control.valid\"\n    [class.tamin-form-control-invalid]=\"control.touched && !control.valid\"\n    #inputElement>\n  <span class=\"icon\" #icon>\n    <i\n      class=\"icon-calendar\"\n      style=\"font-size: 1.5em\"\n      (click)=\"onShowPicker()\"\n      [class.tamin-form-control-valid-icon]=\"control.touched && control.valid\"\n      [class.tamin-form-control-invalid-icon]=\"control.touched && !control.valid\"\n      #iconElement></i>\n  </span>\n</div>\n\n\n<tamin-picker-container #picker [adjustWidth]=\"false\" placement=\"bottom-start\">\n  <tamin-persian-date-picker\n    #persianDatePicker\n    (dateChanged)=\"onPickerChange($event)\"\n    (cancel)=\"hidePopup()\">\n  </tamin-persian-date-picker>\n</tamin-picker-container>\n\n<!--<div #picker class=\"picker-container\" style=\"visibility: hidden;margin-top: 5px;margin-bottom: 5px\"-->\n<!--[style.visibility]=\"pickerVisibility\">-->\n<!--</div>-->\n\n",
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => TaminFieldPersianDateComponent)),
                        multi: true
                    }
                ],
                styles: [".input-wrapper{position:relative}.icon{position:absolute;top:25%;left:5px;height:10px;margin-top:-5px;cursor:pointer}"]
            }] }
];
TaminFieldPersianDateComponent.propDecorators = {
    picker: [{ type: ViewChild, args: ['picker',] }],
    persianDatePicker: [{ type: ViewChild, args: ['persianDatePicker',] }],
    iconElement: [{ type: ViewChild, args: ['icon',] }],
    value: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    TaminFieldPersianDateComponent.prototype.picker;
    /** @type {?} */
    TaminFieldPersianDateComponent.prototype.persianDatePicker;
    /** @type {?} */
    TaminFieldPersianDateComponent.prototype.iconElement;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFtaW4tZmllbGQtcGVyc2lhbi1kYXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RhbWluLWZyYW1ld29yay8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpZWxkcy90YW1pbi1maWVsZC1wZXJzaWFuLWRhdGUvdGFtaW4tZmllbGQtcGVyc2lhbi1kYXRlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7O0FBRWxGLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLG9DQUFvQyxDQUFDO0FBQ3RFLE9BQU8sRUFBQywrQkFBK0IsRUFBQyxNQUFNLHFFQUFxRSxDQUFDO0FBQ3BILE9BQU8sRUFBQyx3QkFBd0IsRUFBQyxNQUFNLDhEQUE4RCxDQUFDO0FBQ3RHLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDZCQUE2QixDQUFDOzs7QUFvQjdELE1BQU0sT0FBTyw4QkFBK0IsU0FBUSxrQkFBa0I7Ozs7O0lBS3BFLElBQWEsS0FBSyxDQUFDLEdBQVM7Ozs7Y0FHcEIsR0FBRyxHQUFHLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdELG1GQUFtRjtRQUNuRixJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO0lBQzlDLENBQUM7Ozs7OztJQUVTLFFBQVEsQ0FBQyxHQUFXO1FBQzVCLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7O2tCQUNkLElBQUksR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7O2tCQUN2QixFQUFFLEdBQUcsR0FBRyxDQUFD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LENBQUMsV0FBVztvQkFDdkIsSUFBSSxFQUFFLElBQUk7b0JBQ1YsRUFBRSxFQUFFLElBQUk7aUJBQ1Q7YUFDRjtZQUNELGVBQWUsRUFBRSxLQUFLO1NBQ3ZCLENBQUMsQ0FBQztJQUNMLENBQUM7OztZQXpKRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLDBCQUEwQjtnQkFDcEMsaXJDQUF3RDtnQkFFeEQsU0FBUyxFQUFFO29CQUNUO3dCQUNFLE9BQU8sRUFBRSxpQkFBaUI7d0JBQzFCLFdBQVcsRUFBRSxVQUFVOzs7d0JBQUMsR0FBRyxFQUFFLENBQUMsOEJBQThCLEVBQUM7d0JBQzdELEtBQUssRUFBRSxJQUFJO3FCQUNaO2lCQUNGOzthQUNGOzs7cUJBRUUsU0FBUyxTQUFDLFFBQVE7Z0NBQ2xCLFNBQVMsU0FBQyxtQkFBbUI7MEJBQzdCLFNBQVMsU0FBQyxNQUFNO29CQUVoQixLQUFLOzs7O0lBSk4sZ0RBQXNEOztJQUN0RCwyREFBbUY7O0lBQ25GLHFEQUEyQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBFbGVtZW50UmVmLCBmb3J3YXJkUmVmLCBJbnB1dCwgVmlld0NoaWxkfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbi8vIGltcG9ydCAqIGFzIG1vbWVudE5zIGZyb20gJ2phbGFsaS1tb21lbnQnO1xuaW1wb3J0IHtOR19WQUxVRV9BQ0NFU1NPUn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtGaWVsZEJhc2VDb21wb25lbnR9IGZyb20gJy4uLy4uLy4uL2Jhc2UvZmllbGQtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHtUYW1pblBlcnNpYW5EYXRlUGlja2VyQ29tcG9uZW50fSBmcm9tICcuLi8uLi90YW1pbi1wZXJzaWFuLWRhdGUtcGlja2VyL3RhbWluLXBlcnNpYW4tZGF0ZS1waWNrZXIuY29tcG9uZW50JztcbmltcG9ydCB7UGlja2VyQ29udGFpbmVyQ29tcG9uZW50fSBmcm9tICcuLi8uLi9jb250YWluZXJzL3BpY2tlci1jb250YWluZXIvcGlja2VyLWNvbnRhaW5lci5jb21wb25lbnQnO1xuaW1wb3J0IHtUYW1pblBlcnNpYW5EYXRlfSBmcm9tICcuLi8uLi8uLi90YW1pbi1wZXJzaWFuLWRhdGUnO1xuXG5kZWNsYXJlIGxldCBJTWFzazogYW55O1xuXG4vLyBjb25zdCBtb21lbnQgPSBtb21lbnROcztcblxuLy8gZGVjbGFyZSBsZXQgcGVyc2lhbkRhdGU6IGFueTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGFtaW4tZmllbGQtcGVyc2lhbi1kYXRlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RhbWluLWZpZWxkLXBlcnNpYW4tZGF0ZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RhbWluLWZpZWxkLXBlcnNpYW4tZGF0ZS5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFRhbWluRmllbGRQZXJzaWFuRGF0ZUNvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZVxuICAgIH1cbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBUYW1pbkZpZWxkUGVyc2lhbkRhdGVDb21wb25lbnQgZXh0ZW5kcyBGaWVsZEJhc2VDb21wb25lbnQge1xuICBAVmlld0NoaWxkKCdwaWNrZXInKSBwaWNrZXI6IFBpY2tlckNvbnRhaW5lckNvbXBvbmVudDtcbiAgQFZpZXdDaGlsZCgncGVyc2lhbkRhdGVQaWNrZXInKSBwZXJzaWFuRGF0ZVBpY2tlcjogVGFtaW5QZXJzaWFuRGF0ZVBpY2tlckNvbXBvbmVudDtcbiAgQFZpZXdDaGlsZCgnaWNvbicpIGljb25FbGVtZW50OiBFbGVtZW50UmVmO1xuXG4gIEBJbnB1dCgpIHNldCB2YWx1ZSh2YWw6IERhdGUpIHtcbiAgICAvLyBjb25zdCB0bXAgPSBtb21lbnQobmV3IERhdGUodmFsKSk7XG4gICAgLy8gY29uc3QgdG1wID0gbmV3IHBlcnNpYW5EYXRlKG5ldyBEYXRlKHZhbCkpO1xuICAgIGNvbnN0IHRtcCA9IFRhbWluUGVyc2lhbkRhdGUuR3JlZ29yaWFuVG9KYWxhbGkobmV3IERhdGUodmFsKSk7XG4gICAgLy8gdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZSA9IHRtcC50b0xvY2FsZSgnZW4nKS5mb3JtYXQoJ1lZWVkvTU0vREQnKTtcbiAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlID0gdG1wO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFZhbHVlKHZhbDogc3RyaW5nKSB7XG4gICAgaWYgKHZhbC5sZW5ndGggPT09IDgpIHtcbiAgICAgIGNvbnN0IHl5eXkgPSB2YWwuc3Vic3RyKDAsIDQpO1xuICAgICAgY29uc3QgbW0gPSB2YWwuc3Vic3RyKDQsIDIpO1xuICAgICAgY29uc3QgZGQgPSB2YWwuc3Vic3RyKDYsIDIpO1xuICAgICAgY29uc3QgaW5wdXQgPSBbTnVtYmVyKHl5eXkpLCBOdW1iZXIobW0pLCBOdW1iZXIoZGQpLCAwLCAwLCAwXTtcbiAgICAgIC8vIHJldHVybiAobmV3IHBlcnNpYW5EYXRlKGlucHV0KSkudG9EYXRlKCk7XG4gICAgICByZXR1cm4gVGFtaW5QZXJzaWFuRGF0ZS5KYWxhbGlUb0dyZWdvcmlhbihOdW1iZXIoeXl5eSksIE51bWJlcihtbSksIE51bWJlcihkZCkpO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICh2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIC8vIGNvbnN0IHRtcCA9IG5ldyBwZXJzaWFuRGF0ZShuZXcgRGF0ZSh2YWx1ZSkpO1xuICAgICAgY29uc3QgdG1wID0gVGFtaW5QZXJzaWFuRGF0ZS5HcmVnb3JpYW5Ub0phbGFsaShuZXcgRGF0ZSh2YWx1ZSkpO1xuICAgICAgLy8gdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZSA9IHRtcC50b0xvY2FsZSgnZW4nKS5mb3JtYXQoJ1lZWVkvTU0vREQnKTsgLy8gdG1wLmxvY2FsZSgnZmEnKS5mb3JtYXQoJ1lZWVkvTU0vREQnKTtcbiAgICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB0bXA7XG4vKlxuICAgICAgaWYgKCF0aGlzLm1hc2tSZWYpIHtcbiAgICAgICAgdGhpcy5fc2V0SW5wdXRNYXNrKCk7XG4gICAgICB9XG4gICAgICB0aGlzLm1hc2tSZWYudXBkYXRlVmFsdWUoKTtcbiovXG4gICAgICB0aGlzLm1hc2tSZWYudXBkYXRlVmFsdWUoKTtcbiAgICAgIHRoaXMub25DaGFuZ2UodmFsdWUpO1xuICAgIH0sIDApO1xuICB9XG5cbiAgaW5pdGlhbGl6ZUNvbXBvbmVudCgpIHtcbiAgICB0aGlzLl9zZXRJbnB1dE1hc2soKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMucGlja2VyLnBhcmVudCA9IHRoaXMuaW5wdXRFbGVtZW50O1xuICAgICAgdGhpcy5waWNrZXIuYnV0dG9uID0gdGhpcy5pY29uRWxlbWVudDtcblxuICAgIH0sIDApO1xuICB9XG5cbiAgZ2V0IHZhbHVlKCk6IERhdGUge1xuICAgIC8vIHJldHVybiBtb21lbnQuZnJvbSh0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlLCAnZmEnLCAnWVlZWS9NTS9ERCcpLnRvRGF0ZSgpO1xuICAgIGNvbnN0IHRtcCA9IHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWUuc3BsaXQoJy8nKTtcbiAgICBjb25zdCBpbnB1dCA9IFtOdW1iZXIodG1wWzBdKSwgTnVtYmVyKHRtcFsxXSksIE51bWJlcih0bXBbMl0pLCAwLCAwLCAwXTtcbiAgICAvLyByZXR1cm4gKG5ldyBwZXJzaWFuRGF0ZShpbnB1dCkpLnRvRGF0ZSgpO1xuICAgIHJldHVybiAoVGFtaW5QZXJzaWFuRGF0ZS5KYWxhbGlUb0dyZWdvcmlhbihOdW1iZXIodG1wWzBdKSwgTnVtYmVyKHRtcFsxXSksIE51bWJlcih0bXBbMl0pKSk7XG4gIH1cblxuICBvblNob3dQaWNrZXIoKSB7XG4gICAgaWYgKHRoaXMuY29udHJvbC5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgdGhpcy5waWNrZXIudG9nZ2xlKCk7XG4gIH1cblxuICBoaWRlUG9wdXAoKSB7XG4gICAgLy8gdGhpcy5waWNrZXJWaXNpYmlsaXR5ID0gJ2hpZGRlbic7XG4gICAgdGhpcy5waWNrZXIuaGlkZSgpO1xuICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQucmVhZE9ubHkgPSBmYWxzZTtcbiAgfVxuXG4gIHNob3dQb3B1cCgpIHtcbiAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnJlYWRPbmx5ID0gdHJ1ZTtcbiAgICBjb25zdCB2YWwgPSB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlO1xuICAgIC8vIGNvbnN0IHRtcCA9IG1vbWVudC5mcm9tKHZhbCwgJ2ZhJywgJ1lZWVkvTU0vREQnKTtcbiAgICBjb25zdCB0ID0gdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZS5zcGxpdCgnLycpO1xuICAgIGNvbnN0IGlucHV0ID0gW051bWJlcih0WzBdKSwgTnVtYmVyKHRbMV0pLCBOdW1iZXIodFsyXSksIDIzLCAwLCAwXTtcbiAgICAvLyBjb25zdCB0bXAgPSAobmV3IHBlcnNpYW5EYXRlKGlucHV0KSk7XG4gICAgY29uc3QgdG1wID0gVGFtaW5QZXJzaWFuRGF0ZS5KYWxhbGlUb0dyZWdvcmlhbihOdW1iZXIodFswXSksIE51bWJlcih0WzFdKSwgTnVtYmVyKHRbMl0pKTtcbiAgICAvLyBpZiAodG1wLmlzVmFsaWQoKSkge1xuICAgIC8vIHRoaXMucGVyc2lhbkRhdGVQaWNrZXIuY3VycmVudERhdGUgPSBuZXcgRGF0ZSh0bXAudG9EYXRlKCkpO1xuICAgIHRoaXMucGVyc2lhbkRhdGVQaWNrZXIuY3VycmVudERhdGUgPSB0bXA7XG4gICAgLy8gfVxuICAgIHRoaXMucGVyc2lhbkRhdGVQaWNrZXIuc2V0VmlldygpO1xuICAgIHRoaXMucGlja2VyLnNob3coKTtcbiAgICAvLyB0aGlzLl90aGVQb3BwZXIudXBkYXRlKCk7XG4gIH1cblxuICBvblBpY2tlckNoYW5nZSh2YWw6IGFueSkge1xuICAgIGlmICh2YWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbDtcbiAgICAgIHRoaXMub25DaGFuZ2UodGhpcy52YWx1ZSk7XG4gICAgICB0aGlzLmhpZGVQb3B1cCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3NldElucHV0TWFzaygpIHtcbiAgICB0aGlzLm1hc2tSZWYgPSBuZXcgSU1hc2sodGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudCwge1xuICAgICAgbWFzazogJ1lZWVkvTU0vREQnLFxuICAgICAgYmxvY2tzOiB7XG4gICAgICAgIEREOiB7XG4gICAgICAgICAgbWFzazogSU1hc2suTWFza2VkUmFuZ2UsXG4gICAgICAgICAgZnJvbTogMSxcbiAgICAgICAgICB0bzogMzEsXG4gICAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uICh2YWx1ZSwgbWFza2VkKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zdCB0bXAgPSBtYXNrZWQucGFyZW50Ll92YWx1ZS5zcGxpdCgnLycpO1xuICAgICAgICAgICAgICBjb25zdCB5eXl5ID0gdG1wWzBdO1xuICAgICAgICAgICAgICBjb25zdCBtbSA9IHRtcFsxXTtcbiAgICAgICAgICAgICAgY29uc3QgZGQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgLy8gbGV0IHRoZURhdGU7XG4gICAgICAgICAgICAgIC8vIHRoZURhdGUgPSBtb21lbnQuZnJvbShgJHt5eXl5fS8ke21tfS8ke2RkfWAsICdmYScsICdZWVlZL01NL0REJyk7XG4gICAgICAgICAgICAgIC8vIHJldHVybiB0aGVEYXRlLmlzVmFsaWQoKTtcbiAgICAgICAgICAgICAgLy8gY29uc3QgcmVzdWx0ID0gbmV3IHBlcnNpYW5EYXRlKFtOdW1iZXIoeXl5eSksIE51bWJlcihtbSksIE51bWJlcihkZCksIDAsIDAsIDAsIDBdKTtcbiAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gVGFtaW5QZXJzaWFuRGF0ZS5KYWxhbGlUb0dyZWdvcmlhbihOdW1iZXIoeXl5eSksIE51bWJlcihtbSksIE51bWJlcihkZCkpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0ICE9PSBudWxsO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBNTToge1xuICAgICAgICAgIG1hc2s6IElNYXNrLk1hc2tlZFJhbmdlLFxuICAgICAgICAgIGZyb206IDEsXG4gICAgICAgICAgdG86IDEyXG4gICAgICAgIH0sXG4gICAgICAgIFlZWVk6IHtcbiAgICAgICAgICBtYXNrOiBJTWFzay5NYXNrZWRSYW5nZSxcbiAgICAgICAgICBmcm9tOiAxMDAwLFxuICAgICAgICAgIHRvOiA5OTk5XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgcGxhY2Vob2xkZXJMYXp5OiBmYWxzZSxcbiAgICB9KTtcbiAgfVxufVxuIl19