/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ControlContainer, FormBuilder } from '@angular/forms';
import { Component, ElementRef, Injector, Input, ViewChild } from '@angular/core';
import { fromEvent, Subscription } from 'rxjs';
import { debounceTime, distinctUntilChanged } from 'rxjs/operators';
import { OverlayService } from '../services/overlay/overlay.service';
import { PersianNumberPipe } from '../pipes/persian-number.pipe';
import { TaminRestService } from '../services/tamin-rest-service/tamin-rest.service';
var FieldBaseComponent = /** @class */ (function () {
    function FieldBaseComponent(overlayService, restService, controlContainer, persianNumberPipe, injector, formBuilder) {
        this.overlayService = overlayService;
        this.restService = restService;
        this.controlContainer = controlContainer;
        this.persianNumberPipe = persianNumberPipe;
        this.injector = injector;
        this.formBuilder = formBuilder;
        this.subscription = new Subscription();
        this.onTouched = (/**
         * @return {?}
         */
        function () {
        });
        this.onChange = (/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
        });
    }
    /**
     * @return {?}
     */
    FieldBaseComponent.prototype.getInputElementRef = /**
     * @return {?}
     */
    function () {
        return this.inputElement;
    };
    /**
     * @return {?}
     */
    FieldBaseComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.control = this.controlContainer.control.get(this.formControlName);
        // this.initValueAccessor();
        // this.initializeComponent();
    };
    /**
     * @return {?}
     */
    FieldBaseComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.initValueAccessor();
        this.initializeComponent();
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    FieldBaseComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    FieldBaseComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouched = fn;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FieldBaseComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        /** @type {?} */
        var theValue = value == null ? '' : value.toString();
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this.maskRef) {
                _this.maskRef.value = theValue;
            }
            else {
                _this.inputElement.nativeElement.value = theValue;
            }
        }));
        this.onChange(value);
    };
    /**
     * @return {?}
     */
    FieldBaseComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.overlay) {
            this.overlayService.hide(this.overlay);
        }
        this.subscription.unsubscribe();
    };
    /**
     * @protected
     * @param {?} val
     * @return {?}
     */
    FieldBaseComponent.prototype.getValue = /**
     * @protected
     * @param {?} val
     * @return {?}
     */
    function (val) {
        return val;
    };
    /**
     * @protected
     * @return {?}
     */
    FieldBaseComponent.prototype.initValueAccessor = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var keyups = fromEvent(this.inputElement.nativeElement, 'keyup').pipe(debounceTime(100), distinctUntilChanged());
        this.subscription.add(keyups.subscribe((/**
         * @param {?} evt
         * @return {?}
         */
        function (evt) {
            if (_this.maskRef) {
                _this.onChange(_this.getValue(_this.maskRef.unmaskedValue));
            }
            else {
                _this.onChange(_this.getValue(evt.target.value));
            }
        })));
        /** @type {?} */
        var focuses = fromEvent(this.inputElement.nativeElement, 'focus');
        this.subscription.add(focuses.subscribe((/**
         * @param {?} evt
         * @return {?}
         */
        function (evt) {
            _this.onTouched();
        })));
    };
    /**
     * @return {?}
     */
    FieldBaseComponent.prototype.startWaiting = /**
     * @return {?}
     */
    function () {
        this.overlay = this.overlayService.show(this.inputElement.nativeElement);
    };
    /**
     * @return {?}
     */
    FieldBaseComponent.prototype.stopWaiting = /**
     * @return {?}
     */
    function () {
        this.overlayService.hide(this.overlay);
    };
    /**
     * @protected
     * @return {?}
     */
    FieldBaseComponent.prototype.initializeComponent = /**
     * @protected
     * @return {?}
     */
    function () {
    };
    /**
     * @protected
     * @param {?} obj
     * @param {?} path
     * @return {?}
     */
    FieldBaseComponent.prototype.deepFind = /**
     * @protected
     * @param {?} obj
     * @param {?} path
     * @return {?}
     */
    function (obj, path) {
        /** @type {?} */
        var paths = path.split('.');
        /** @type {?} */
        var current = obj;
        /** @type {?} */
        var i;
        for (i = 0; i < paths.length; ++i) {
            if (current[paths[i]] === undefined) {
                return undefined;
            }
            else {
                current = current[paths[i]];
            }
        }
        return current;
    };
    FieldBaseComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tamin-base-component',
                    template: ''
                }] }
    ];
    /** @nocollapse */
    FieldBaseComponent.ctorParameters = function () { return [
        { type: OverlayService },
        { type: TaminRestService },
        { type: ControlContainer },
        { type: PersianNumberPipe },
        { type: Injector },
        { type: FormBuilder }
    ]; };
    FieldBaseComponent.propDecorators = {
        inputElement: [{ type: ViewChild, args: ['inputElement',] }],
        formControlName: [{ type: Input }],
        placeHolder: [{ type: Input }],
        hint: [{ type: Input }]
    };
    return FieldBaseComponent;
}());
export { FieldBaseComponent };
if (false) {
    /** @type {?} */
    FieldBaseComponent.prototype.inputElement;
    /** @type {?} */
    FieldBaseComponent.prototype.formControlName;
    /** @type {?} */
    FieldBaseComponent.prototype.placeHolder;
    /** @type {?} */
    FieldBaseComponent.prototype.hint;
    /** @type {?} */
    FieldBaseComponent.prototype.control;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.maskRef;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.subscription;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.onTouched;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.onChange;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.overlay;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.overlayService;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.restService;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.controlContainer;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.persianNumberPipe;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    FieldBaseComponent.prototype.formBuilder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllbGQtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90YW1pbi1mcmFtZXdvcmsvIiwic291cmNlcyI6WyJsaWIvYmFzZS9maWVsZC1iYXNlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFrQixnQkFBZ0IsRUFBd0IsV0FBVyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEcsT0FBTyxFQUFnQixTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQXFCLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNsSCxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUMsWUFBWSxFQUFFLG9CQUFvQixFQUFVLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0UsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBQ25FLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQy9ELE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLG1EQUFtRCxDQUFDO0FBSW5GO0lBZ0JFLDRCQUNZLGNBQThCLEVBQzlCLFdBQTZCLEVBQzdCLGdCQUFrQyxFQUNsQyxpQkFBb0MsRUFDcEMsUUFBa0IsRUFBWSxXQUF3QjtRQUp0RCxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsZ0JBQVcsR0FBWCxXQUFXLENBQWtCO1FBQzdCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVksZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFWeEQsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBVzFDLElBQUksQ0FBQyxTQUFTOzs7UUFBRztRQUNqQixDQUFDLENBQUEsQ0FBQztRQUNGLElBQUksQ0FBQyxRQUFROzs7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a0I7OztJQUM3QiwwQ0FBb0Q7O0lBQ3BELDZDQUF3Qzs7SUFDeEMseUNBQW9DOztJQUNwQyxrQ0FBc0I7O0lBQ3RCLHFDQUF5Qjs7Ozs7SUFDekIscUNBQXVCOzs7OztJQUN2QiwwQ0FBNEM7Ozs7O0lBQzVDLHVDQUF5Qjs7Ozs7SUFDekIsc0NBQXdCOzs7OztJQUN4QixxQ0FBdUI7Ozs7O0lBR3JCLDRDQUF3Qzs7Ozs7SUFDeEMseUNBQXVDOzs7OztJQUN2Qyw4Q0FBNEM7Ozs7O0lBQzVDLCtDQUE4Qzs7Ozs7SUFDOUMsc0NBQTRCOzs7OztJQUFFLHlDQUFrQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7QWJzdHJhY3RDb250cm9sLCBDb250cm9sQ29udGFpbmVyLCBDb250cm9sVmFsdWVBY2Nlc3NvciwgRm9ybUJ1aWxkZXJ9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHtBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEluamVjdG9yLCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7ZnJvbUV2ZW50LCBTdWJzY3JpcHRpb259IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge2RlYm91bmNlVGltZSwgZGlzdGluY3RVbnRpbENoYW5nZWQsIHRpbWVvdXR9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHtPdmVybGF5U2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvb3ZlcmxheS9vdmVybGF5LnNlcnZpY2UnO1xyXG5pbXBvcnQge1BlcnNpYW5OdW1iZXJQaXBlfSBmcm9tICcuLi9waXBlcy9wZXJzaWFuLW51bWJlci5waXBlJztcclxuaW1wb3J0IHtUYW1pblJlc3RTZXJ2aWNlfSBmcm9tICcuLi9zZXJ2aWNlcy90YW1pbi1yZXN0LXNlcnZpY2UvdGFtaW4tcmVzdC5zZXJ2aWNlJztcclxuXHJcbmRlY2xhcmUgbGV0IElNYXNrOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3RhbWluLWJhc2UtY29tcG9uZW50JyxcclxuICB0ZW1wbGF0ZTogJydcclxufSlcclxuZXhwb3J0IGNsYXNzIEZpZWxkQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgQFZpZXdDaGlsZCgnaW5wdXRFbGVtZW50JykgaW5wdXRFbGVtZW50OiBFbGVtZW50UmVmO1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBmb3JtQ29udHJvbE5hbWU6IHN0cmluZztcclxuICBASW5wdXQoKSBwdWJsaWMgcGxhY2VIb2xkZXI6IHN0cmluZztcclxuICBASW5wdXQoKSBoaW50OiBzdHJpbmc7XHJcbiAgY29udHJvbDogQWJzdHJhY3RDb250cm9sO1xyXG4gIHByb3RlY3RlZCBtYXNrUmVmOiBhbnk7XHJcbiAgcHJvdGVjdGVkIHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcclxuICBwcm90ZWN0ZWQgb25Ub3VjaGVkOiBhbnk7XHJcbiAgcHJvdGVjdGVkIG9uQ2hhbmdlOiBhbnk7XHJcbiAgcHJvdGVjdGVkIG92ZXJsYXk6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcm90ZWN0ZWQgb3ZlcmxheVNlcnZpY2U6IE92ZXJsYXlTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIHJlc3RTZXJ2aWNlOiBUYW1pblJlc3RTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIGNvbnRyb2xDb250YWluZXI6IENvbnRyb2xDb250YWluZXIsXHJcbiAgICBwcm90ZWN0ZWQgcGVyc2lhbk51bWJlclBpcGU6IFBlcnNpYW5OdW1iZXJQaXBlLFxyXG4gICAgcHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3RvciwgcHJvdGVjdGVkIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcikge1xyXG4gICAgdGhpcy5vblRvdWNoZWQgPSAoKSA9PiB7XHJcbiAgICB9O1xyXG4gICAgdGhpcy5vbkNoYW5nZSA9ICh2YWx1ZTogc3RyaW5nKSA9PiB7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5wdXRFbGVtZW50UmVmKCk6IEVsZW1lbnRSZWYge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5wdXRFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmNvbnRyb2wgPSB0aGlzLmNvbnRyb2xDb250YWluZXIuY29udHJvbC5nZXQodGhpcy5mb3JtQ29udHJvbE5hbWUpO1xyXG4gICAgLy8gdGhpcy5pbml0VmFsdWVBY2Nlc3NvcigpO1xyXG4gICAgLy8gdGhpcy5pbml0aWFsaXplQ29tcG9uZW50KCk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmluaXRWYWx1ZUFjY2Vzc29yKCk7XHJcbiAgICB0aGlzLmluaXRpYWxpemVDb21wb25lbnQoKTtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChfOiBhbnkpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcclxuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XHJcbiAgfVxyXG5cclxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcclxuICAgIGNvbnN0IHRoZVZhbHVlID0gdmFsdWUgPT0gbnVsbCA/ICcnIDogdmFsdWUudG9TdHJpbmcoKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5tYXNrUmVmKSB7XHJcbiAgICAgICAgdGhpcy5tYXNrUmVmLnZhbHVlID0gdGhlVmFsdWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZSA9IHRoZVZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLm9uQ2hhbmdlKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMub3ZlcmxheSkge1xyXG4gICAgICB0aGlzLm92ZXJsYXlTZXJ2aWNlLmhpZGUodGhpcy5vdmVybGF5KTtcclxuICAgIH1cclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0VmFsdWUodmFsKSB7XHJcbiAgICByZXR1cm4gdmFsO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGluaXRWYWx1ZUFjY2Vzc29yKCkge1xyXG4gICAgY29uc3Qga2V5dXBzID0gZnJvbUV2ZW50KHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICdrZXl1cCcpLnBpcGUoZGVib3VuY2VUaW1lKDEwMCksIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkpO1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKGtleXVwcy5zdWJzY3JpYmUoKGV2dDogYW55KSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLm1hc2tSZWYpIHtcclxuICAgICAgICB0aGlzLm9uQ2hhbmdlKHRoaXMuZ2V0VmFsdWUodGhpcy5tYXNrUmVmLnVubWFza2VkVmFsdWUpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLm9uQ2hhbmdlKHRoaXMuZ2V0VmFsdWUoZXZ0LnRhcmdldC52YWx1ZSkpO1xyXG4gICAgICB9XHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3QgZm9jdXNlcyA9IGZyb21FdmVudCh0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LCAnZm9jdXMnKTtcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uLmFkZChmb2N1c2VzLnN1YnNjcmliZSgoZXZ0OiBhbnkpID0+IHtcclxuICAgICAgICB0aGlzLm9uVG91Y2hlZCgpO1xyXG4gICAgICB9XHJcbiAgICApKTtcclxuICB9XHJcblxyXG4gIHN0YXJ0V2FpdGluZygpIHtcclxuICAgIHRoaXMub3ZlcmxheSA9IHRoaXMub3ZlcmxheVNlcnZpY2Uuc2hvdyh0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHN0b3BXYWl0aW5nKCkge1xyXG4gICAgdGhpcy5vdmVybGF5U2VydmljZS5oaWRlKHRoaXMub3ZlcmxheSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgaW5pdGlhbGl6ZUNvbXBvbmVudCgpIHtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBkZWVwRmluZChvYmosIHBhdGgpIHtcclxuICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLicpO1xyXG4gICAgbGV0IGN1cnJlbnQgPSBvYmo7XHJcbiAgICBsZXQgaTtcclxuXHJcbiAgICBmb3IgKGkgPSAwOyBpIDwgcGF0aHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgaWYgKGN1cnJlbnRbcGF0aHNbaV1dID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGN1cnJlbnQgPSBjdXJyZW50W3BhdGhzW2ldXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGN1cnJlbnQ7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=