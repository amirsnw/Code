/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, forwardRef, Input, ViewChild } from '@angular/core';
import { TaminDataGridComponent } from '../../tamin-data-grid/tamin-data-grid.component';
import { FieldBaseComponent } from '../../../base/field-base.component';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { TaminDataGridConfiguration } from '../../../helpers/tamin.data.grid.configuration/tamin.data.grid.configuration';
import { PickerContainerComponent } from '../../containers/picker-container/picker-container.component';
import { SearchOperator } from '../../../models/search-param.model';
var TaminFieldComboBoxComponent = /** @class */ (function (_super) {
    tslib_1.__extends(TaminFieldComboBoxComponent, _super);
    function TaminFieldComboBoxComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.searchOperatorType = SearchOperator.EQUAL;
        return _this;
    }
    /**
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.initializeComponent = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.initializeGrid();
        this.picker.parent = this.inputElement;
        this.picker.button = this.iconElement;
        if (this.casecadeControlName) {
            this.parent = this.controlContainer.control.get(this.casecadeControlName);
            this.subscription.add(this.parent.valueChanges.subscribe((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                _this.parentValue = value;
            })));
        }
    };
    /**
     * @private
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.initializeGrid = /**
     * @private
     * @return {?}
     */
    function () {
        this.theGrid.configuration = this.dataGridConfiguration;
        this.theGrid.loadDataOnInit = false;
    };
    /**
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.onClearContent = /**
     * @return {?}
     */
    function () {
        this.onChange('');
        this.inputElement.nativeElement.value = '';
        this.picker.hide();
    };
    /**
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.onShowPicker = /**
     * @return {?}
     */
    function () {
        this.picker.toggle();
        this.theGrid.refreshData();
    };
    /**
     * @param {?} val
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.onItemSelected = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (!val) {
            this.onChange('');
            this.hidePopup();
            return;
        }
        /** @type {?} */
        var displayField = this.deepFind(val, this.displayField);
        /** @type {?} */
        var valueField = this.deepFind(val, this.valueField);
        if (!displayField || !valueField) {
            this.inputElement.nativeElement.value = '';
            this.onChange('');
            return;
        }
        this.inputElement.nativeElement.value = displayField;
        this.onChange(valueField);
        this.hidePopup();
    };
    /**
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.hidePopup = /**
     * @return {?}
     */
    function () {
        this.picker.hide();
    };
    /**
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.showPopup = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.picker.show();
        if (this.parentValue && this.parentValue !== '') {
            /** @type {?} */
            var tmp_1 = this.theGrid.searchParams.find((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.property === _this.parentValue; }));
            if (tmp_1) {
                this.theGrid.searchParams = this.theGrid.searchParams.filter((/**
                 * @param {?} obj
                 * @return {?}
                 */
                function (obj) { return obj !== tmp_1; }));
            }
            this.theGrid.searchParams.push({
                property: this.casecadeControlFieldName,
                value: this.parentValue,
                operator: this.searchOperatorType
            });
        }
        this.theGrid.refreshData();
    };
    /**
     * @param {?} value
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        // const theValue = value == null ? '' : value;
        // if (theValue !== '') {
        //   this.loadData(theValue);
        // }
        /** @type {?} */
        var theValue = value == null ? '' : value;
        if (theValue !== '') {
            this.loadData(theValue);
        }
        else {
            this.inputElement.nativeElement.value = '';
        }
    };
    /**
     * @private
     * @param {?} theValue
     * @return {?}
     */
    TaminFieldComboBoxComponent.prototype.loadData = /**
     * @private
     * @param {?} theValue
     * @return {?}
     */
    function (theValue) {
        var _this = this;
        /** @type {?} */
        var theUrl = this.dataGridConfiguration.serviceUrl;
        /** @type {?} */
        var id = this.dataGridConfiguration.id;
        /** @type {?} */
        var searchParam = [
            {
                property: id,
                value: theValue,
                operator: this.searchOperatorType
            }
        ];
        if (this.parentValue && this.parentValue !== '') {
            searchParam.push({
                property: this.casecadeControlFieldName,
                value: this.parentValue,
                operator: this.searchOperatorType
            });
        }
        this.startWaiting();
        this.restService
            .getAll(theUrl, searchParam)
            .then((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            _this.stopWaiting();
            if (value.data.list.length === 0) {
                _this.onChange('');
            }
            _this.onItemSelected(value.data.list[0]);
            _this.theGrid.dataItems = [];
            _this.theGrid.dataItems.push(value.data.list[0]);
        }))
            .catch((/**
         * @param {?} reason
         * @return {?}
         */
        function (reason) {
            _this.stopWaiting();
            _this.onChange('');
        }));
    };
    TaminFieldComboBoxComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tamin-field-combo-box',
                    template: "<div class=\"input-wrapper\">\n  <input\n    id=\"textbox\"\n    readonly=\"readonly\"\n    [disabled] = \"control.disabled\"\n    style=\"padding-left: 35px;cursor: pointer\"\n    type=\"text\"\n    class=\"tamin-form-control-input\"\n    (click)=\"onShowPicker()\"\n    [class.tamin-form-control-valid]=\"control.touched && control.valid\"\n    [class.tamin-form-control-invalid]=\"control.touched && !control.valid\"\n    #inputElement [attr.placeholder]=\"placeHolder\">\n  <span class=\"icon\" style=\"margin-left:20px\" *ngIf=\"showClearButton\" (click)=\"onClearContent()\">\n    <i\n      class=\"icon-cancel\"\n      style=\"font-size: 1.5em\"\n      [class.tamin-form-control-valid-icon]=\"control.touched && control.valid\"\n      [class.tamin-form-control-invalid-icon]=\"control.touched && !control.valid\"></i>\n  </span>\n\n  <span class=\"icon\" #icon (click)=\"onShowPicker()\">\n    <i\n      class=\"icon-down-open\"\n      style=\"font-size: 1.5em\"\n      [class.tamin-form-control-valid-icon]=\"control.touched && control.valid\"\n      [class.tamin-form-control-invalid-icon]=\"control.touched && !control.valid\"\n    ></i>\n  </span>\n</div>\n<tamin-picker-container #picker>\n  <tamin-data-grid #theGrid (itemSelect)=\"onItemSelected($event)\" [allowBreakPoints]=\"false\" [showHover]=\"true\"></tamin-data-grid>\n</tamin-picker-container>\n",
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return TaminFieldComboBoxComponent; })),
                            multi: true
                        }
                    ],
                    styles: [".input-wrapper{position:relative}.icon{position:absolute;top:23%;left:5px;height:10px;margin-top:-5px;cursor:pointer}"]
                }] }
    ];
    TaminFieldComboBoxComponent.propDecorators = {
        dataGridConfiguration: [{ type: Input }],
        displayField: [{ type: Input }],
        valueField: [{ type: Input }],
        casecadeControlName: [{ type: Input }],
        casecadeControlFieldName: [{ type: Input }],
        showClearButton: [{ type: Input }],
        searchOperatorType: [{ type: Input }],
        theGrid: [{ type: ViewChild, args: ['theGrid',] }],
        picker: [{ type: ViewChild, args: ['picker',] }],
        iconElement: [{ type: ViewChild, args: ['icon',] }]
    };
    return TaminFieldComboBoxComponent;
}(FieldBaseComponent));
export { TaminFieldComboBoxComponent };
if (false) {
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.dataGridConfiguration;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.displayField;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.valueField;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.casecadeControlName;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.casecadeControlFieldName;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.showClearButton;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.searchOperatorType;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.theGrid;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.picker;
    /** @type {?} */
    TaminFieldComboBoxComponent.prototype.iconElement;
    /**
     * @type {?}
     * @private
     */
    TaminFieldComboBoxComponent.prototype.parent;
    /**
     * @type {?}
     * @private
     */
    TaminFieldComboBoxComponent.prototype.parentValue;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFtaW4tZmllbGQtY29tYm8tYm94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RhbWluLWZyYW1ld29yay8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpZWxkcy90YW1pbi1maWVsZC1jb21iby1ib3gvdGFtaW4tZmllbGQtY29tYm8tYm94LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ2xGLE9BQU8sRUFBQyxzQkFBc0IsRUFBQyxNQUFNLGlEQUFpRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLG9DQUFvQyxDQUFDO0FBQ3RFLE9BQU8sRUFBa0IsaUJBQWlCLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNsRSxPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSw4RUFBOEUsQ0FBQztBQUN4SCxPQUFPLEVBQUMsd0JBQXdCLEVBQUMsTUFBTSw4REFBOEQsQ0FBQztBQUN0RyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sb0NBQW9DLENBQUM7QUFFbEU7SUFZaUQsdURBQWtCO0lBWm5FO1FBQUEscUVBa0pDO1FBL0hVLHdCQUFrQixHQUFtQixjQUFjLENBQUMsS0FBSyxDQUFDOztJQStIckUsQ0FBQzs7OztJQXZIQyx5REFBbUI7OztJQUFuQjtRQUFBLGlCQVVDO1FBVEMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDdkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUN0QyxJQUFJLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtZQUM1QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxn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LFNBQVMsU0FBQyxNQUFNOztJQTRIbkIsa0NBQUM7Q0FBQSxBQWxKRCxDQVlpRCxrQkFBa0IsR0FzSWxFO1NBdElZLDJCQUEyQjs7O0lBQ3RDLDREQUEyRDs7SUFDM0QsbURBQThCOztJQUM5QixpREFBNEI7O0lBQzVCLDBEQUFxQzs7SUFDckMsK0RBQTBDOztJQUMxQyxzREFBa0M7O0lBQ2xDLHlEQUFtRTs7SUFDbkUsOENBQXNEOztJQUN0RCw2Q0FBc0Q7O0lBQ3RELGtEQUEyQzs7Ozs7SUFDM0MsNkNBQWdDOzs7OztJQUNoQyxrREFBNEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgRWxlbWVudFJlZiwgZm9yd2FyZFJlZiwgSW5wdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1RhbWluRGF0YUdyaWRDb21wb25lbnR9IGZyb20gJy4uLy4uL3RhbWluLWRhdGEtZ3JpZC90YW1pbi1kYXRhLWdyaWQuY29tcG9uZW50JztcbmltcG9ydCB7RmllbGRCYXNlQ29tcG9uZW50fSBmcm9tICcuLi8uLi8uLi9iYXNlL2ZpZWxkLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7QWJzdHJhY3RDb250cm9sLCBOR19WQUxVRV9BQ0NFU1NPUn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtUYW1pbkRhdGFHcmlkQ29uZmlndXJhdGlvbn0gZnJvbSAnLi4vLi4vLi4vaGVscGVycy90YW1pbi5kYXRhLmdyaWQuY29uZmlndXJhdGlvbi90YW1pbi5kYXRhLmdyaWQuY29uZmlndXJhdGlvbic7XG5pbXBvcnQge1BpY2tlckNvbnRhaW5lckNvbXBvbmVudH0gZnJvbSAnLi4vLi4vY29udGFpbmVycy9waWNrZXItY29udGFpbmVyL3BpY2tlci1jb250YWluZXIuY29tcG9uZW50JztcbmltcG9ydCB7U2VhcmNoT3BlcmF0b3J9IGZyb20gJy4uLy4uLy4uL21vZGVscy9zZWFyY2gtcGFyYW0ubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0YW1pbi1maWVsZC1jb21iby1ib3gnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGFtaW4tZmllbGQtY29tYm8tYm94LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGFtaW4tZmllbGQtY29tYm8tYm94LmNvbXBvbmVudC5zY3NzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gVGFtaW5GaWVsZENvbWJvQm94Q29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIFRhbWluRmllbGRDb21ib0JveENvbXBvbmVudCBleHRlbmRzIEZpZWxkQmFzZUNvbXBvbmVudCB7XG4gIEBJbnB1dCgpIGRhdGFHcmlkQ29uZmlndXJhdGlvbjogVGFtaW5EYXRhR3JpZENvbmZpZ3VyYXRpb247XG4gIEBJbnB1dCgpIGRpc3BsYXlGaWVsZDogc3RyaW5nO1xuICBASW5wdXQoKSB2YWx1ZUZpZWxkOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGNhc2VjYWRlQ29udHJvbE5hbWU6IHN0cmluZztcbiAgQElucHV0KCkgY2FzZWNhZGVDb250cm9sRmllbGROYW1lOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHNob3dDbGVhckJ1dHRvbjogYm9vbGVhbjtcbiAgQElucHV0KCkgc2VhcmNoT3BlcmF0b3JUeXBlOiBTZWFyY2hPcGVyYXRvciA9IFNlYXJjaE9wZXJhdG9yLkVRVUFMO1xuICBAVmlld0NoaWxkKCd0aGVHcmlkJykgdGhlR3JpZDogVGFtaW5EYXRhR3JpZENvbXBvbmVudDtcbiAgQFZpZXdDaGlsZCgncGlja2VyJykgcGlja2VyOiBQaWNrZXJDb250YWluZXJDb21wb25lbnQ7XG4gIEBWaWV3Q2hpbGQoJ2ljb24nKSBpY29uRWxlbWVudDogRWxlbWVudFJlZjtcbiAgcHJpdmF0ZSBwYXJlbnQ6IEFic3RyYWN0Q29udHJvbDtcbiAgcHJpdmF0ZSBwYXJlbnRWYWx1ZTogc3RyaW5nO1xuXG5cbiAgaW5pdGlhbGl6ZUNvbXBvbmVudCgpIHtcbiAgICB0aGlzLmluaXRpYWxpemVHcmlkKCk7XG4gICAgdGhpcy5waWNrZXIucGFyZW50ID0gdGhpcy5pbnB1dEVsZW1lbnQ7XG4gICAgdGhpcy5waWNrZXIuYnV0dG9uID0gdGhpcy5pY29uRWxlbWVudDtcbiAgICBpZiAodGhpcy5jYXNlY2FkZUNvbnRyb2xOYW1lKSB7XG4gICAgICB0aGlzLnBhcmVudCA9IHRoaXMuY29udHJvbENvbnRhaW5lci5jb250cm9sLmdldCh0aGlzLmNhc2VjYWRlQ29udHJvbE5hbWUpO1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKHRoaXMucGFyZW50LnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodmFsdWUgPT4ge1xuICAgICAgICB0aGlzLnBhcmVudFZhbHVlID0gdmFsdWU7XG4gICAgICB9KSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplR3JpZCgpIHtcbiAgICB0aGlzLnRoZUdyaWQuY29uZmlndXJhdGlvbiA9IHRoaXMuZGF0YUdyaWRDb25maWd1cmF0aW9uO1xuICAgIHRoaXMudGhlR3JpZC5sb2FkRGF0YU9uSW5pdCA9IGZhbHNlO1xuICB9XG5cbiAgb25DbGVhckNvbnRlbnQoKSB7XG4gICAgdGhpcy5vbkNoYW5nZSgnJyk7XG4gICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZSA9ICcnO1xuICAgIHRoaXMucGlja2VyLmhpZGUoKTtcbiAgfVxuXG5cbiAgb25TaG93UGlja2VyKCkge1xuICAgIHRoaXMucGlja2VyLnRvZ2dsZSgpO1xuICAgIHRoaXMudGhlR3JpZC5yZWZyZXNoRGF0YSgpO1xuICB9XG5cbiAgb25JdGVtU2VsZWN0ZWQodmFsOiBhbnkpIHtcbiAgICBpZiAoIXZhbCkge1xuICAgICAgdGhpcy5vbkNoYW5nZSgnJyk7XG4gICAgICB0aGlzLmhpZGVQb3B1cCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBkaXNwbGF5RmllbGQgPSB0aGlzLmRlZXBGaW5kKHZhbCwgdGhpcy5kaXNwbGF5RmllbGQpO1xuICAgIGNvbnN0IHZhbHVlRmllbGQgPSB0aGlzLmRlZXBGaW5kKHZhbCwgdGhpcy52YWx1ZUZpZWxkKTtcbiAgICBpZiAoIWRpc3BsYXlGaWVsZCB8fCAhdmFsdWVGaWVsZCkge1xuICAgICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZSA9ICcnO1xuICAgICAgdGhpcy5vbkNoYW5nZSgnJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSBkaXNwbGF5RmllbGQ7XG4gICAgdGhpcy5vbkNoYW5nZSh2YWx1ZUZpZWxkKTtcbiAgICB0aGlzLmhpZGVQb3B1cCgpO1xuICB9XG5cbiAgaGlkZVBvcHVwKCkge1xuICAgIHRoaXMucGlja2VyLmhpZGUoKTtcbiAgfVxuXG4gIHNob3dQb3B1cCgpIHtcbiAgICB0aGlzLnBpY2tlci5zaG93KCk7XG4gICAgaWYgKHRoaXMucGFyZW50VmFsdWUgJiYgdGhpcy5wYXJlbnRWYWx1ZSAhPT0gJycpIHtcbiAgICAgIGNvbnN0IHRtcCA9IHRoaXMudGhlR3JpZC5zZWFyY2hQYXJhbXMuZmluZChjID0+IGMucHJvcGVydHkgPT09IHRoaXMucGFyZW50VmFsdWUpO1xuICAgICAgaWYgKHRtcCkge1xuICAgICAgICB0aGlzLnRoZUdyaWQuc2VhcmNoUGFyYW1zID0gdGhpcy50aGVHcmlkLnNlYXJjaFBhcmFtcy5maWx0ZXIob2JqID0+IG9iaiAhPT0gdG1wKTtcbiAgICAgIH1cbiAgICAgIHRoaXMudGhlR3JpZC5zZWFyY2hQYXJhbXMucHVzaCh7XG4gICAgICAgIHByb3BlcnR5OiB0aGlzLmNhc2VjYWRlQ29udHJvbEZpZWxkTmFtZSxcbiAgICAgICAgdmFsdWU6IHRoaXMucGFyZW50VmFsdWUsXG4gICAgICAgIG9wZXJhdG9yOiB0aGlzLnNlYXJjaE9wZXJhdG9yVHlwZVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy50aGVHcmlkLnJlZnJlc2hEYXRhKCk7XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICAvLyBjb25zdCB0aGVWYWx1ZSA9IHZhbHVlID09IG51bGwgPyAnJyA6IHZhbHVlO1xuICAgIC8vIGlmICh0aGVWYWx1ZSAhPT0gJycpIHtcbiAgICAvLyAgIHRoaXMubG9hZERhdGEodGhlVmFsdWUpO1xuICAgIC8vIH1cbiAgICBjb25zdCB0aGVWYWx1ZSA9IHZhbHVlID09IG51bGwgPyAnJyA6IHZhbHVlO1xuICAgIGlmICh0aGVWYWx1ZSAhPT0gJycpIHtcbiAgICAgIHRoaXMubG9hZERhdGEodGhlVmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XG4gICAgfVxuXG4gIH1cblxuXG4gIHByaXZhdGUgbG9hZERhdGEodGhlVmFsdWUpIHtcbiAgICBjb25zdCB0aGVVcmwgPSB0aGlzLmRhdGFHcmlkQ29uZmlndXJhdGlvbi5zZXJ2aWNlVXJsO1xuICAgIGNvbnN0IGlkID0gdGhpcy5kYXRhR3JpZENvbmZpZ3VyYXRpb24uaWQ7XG4gICAgY29uc3Qgc2VhcmNoUGFyYW0gPSBbXG4gICAgICB7XG4gICAgICAgIHByb3BlcnR5OiBpZCxcbiAgICAgICAgdmFsdWU6IHRoZVZhbHVlLFxuICAgICAgICBvcGVyYXRvcjogdGhpcy5zZWFyY2hPcGVyYXRvclR5cGVcbiAgICAgIH1cbiAgICBdO1xuXG4gICAgaWYgKHRoaXMucGFyZW50VmFsdWUgJiYgdGhpcy5wYXJlbnRWYWx1ZSAhPT0gJycpIHtcbiAgICAgIHNlYXJjaFBhcmFtLnB1c2goe1xuICAgICAgICBwcm9wZXJ0eTogdGhpcy5jYXNlY2FkZUNvbnRyb2xGaWVsZE5hbWUsXG4gICAgICAgIHZhbHVlOiB0aGlzLnBhcmVudFZhbHVlLFxuICAgICAgICBvcGVyYXRvcjogdGhpcy5zZWFyY2hPcGVyYXRvclR5cGVcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuc3RhcnRXYWl0aW5nKCk7XG4gICAgdGhpcy5yZXN0U2VydmljZVxuICAgICAgLmdldEFsbCh0aGVVcmwsIHNlYXJjaFBhcmFtKVxuICAgICAgLnRoZW4odmFsdWUgPT4ge1xuICAgICAgICB0aGlzLnN0b3BXYWl0aW5nKCk7XG4gICAgICAgIGlmICh2YWx1ZS5kYXRhLmxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5vbkNoYW5nZSgnJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vbkl0ZW1TZWxlY3RlZCh2YWx1ZS5kYXRhLmxpc3RbMF0pO1xuICAgICAgICB0aGlzLnRoZUdyaWQuZGF0YUl0ZW1zID0gW107XG4gICAgICAgIHRoaXMudGhlR3JpZC5kYXRhSXRlbXMucHVzaCh2YWx1ZS5kYXRhLmxpc3RbMF0pO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChyZWFzb24gPT4ge1xuICAgICAgICB0aGlzLnN0b3BXYWl0aW5nKCk7XG4gICAgICAgIHRoaXMub25DaGFuZ2UoJycpO1xuICAgICAgfSk7XG4gIH1cbn1cbiJdfQ==