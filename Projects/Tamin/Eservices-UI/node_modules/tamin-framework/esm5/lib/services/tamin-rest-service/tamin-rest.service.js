/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { timeout } from 'rxjs/operators';
import { RequestCacheService } from '../request-cache.service';
import * as i0 from "@angular/core";
import * as i1 from "../request-cache.service";
import * as i2 from "@angular/common/http";
var TaminRestService = /** @class */ (function () {
    function TaminRestService(taminApplicationConfig, requestCacheService, http) {
        this.taminApplicationConfig = taminApplicationConfig;
        this.requestCacheService = requestCacheService;
        this.http = http;
        this.URL_ERROR = 'url not specified';
        this.ID_ERROR = 'id not specified';
    }
    /**
     * @protected
     * @param {?} url
     * @param {?=} pageNo
     * @param {?=} pageSize
     * @param {?=} searchParams
     * @param {?=} sortParams
     * @param {?=} query
     * @return {?}
     */
    TaminRestService.prototype.getData = /**
     * @protected
     * @param {?} url
     * @param {?=} pageNo
     * @param {?=} pageSize
     * @param {?=} searchParams
     * @param {?=} sortParams
     * @param {?=} query
     * @return {?}
     */
    function (url, pageNo, pageSize, searchParams, sortParams, query) {
        var _this = this;
        // let headers = new HttpHeaders();
        /** @type {?} */
        var params = new HttpParams();
        if (pageNo && pageSize) {
            params = params.append('page', pageNo.toString());
            params = params.append('start', ((pageNo - 1) * pageSize).toString());
            params = params.append('limit', pageSize.toString());
        }
        if (query) {
            Object.keys(query).forEach((/**
             * @param {?} key
             * @return {?}
             */
            function (key) {
                params = params.append(key, query[key]);
            }));
        }
        if (searchParams) {
            params = params.append('filter', JSON.stringify(searchParams));
        }
        if (sortParams) {
            params = params.append('sort', JSON.stringify(sortParams));
        }
        // params = params.append('_dc', (new Date()).getTime().toString());
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            if (_this.requestCacheService.hasCached(url)) {
                resolve(_this.requestCacheService.getCached(url));
            }
            else {
                _this.http.get(url, { params: params })
                    .pipe(timeout(_this.taminApplicationConfig.restTimeout))
                    .toPromise()
                    .then((/**
                 * @param {?} value
                 * @return {?}
                 */
                function (value) {
                    if (_this.requestCacheService.isCacheable(url)) {
                        _this.requestCacheService.setCache(url, value);
                    }
                    resolve(value);
                }))
                    .catch((/**
                 * @param {?} reason
                 * @return {?}
                 */
                function (reason) {
                    reject(reason);
                }));
            }
        }));
    };
    /**
     * @param {?} url
     * @param {?=} searchParams
     * @return {?}
     */
    TaminRestService.prototype.getBlob = /**
     * @param {?} url
     * @param {?=} searchParams
     * @return {?}
     */
    function (url, searchParams) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            /** @type {?} */
            var params = new HttpParams();
            if (searchParams) {
                params = params.append('filter', JSON.stringify(searchParams));
            }
            _this.http.get(url, { params: params, responseType: 'blob' })
                .pipe(timeout(_this.taminApplicationConfig.restTimeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return resolve(response); }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    /**
     * @param {?} url
     * @param {?=} querySearchParams
     * @param {?=} querySortParams
     * @param {?=} query
     * @return {?}
     */
    TaminRestService.prototype.getAll = /**
     * @param {?} url
     * @param {?=} querySearchParams
     * @param {?=} querySortParams
     * @param {?=} query
     * @return {?}
     */
    function (url, querySearchParams, querySortParams, query) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            if (url.trim() === '') {
                reject(new Error(_this.URL_ERROR));
            }
            _this.getData(url, null, null, querySearchParams, querySortParams, query)
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return resolve(response); }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    /**
     * @param {?} url
     * @param {?} pageNo
     * @param {?} pageSize
     * @param {?=} querySearchParams
     * @param {?=} querySortParams
     * @param {?=} query
     * @return {?}
     */
    TaminRestService.prototype.getPage = /**
     * @param {?} url
     * @param {?} pageNo
     * @param {?} pageSize
     * @param {?=} querySearchParams
     * @param {?=} querySortParams
     * @param {?=} query
     * @return {?}
     */
    function (url, pageNo, pageSize, querySearchParams, querySortParams, query) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.getData(url, pageNo, pageSize, querySearchParams, querySortParams, query)
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return resolve(response); }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    /**
     * @template TModel
     * @param {?} url
     * @param {?=} querySearchParams
     * @param {?=} querySortParams
     * @param {?=} query
     * @return {?}
     */
    TaminRestService.prototype.getAllManaged = /**
     * @template TModel
     * @param {?} url
     * @param {?=} querySearchParams
     * @param {?=} querySortParams
     * @param {?=} query
     * @return {?}
     */
    function (url, querySearchParams, querySortParams, query) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.getData(url, null, null, querySearchParams, querySortParams, query)
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                if (response.data) {
                    resolve((/** @type {?} */ (response.data)));
                }
                else if (response.list) {
                    resolve((/** @type {?} */ (response.list)));
                }
            }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    /**
     * @template TModel
     * @param {?} url
     * @param {?} pageNo
     * @param {?} pageSize
     * @param {?=} querySearchParams
     * @param {?=} querySortParams
     * @param {?=} query
     * @return {?}
     */
    TaminRestService.prototype.getPageManaged = /**
     * @template TModel
     * @param {?} url
     * @param {?} pageNo
     * @param {?} pageSize
     * @param {?=} querySearchParams
     * @param {?=} querySortParams
     * @param {?=} query
     * @return {?}
     */
    function (url, pageNo, pageSize, querySearchParams, querySortParams, query) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.getData(url, pageNo, pageSize, querySearchParams, querySortParams, query)
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                if (response.data) {
                    resolve((/** @type {?} */ (response.data)));
                }
                else if (response.list) {
                    resolve((/** @type {?} */ (response.list)));
                }
            }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    /**
     * @param {?} url
     * @param {?} id
     * @return {?}
     */
    TaminRestService.prototype.getById = /**
     * @param {?} url
     * @param {?} id
     * @return {?}
     */
    function (url, id) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            if (url.trim() === '') {
                reject(new Error(_this.URL_ERROR));
            }
            if (id.trim() === '') {
                reject(new Error(_this.ID_ERROR));
            }
            /** @type {?} */
            var theUrl = url + "/" + id;
            _this.getData(theUrl)
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return resolve(response); }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    /**
     * @template TModel
     * @param {?} url
     * @param {?} id
     * @return {?}
     */
    TaminRestService.prototype.getByIdManaged = /**
     * @template TModel
     * @param {?} url
     * @param {?} id
     * @return {?}
     */
    function (url, id) {
        var _this = this;
        /** @type {?} */
        var theUrl = url + "/" + id;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.getData(url)
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return resolve((/** @type {?} */ (response.data))); }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    /**
     * @param {?} url
     * @param {?} data
     * @return {?}
     */
    TaminRestService.prototype.create = /**
     * @param {?} url
     * @param {?} data
     * @return {?}
     */
    function (url, data) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            if (url.trim() === '') {
                reject(new Error(_this.URL_ERROR));
            }
            _this.http
                .post(url, data)
                .pipe(timeout(_this.taminApplicationConfig.restTimeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                resolve(response);
            }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                reject(error);
            }));
        }));
    };
    /**
     * @template TModel
     * @param {?} url
     * @param {?} id
     * @param {?} data
     * @return {?}
     */
    TaminRestService.prototype.update = /**
     * @template TModel
     * @param {?} url
     * @param {?} id
     * @param {?} data
     * @return {?}
     */
    function (url, id, data) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            if (url.toString().trim() === '') {
                reject(new Error(_this.URL_ERROR));
            }
            if (id.trim() === '') {
                reject(new Error(_this.ID_ERROR));
            }
            /** @type {?} */
            var theUrl = url + "/" + id.toString();
            _this.http
                .put(theUrl, data)
                .pipe(timeout(_this.taminApplicationConfig.restTimeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return resolve(response); }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    /**
     * @param {?} url
     * @param {?} id
     * @return {?}
     */
    TaminRestService.prototype.delete = /**
     * @param {?} url
     * @param {?} id
     * @return {?}
     */
    function (url, id) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            if (url.trim() === '') {
                reject(new Error(_this.URL_ERROR));
            }
            if (id.trim() === '') {
                reject(new Error(_this.ID_ERROR));
            }
            /** @type {?} */
            var theUrl = url + "/" + id;
            _this.http
                .delete(theUrl)
                .pipe(timeout(_this.taminApplicationConfig.restTimeout))
                .toPromise()
                .then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) { return resolve(response); }))
                .catch((/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return reject(error); }));
        }));
    };
    TaminRestService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    TaminRestService.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: ['taminApplicationConfig',] }] },
        { type: RequestCacheService },
        { type: HttpClient }
    ]; };
    /** @nocollapse */ TaminRestService.ngInjectableDef = i0.defineInjectable({ factory: function TaminRestService_Factory() { return new TaminRestService(i0.inject("taminApplicationConfig"), i0.inject(i1.RequestCacheService), i0.inject(i2.HttpClient)); }, token: TaminRestService, providedIn: "root" });
    return TaminRestService;
}());
export { TaminRestService };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    TaminRestService.prototype.URL_ERROR;
    /**
     * @type {?}
     * @protected
     */
    TaminRestService.prototype.ID_ERROR;
    /**
     * @type {?}
     * @private
     */
    TaminRestService.prototype.taminApplicationConfig;
    /**
     * @type {?}
     * @private
     */
    TaminRestService.prototype.requestCacheService;
    /**
     * @type {?}
     * @private
     */
    TaminRestService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFtaW4tcmVzdC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vdGFtaW4tZnJhbWV3b3JrLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3RhbWluLXJlc3Qtc2VydmljZS90YW1pbi1yZXN0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxNQUFNLEVBQUUsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ2pELE9BQU8sRUFBQyxVQUFVLEVBQUUsVUFBVSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFHNUQsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBRXZDLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLDBCQUEwQixDQUFDOzs7O0FBRzdEO0lBUUUsMEJBQXNELHNCQUErQyxFQUNqRixtQkFBd0MsRUFDeEMsSUFBZ0I7UUFGa0IsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUF5QjtRQUNqRix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBQ3hDLFNBQUksR0FBSixJQUFJLENBQVk7UUFMMUIsY0FBUyxHQUFHLG1CQUFtQixDQUFDO1FBQ2hDLGFBQVEsR0FBRyxrQkFBa0IsQ0FBQztJQUt4QyxDQUFDOzs7Ozs7Ozs7OztJQUVTLGtDQUFPOzs7Ozs7Ozs7O0lBQWpCLFVBQ0UsR0FBVyxFQUNYLE1BQWUsRUFDZixRQUFpQixFQUNqQixZQUE0QixFQUM1QixVQUF3QixFQUN4QixLQUFjO1FBTmhCLGlCQWdEQzs7O1lBeENLLE1BQU0sR0FBRyxJQUFJLFVBQVUsRUFBRTtRQUU3QixJQUFJLE1BQU0sSUFBSSxRQUFRLEVBQUU7WUFDdEIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ2xELE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsTUFBTSxHQUFHLENB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RXRDLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDckIsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO2FBQ25DO1lBRUQsSUFBSSxFQUFFLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO2dCQUNwQixNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7YUFDbEM7O2dCQUVLLE1BQU0sR0FBTSxHQUFHLFNBQUksRUFBSTtZQUM3QixLQUFJLENBQUMsSUFBSTtpQkFDTixNQUFNLENBQUMsTUFBTSxDQUFDO2lCQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSSxDQUFDLHNCQUFzQixDQUFDLFdBQVcsQ0FBQyxDQUFDO2lCQUN0RCxTQUFTLEVBQUU7aUJBQ1gsSUFBSTs7OztZQUFDLFVBQUMsUUFBUSxJQUFLLE9BQUEsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFqQixDQUFpQixFQUFDO2lCQUNyQyxLQUFLOzs7O1lBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQWIsQ0FBYSxFQUFDLENBQUM7UUFDckMsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOztnQkFuTkYsVUFBVSxTQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7OztnREFNYyxNQUFNLFNBQUMsd0JBQXdCO2dCQVh0QyxtQkFBbUI7Z0JBTG5CLFVBQVU7OzsyQkFEbEI7Q0E2TkMsQUFwTkQsSUFvTkM7U0FqTlksZ0JBQWdCOzs7Ozs7SUFFM0IscUNBQTBDOzs7OztJQUMxQyxvQ0FBd0M7Ozs7O0lBRTVCLGtEQUF5Rjs7Ozs7SUFDekYsK0NBQWdEOzs7OztJQUNoRCxnQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdCwgSW5qZWN0YWJsZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0h0dHBDbGllbnQsIEh0dHBQYXJhbXN9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7U2VhcmNoUGFyYW19IGZyb20gJy4uLy4uL21vZGVscy9zZWFyY2gtcGFyYW0ubW9kZWwnO1xuaW1wb3J0IHtTb3J0UGFyYW19IGZyb20gJy4uLy4uL21vZGVscy9zb3J0LXBhcmFtLm1vZGVsJztcbmltcG9ydCB7dGltZW91dH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtJVGFtaW5BcHBsaWNhdGlvbkNvbmZpZ30gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy90YW1pbi1hcHBsaWNhdGlvbi1jb25maWcnO1xuaW1wb3J0IHtSZXF1ZXN0Q2FjaGVTZXJ2aWNlfSBmcm9tICcuLi9yZXF1ZXN0LWNhY2hlLnNlcnZpY2UnO1xuXG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFRhbWluUmVzdFNlcnZpY2Uge1xuXG4gIHByb3RlY3RlZCBVUkxfRVJST1IgPSAndXJsIG5vdCBzcGVjaWZpZWQnO1xuICBwcm90ZWN0ZWQgSURfRVJST1IgPSAnaWQgbm90IHNwZWNpZmllZCc7XG5cbiAgY29uc3RydWN0b3IoQEluamVjdCgndGFtaW5BcHBsaWNhdGlvbkNvbmZpZycpIHByaXZhdGUgdGFtaW5BcHBsaWNhdGlvbkNvbmZpZzogSVRhbWluQXBwbGljYXRpb25Db25maWcsXG4gICAgICAgICAgICAgIHByaXZhdGUgcmVxdWVzdENhY2hlU2VydmljZTogUmVxdWVzdENhY2hlU2VydmljZSxcbiAgICAgICAgICAgICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0RGF0YShcbiAgICB1cmw6IHN0cmluZyxcbiAgICBwYWdlTm8/OiBudW1iZXIsXG4gICAgcGFnZVNpemU/OiBudW1iZXIsXG4gICAgc2VhcmNoUGFyYW1zPzogU2VhcmNoUGFyYW1bXSxcbiAgICBzb3J0UGFyYW1zPzogU29ydFBhcmFtW10sXG4gICAgcXVlcnk/OiBvYmplY3QpOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIGxldCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG5cbiAgICBpZiAocGFnZU5vICYmIHBhZ2VTaXplKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdwYWdlJywgcGFnZU5vLnRvU3RyaW5nKCkpO1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnc3RhcnQnLCAoKHBhZ2VObyAtIDEpICogcGFnZVNpemUpLnRvU3RyaW5nKCkpO1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnbGltaXQnLCBwYWdlU2l6ZS50b1N0cmluZygpKTtcbiAgICB9XG5cbiAgICBpZiAocXVlcnkpIHtcbiAgICAgIE9iamVjdC5rZXlzKHF1ZXJ5KS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZChrZXksIHF1ZXJ5W2tleV0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHNlYXJjaFBhcmFtcykge1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnZmlsdGVyJywgSlNPTi5zdHJpbmdpZnkoc2VhcmNoUGFyYW1zKSk7XG4gICAgfVxuICAgIGlmIChzb3J0UGFyYW1zKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdzb3J0JywgSlNPTi5zdHJpbmdpZnkoc29ydFBhcmFtcykpO1xuICAgIH1cbiAgICAvLyBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdfZGMnLCAobmV3IERhdGUoKSkuZ2V0VGltZSgpLnRvU3RyaW5nKCkpO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgaWYgKHRoaXMucmVxdWVzdENhY2hlU2VydmljZS5oYXNDYWNoZWQodXJsKSkge1xuICAgICAgICByZXNvbHZlKHRoaXMucmVxdWVzdENhY2hlU2VydmljZS5nZXRDYWNoZWQodXJsKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmh0dHAuZ2V0KHVybCwge3BhcmFtc30pXG4gICAgICAgICAgLnBpcGUodGltZW91dCh0aGlzLnRhbWluQXBwbGljYXRpb25Db25maWcucmVzdFRpbWVvdXQpKVxuICAgICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAgIC50aGVuKHZhbHVlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJlcXVlc3RDYWNoZVNlcnZpY2UuaXNDYWNoZWFibGUodXJsKSkge1xuICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RDYWNoZVNlcnZpY2Uuc2V0Q2FjaGUodXJsLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChyZWFzb24gPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBnZXRCbG9iKHVybDogc3RyaW5nLCBzZWFyY2hQYXJhbXM/OiBTZWFyY2hQYXJhbVtdKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8YW55PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICAgIGlmIChzZWFyY2hQYXJhbXMpIHtcbiAgICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnZmlsdGVyJywgSlNPTi5zdHJpbmdpZnkoc2VhcmNoUGFyYW1zKSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaHR0cC5nZXQodXJsLCB7cGFyYW1zLCByZXNwb25zZVR5cGU6ICdibG9iJ30pXG4gICAgICAgIC5waXBlKHRpbWVvdXQodGhpcy50YW1pbkFwcGxpY2F0aW9uQ29uZmlnLnJlc3RUaW1lb3V0KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0QWxsKHVybDogc3RyaW5nLCBxdWVyeVNlYXJjaFBhcmFtcz86IFNlYXJjaFBhcmFtW10sIHF1ZXJ5U29ydFBhcmFtcz86IFNvcnRQYXJhbVtdLCBxdWVyeT86IG9iamVjdCk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgaWYgKHVybC50cmltKCkgPT09ICcnKSB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IodGhpcy5VUkxfRVJST1IpKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5nZXREYXRhKHVybCwgbnVsbCwgbnVsbCwgcXVlcnlTZWFyY2hQYXJhbXMsIHF1ZXJ5U29ydFBhcmFtcywgcXVlcnkpXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0UGFnZSh1cmw6IHN0cmluZywgcGFnZU5vOiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIHF1ZXJ5U2VhcmNoUGFyYW1zPzogU2VhcmNoUGFyYW1bXSwgcXVlcnlTb3J0UGFyYW1zPzogU29ydFBhcmFtW10sIHF1ZXJ5Pzogb2JqZWN0KTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8YW55PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmdldERhdGEodXJsLCBwYWdlTm8sIHBhZ2VTaXplLCBxdWVyeVNlYXJjaFBhcmFtcywgcXVlcnlTb3J0UGFyYW1zLCBxdWVyeSlcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNvbHZlKHJlc3BvbnNlKSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gcmVqZWN0KGVycm9yKSk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRBbGxNYW5hZ2VkPFRNb2RlbD4odXJsOiBzdHJpbmcsIHF1ZXJ5U2VhcmNoUGFyYW1zPzogU2VhcmNoUGFyYW1bXSwgcXVlcnlTb3J0UGFyYW1zPzogU29ydFBhcmFtW10sIHF1ZXJ5Pzogb2JqZWN0KTogUHJvbWlzZTxUTW9kZWw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8VE1vZGVsPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmdldERhdGEodXJsLCBudWxsLCBudWxsLCBxdWVyeVNlYXJjaFBhcmFtcywgcXVlcnlTb3J0UGFyYW1zLCBxdWVyeSlcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkge1xuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhIGFzIFRNb2RlbCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5saXN0KSB7XG4gICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmxpc3QgYXMgVE1vZGVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0UGFnZU1hbmFnZWQ8VE1vZGVsPih1cmw6IHN0cmluZywgcGFnZU5vOiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIHF1ZXJ5U2VhcmNoUGFyYW1zPzogU2VhcmNoUGFyYW1bXSwgcXVlcnlTb3J0UGFyYW1zPzogU29ydFBhcmFtW10sIHF1ZXJ5Pzogb2JqZWN0KTogUHJvbWlzZTxUTW9kZWw+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8VE1vZGVsPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmdldERhdGEodXJsLCBwYWdlTm8sIHBhZ2VTaXplLCBxdWVyeVNlYXJjaFBhcmFtcywgcXVlcnlTb3J0UGFyYW1zLCBxdWVyeSlcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkge1xuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhIGFzIFRNb2RlbCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5saXN0KSB7XG4gICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmxpc3QgYXMgVE1vZGVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0QnlJZCh1cmw6IHN0cmluZywgaWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgaWYgKHVybC50cmltKCkgPT09ICcnKSB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IodGhpcy5VUkxfRVJST1IpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGlkLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcih0aGlzLklEX0VSUk9SKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRoZVVybCA9IGAke3VybH0vJHtpZH1gO1xuXG4gICAgICB0aGlzLmdldERhdGEodGhlVXJsKVxuICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc29sdmUocmVzcG9uc2UpKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiByZWplY3QoZXJyb3IpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEJ5SWRNYW5hZ2VkPFRNb2RlbD4odXJsOiBzdHJpbmcsIGlkOiBudW1iZXIpOiBQcm9taXNlPFRNb2RlbD4ge1xuICAgIGNvbnN0IHRoZVVybCA9IGAke3VybH0vJHtpZH1gO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuZ2V0RGF0YSh1cmwpXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzb2x2ZShyZXNwb25zZS5kYXRhIGFzIFRNb2RlbCkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlKHVybDogc3RyaW5nLCBkYXRhOiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGlmICh1cmwudHJpbSgpID09PSAnJykge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKHRoaXMuVVJMX0VSUk9SKSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaHR0cFxuICAgICAgICAucG9zdCh1cmwsIGRhdGEpXG4gICAgICAgIC5waXBlKHRpbWVvdXQodGhpcy50YW1pbkFwcGxpY2F0aW9uQ29uZmlnLnJlc3RUaW1lb3V0KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGU8VE1vZGVsPih1cmw6IHN0cmluZywgaWQ6IHN0cmluZywgZGF0YTogVE1vZGVsKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8YW55PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAodXJsLnRvU3RyaW5nKCkudHJpbSgpID09PSAnJykge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKHRoaXMuVVJMX0VSUk9SKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpZC50cmltKCkgPT09ICcnKSB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IodGhpcy5JRF9FUlJPUikpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0aGVVcmwgPSBgJHt1cmx9LyR7aWQudG9TdHJpbmcoKX1gO1xuICAgICAgdGhpcy5odHRwXG4gICAgICAgIC5wdXQodGhlVXJsLCBkYXRhKVxuICAgICAgICAucGlwZSh0aW1lb3V0KHRoaXMudGFtaW5BcHBsaWNhdGlvbkNvbmZpZy5yZXN0VGltZW91dCkpXG4gICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc29sdmUocmVzcG9uc2UpKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiByZWplY3QoZXJyb3IpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZSh1cmw6IHN0cmluZywgaWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXG4gICAgICBpZiAodXJsLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcih0aGlzLlVSTF9FUlJPUikpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaWQudHJpbSgpID09PSAnJykge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKHRoaXMuSURfRVJST1IpKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGhlVXJsID0gYCR7dXJsfS8ke2lkfWA7XG4gICAgICB0aGlzLmh0dHBcbiAgICAgICAgLmRlbGV0ZSh0aGVVcmwpXG4gICAgICAgIC5waXBlKHRpbWVvdXQodGhpcy50YW1pbkFwcGxpY2F0aW9uQ29uZmlnLnJlc3RUaW1lb3V0KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzb2x2ZShyZXNwb25zZSkpXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG59XG4iXX0=