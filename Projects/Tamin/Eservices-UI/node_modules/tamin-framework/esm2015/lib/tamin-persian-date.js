/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// Based on https://github.com/jalaali/jalaali-js
export class TaminPersianDate {
    constructor() {
        this.breaks = [-61, 9, 38, 199, 426, 686, 756, 818, 1111, 1181, 1210,
            1635, 2060, 2097, 2192, 2262, 2324, 2394, 2456, 3178
        ];
    }
    /**
     * @param {?} date
     * @return {?}
     */
    static GregorianToJalali(date) {
        /** @type {?} */
        const tmp = TaminPersianDate.taminPersianDate.toJalaali(date.getFullYear(), date.getMonth() + 1, date.getDate());
        return `${tmp.jy}/${TaminPersianDate.setLeadingZero(tmp.jm)}/${TaminPersianDate.setLeadingZero(tmp.jd)}`;
    }
    /**
     * @private
     * @param {?} val
     * @return {?}
     */
    static setLeadingZero(val) {
        if (Number(val) < 10) {
            return '0' + val.toString();
        }
        return val.toString();
    }
    /**
     * @param {?} year
     * @param {?} month
     * @param {?} day
     * @return {?}
     */
    static JalaliToGregorian(year, month, day) {
        if (TaminPersianDate.taminPersianDate.isValidJalaaliDate(year, month, day)) {
            /** @type {?} */
            const tmp = TaminPersianDate.taminPersianDate.toGregorian(year, month, day);
            return new Date(tmp.gy, tmp.gm - 1, tmp.gd, 0, 0, 0, 0);
        }
        throw new Error('Invalid parameters');
    }
    /**
     * @param {?} date
     * @return {?}
     */
    static FirstDayInMonth(date) {
        /** @type {?} */
        const tmp = TaminPersianDate.taminPersianDate.toJalaali(date.getFullYear(), date.getMonth() + 1, date.getDate());
        return TaminPersianDate.JalaliToGregorian(tmp.jy, tmp.jm, 1);
    }
    /**
     * @param {?} date
     * @return {?}
     */
    static GetNextMonth(date) {
        /** @type {?} */
        const tmp = TaminPersianDate.taminPersianDate.toJalaali(date.getFullYear(), date.getMonth() + 1, date.getDate());
        /** @type {?} */
        let month = tmp.jm + 1;
        /** @type {?} */
        let year = tmp.jy;
        /** @type {?} */
        let day = tmp.jd;
        if (month > 12) {
            month = 1;
            year += 1;
        }
        if (month > 6 && day > 30) {
            day = 30;
        }
        if (month === 12 && TaminPersianDate.taminPersianDate.isLeapJalaaliYear(year) && day > 29) {
            day = 29;
        }
        return TaminPersianDate.JalaliToGregorian(year, month, day);
    }
    /**
     * @param {?} date
     * @return {?}
     */
    static GetPrevMonth(date) {
        /** @type {?} */
        const tmp = TaminPersianDate.taminPersianDate.toJalaali(date.getFullYear(), date.getMonth() + 1, date.getDate());
        /** @type {?} */
        let month = tmp.jm - 1;
        /** @type {?} */
        let year = tmp.jy;
        /** @type {?} */
        let day = tmp.jd;
        if (month === 0) {
            month = 1;
            year -= 1;
        }
        if (month > 6 && day > 30) {
            day = 30;
        }
        if (month === 12 && TaminPersianDate.taminPersianDate.isLeapJalaaliYear(year) && day > 29) {
            day = 29;
        }
        return TaminPersianDate.JalaliToGregorian(year, month, day);
    }
    /*
      Converts a Gregorian date to Jalaali.
      */
    /**
     * @param {?} gy
     * @param {?} gm
     * @param {?} gd
     * @return {?}
     */
    toJalaali(gy, gm, gd) {
        if (Object.prototype.toString.call(gy) === '[object Date]') {
            gd = gy.getDate();
            gm = gy.getMonth() + 1;
            gy = gy.getFullYear();
        }
        return this.d2j(this.g2d(gy, gm, gd));
    }
    /*
        Converts a Jalaali date to Gregorian.
      */
    /**
     * @param {?} jy
     * @param {?} jm
     * @param {?} jd
     * @return {?}
     */
    toGregorian(jy, jm, jd) {
        return this.d2g(this.j2d(jy, jm, jd));
    }
    /*
        Checks whether a Jalaali date is valid or not.
      */
    /**
     * @param {?} jy
     * @param {?} jm
     * @param {?} jd
     * @return {?}
     */
    isValidJalaaliDate(jy, jm, jd) {
        return jy >= -61 && jy <= 3177 &&
            jm >= 1 && jm <= 12 &&
            jd >= 1 && jd <= this.jalaaliMonthLength(jy, jm);
    }
    /*
        Is this a leap year or not?
      */
    /**
     * @param {?} jy
     * @return {?}
     */
    isLeapJalaaliYear(jy) {
        return this.jalCalLeap(jy) === 0;
    }
    /*
        Number of days in a given month in a Jalaali year.
      */
    /**
     * @param {?} jy
     * @param {?} jm
     * @return {?}
     */
    jalaaliMonthLength(jy, jm) {
        if (jm <= 6) {
            return 31;
        }
        if (jm <= 11) {
            return 30;
        }
        if (this.isLeapJalaaliYear(jy)) {
            return 30;
        }
        return 29;
    }
    /*
          This function determines if the Jalaali (Persian) year is
          leap (366-day long) or is the common year (365 days)
    
          @param jy Jalaali calendar year (-61 to 3177)
          @returns number of years since the last leap year (0 to 4)
       */
    /**
     * @param {?} jy
     * @return {?}
     */
    jalCalLeap(jy) {
        // tslint:disable-next-line:prefer-const
        /** @type {?} */
        let bl = this.breaks.length;
        /** @type {?} */
        let jp = this.breaks[0];
        /** @type {?} */
        let jm;
        /** @type {?} */
        let jump;
        /** @type {?} */
        let leap;
        /** @type {?} */
        let n;
        /** @type {?} */
        let i;
        if (jy < jp || jy >= this.breaks[bl - 1]) {
            throw new Error('Invalid Jalaali year ' + jy);
        }
        for (i = 1; i < bl; i += 1) {
            jm = this.breaks[i];
            jump = jm - jp;
            if (jy < jm) {
                break;
            }
            jp = jm;
        }
        n = jy - jp;
        if (jump - n < 6) {
            n = n - jump + this.div(jump + 4, 33) * 33;
        }
        leap = this.mod(this.mod(n + 1, 33) - 1, 4);
        if (leap === -1) {
            leap = 4;
        }
        return leap;
    }
    /*
        This function determines if the Jalaali (Persian) year is
        leap (366-day long) or is the common year (365 days), and
        finds the day in March (Gregorian calendar) of the first
        day of the Jalaali year (jy).
    
        @param jy Jalaali calendar year (-61 to 3177)
        @param withoutLeap when don't need leap (true or false) default is false
        @return
          leap: number of years since the last leap year (0 to 4)
          gy: Gregorian year of the beginning of Jalaali year
          march: the March day of Farvardin the 1st (1st day of jy)
        @see: http://www.astro.uni.torun.pl/~kb/Papers/EMP/PersianC-EMP.htm
        @see: http://www.fourmilab.ch/documents/calendar/
      */
    /**
     * @param {?} jy
     * @param {?} withoutLeap
     * @return {?}
     */
    jalCal(jy, withoutLeap) {
        // tslint:disable-next-line:prefer-const
        /** @type {?} */
        let bl = this.breaks.length
        // tslint:disable-next-line:prefer-const
        ;
        /** @type {?} */
        let gy = jy + 621;
        /** @type {?} */
        let leapJ = -14;
        /** @type {?} */
        let jp = this.breaks[0];
        /** @type {?} */
        let jm;
        /** @type {?} */
        let jump;
        /** @type {?} */
        let leap;
        /** @type {?} */
        let leapG;
        /** @type {?} */
        let march;
        /** @type {?} */
        let n;
        /** @type {?} */
        let i;
        if (jy < jp || jy >= this.breaks[bl - 1]) {
            throw new Error('Invalid Jalaali year ' + jy);
        }
        // Find the limiting years for the Jalaali year jy.
        for (i = 1; i < bl; i += 1) {
            jm = this.breaks[i];
            jump = jm - jp;
            if (jy < jm) {
                break;
            }
            leapJ = leapJ + this.div(jump, 33) * 8 + this.div(this.mod(jump, 33), 4);
            jp = jm;
        }
        n = jy - jp;
        // Find the number of leap years from AD 621 to the beginning
        // of the current Jalaali year in the Persian calendar.
        leapJ = leapJ + this.div(n, 33) * 8 + this.div(this.mod(n, 33) + 3, 4);
        if (this.mod(jump, 33) === 4 && jump - n === 4) {
            leapJ += 1;
        }
        // And the same in the Gregorian calendar (until the year gy).
        leapG = this.div(gy, 4) - this.div((this.div(gy, 100) + 1) * 3, 4) - 150;
        // Determine the Gregorian date of Farvardin the 1st.
        march = 20 + leapJ - leapG;
        // return with gy and march when we don't need leap
        if (withoutLeap) {
            return { gy: gy, march: march };
        }
        // Find how many years have passed since the last leap year.
        if (jump - n < 6) {
            n = n - jump + this.div(jump + 4, 33) * 33;
        }
        leap = this.mod(this.mod(n + 1, 33) - 1, 4);
        if (leap === -1) {
            leap = 4;
        }
        return {
            leap: leap,
            gy: gy,
            march: march
        };
    }
    /*
        Converts a date of the Jalaali calendar to the Julian Day number.
    
        @param jy Jalaali year (1 to 3100)
        @param jm Jalaali month (1 to 12)
        @param jd Jalaali day (1 to 29/31)
        @return Julian Day number
      */
    /**
     * @param {?} jy
     * @param {?} jm
     * @param {?} jd
     * @return {?}
     */
    j2d(jy, jm, jd) {
        /** @type {?} */
        const r = this.jalCal(jy, true);
        return this.g2d(r.gy, 3, r.march) + (jm - 1) * 31 - this.div(jm, 7) * (jm - 7) + jd - 1;
    }
    /*
        Converts the Julian Day number to a date in the Jalaali calendar.
    
        @param jdn Julian Day number
        @return
          jy: Jalaali year (1 to 3100)
          jm: Jalaali month (1 to 12)
          jd: Jalaali day (1 to 29/31)
      */
    /**
     * @param {?} jdn
     * @return {?}
     */
    d2j(jdn) {
        // tslint:disable-next-line:prefer-const
        /** @type {?} */
        let gy = this.d2g(jdn).gy // Calculate Gregorian year (gy).
        ;
        /** @type {?} */
        let jy = gy - 621
        // tslint:disable-next-line:prefer-const
        ;
        /** @type {?} */
        let r = this.jalCal(jy, false)
        // tslint:disable-next-line:prefer-const
        ;
        /** @type {?} */
        let jdn1f = this.g2d(gy, 3, r.march);
        /** @type {?} */
        let jd;
        /** @type {?} */
        let jm;
        /** @type {?} */
        let k;
        // Find number of days that passed since 1 Farvardin.
        k = jdn - jdn1f;
        if (k >= 0) {
            if (k <= 185) {
                // The first 6 months.
                jm = 1 + this.div(k, 31);
                jd = this.mod(k, 31) + 1;
                return {
                    jy: jy,
                    jm: jm,
                    jd: jd
                };
            }
            else {
                // The remaining months.
                k -= 186;
            }
        }
        else {
            // Previous Jalaali year.
            jy -= 1;
            k += 179;
            if (r.leap === 1) {
                k += 1;
            }
        }
        jm = 7 + this.div(k, 30);
        jd = this.mod(k, 30) + 1;
        return {
            jy: jy,
            jm: jm,
            jd: jd
        };
    }
    /*
        Calculates the Julian Day number from Gregorian or Julian
        calendar dates. This integer number corresponds to the noon of
        the date (i.e. 12 hours of Universal Time).
        The procedure was tested to be good since 1 March, -100100 (of both
        calendars) up to a few million years into the future.
    
        @param gy Calendar year (years BC numbered 0, -1, -2, ...)
        @param gm Calendar month (1 to 12)
        @param gd Calendar day of the month (1 to 28/29/30/31)
        @return Julian Day number
      */
    /**
     * @param {?} gy
     * @param {?} gm
     * @param {?} gd
     * @return {?}
     */
    g2d(gy, gm, gd) {
        /** @type {?} */
        let d = this.div((gy + this.div(gm - 8, 6) + 100100) * 1461, 4)
            + this.div(153 * this.mod(gm + 9, 12) + 2, 5)
            + gd - 34840408;
        d = d - this.div(this.div(gy + 100100 + this.div(gm - 8, 6), 100) * 3, 4) + 752;
        return d;
    }
    /*
        Calculates Gregorian and Julian calendar dates from the Julian Day number
        (jdn) for the period since jdn=-34839655 (i.e. the year -100100 of both
        calendars) to some millions years ahead of the present.
    
        @param jdn Julian Day number
        @return
          gy: Calendar year (years BC numbered 0, -1, -2, ...)
          gm: Calendar month (1 to 12)
          gd: Calendar day of the month M (1 to 28/29/30/31)
      */
    /**
     * @param {?} jdn
     * @return {?}
     */
    d2g(jdn) {
        /** @type {?} */
        let j;
        /** @type {?} */
        let i;
        /** @type {?} */
        let gd;
        /** @type {?} */
        let gm;
        /** @type {?} */
        let gy;
        j = 4 * jdn + 139361631;
        j = j + this.div(this.div(4 * jdn + 183187720, 146097) * 3, 4) * 4 - 3908;
        i = this.div(this.mod(j, 1461), 4) * 5 + 308;
        gd = this.div(this.mod(i, 153), 5) + 1;
        gm = this.mod(this.div(i, 153), 12) + 1;
        gy = this.div(j, 1461) - 100100 + this.div(8 - gm, 6);
        return {
            gy: gy,
            gm: gm,
            gd: gd
        };
    }
    /*
        Utility helper functions.
      */
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    div(a, b) {
        // tslint:disable-next-line:no-bitwise
        return ~~(a / b);
    }
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    mod(a, b) {
        // tslint:disable-next-line:no-bitwise
        return a - ~~(a / b) * b;
    }
}
TaminPersianDate.taminPersianDate = new TaminPersianDate();
if (false) {
    /**
     * @type {?}
     * @private
     */
    TaminPersianDate.taminPersianDate;
    /** @type {?} */
    TaminPersianDate.prototype.breaks;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFtaW4tcGVyc2lhbi1kYXRlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vdGFtaW4tZnJhbWV3b3JrLyIsInNvdXJjZXMiOlsibGliL3RhbWluLXBlcnNpYW4tZGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE1BQU0sT0FBTyxnQkFBZ0I7SUFBN0I7UUFFUyxXQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQ2xFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtTQUN2RCxDQUFDO0lBcVhKLENBQUM7Ozs7O0lBblhRLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFVOztjQUNsQyxHQUFHLEdBQUcsZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNoSCxPQUFPLEdBQUcsR0FBRyxDQUFDLEVBQUUsSUFBSSxnQkFBZ0IsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztJQUMzRyxDQUFDOzs7Ozs7SUFFTyxNQUFNLENBQUMsY0FBYyxDQUFDLEdBQUc7UUFDL0IsSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3BCLE9BQU8sR0FBRyxHQUFHLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUM3QjtRQUNELE9BQU8sR0FBRyxDQUFDLFFBQVEsRUFB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QztJQUNuQixDQUFDOzs7Ozs7SUFFTSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDYixzQ0FBc0M7UUFDdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMzQixDQUFDOztBQXZYYyxpQ0FBZ0IsR0FBRyxJQUFJLGdCQUFnQixFQUFFLENBQUM7Ozs7OztJQUF6RCxrQ0FBeUQ7O0lBQ3pELGtDQUVFIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL2phbGFhbGkvamFsYWFsaS1qc1xyXG5leHBvcnQgY2xhc3MgVGFtaW5QZXJzaWFuRGF0ZSB7XHJcbiAgcHJpdmF0ZSBzdGF0aWMgdGFtaW5QZXJzaWFuRGF0ZSA9IG5ldyBUYW1pblBlcnNpYW5EYXRlKCk7XHJcbiAgcHVibGljIGJyZWFrcyA9IFstNjEsIDksIDM4LCAxOTksIDQyNiwgNjg2LCA3NTYsIDgxOCwgMTExMSwgMTE4MSwgMTIxMFxyXG4gICAgLCAxNjM1LCAyMDYwLCAyMDk3LCAyMTkyLCAyMjYyLCAyMzI0LCAyMzk0LCAyNDU2LCAzMTc4XHJcbiAgXTtcclxuXHJcbiAgcHVibGljIHN0YXRpYyBHcmVnb3JpYW5Ub0phbGFsaShkYXRlOiBEYXRlKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHRtcCA9IFRhbWluUGVyc2lhbkRhdGUudGFtaW5QZXJzaWFuRGF0ZS50b0phbGFhbGkoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKSk7XHJcbiAgICByZXR1cm4gYCR7dG1wLmp5fS8ke1RhbWluUGVyc2lhbkRhdGUuc2V0TGVhZGluZ1plcm8odG1wLmptKX0vJHtUYW1pblBlcnNpYW5EYXRlLnNldExlYWRpbmdaZXJvKHRtcC5qZCl9YDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHNldExlYWRpbmdaZXJvKHZhbCkge1xyXG4gICAgaWYgKE51bWJlcih2YWwpIDwgMTApIHtcclxuICAgICAgcmV0dXJuICcwJyArIHZhbC50b1N0cmluZygpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbC50b1N0cmluZygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBKYWxhbGlUb0dyZWdvcmlhbih5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIsIGRheTogbnVtYmVyKTogRGF0ZSB7XHJcbiAgICBpZiAoVGFtaW5QZXJzaWFuRGF0ZS50YW1pblBlcnNpYW5EYXRlLmlzVmFsaWRKYWxhYWxpRGF0ZSh5ZWFyLCBtb250aCwgZGF5KSkge1xyXG4gICAgICBjb25zdCB0bXAgPSBUYW1pblBlcnNpYW5EYXRlLnRhbWluUGVyc2lhbkRhdGUudG9HcmVnb3JpYW4oeWVhciwgbW9udGgsIGRheSk7XHJcbiAgICAgIHJldHVybiBuZXcgRGF0ZSh0bXAuZ3ksIHRtcC5nbSAtIDEsIHRtcC5nZCwgMCwgMCwgMCwgMCk7XHJcbiAgICB9XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGFyYW1ldGVycycpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBGaXJzdERheUluTW9udGgoZGF0ZTogRGF0ZSk6IERhdGUge1xyXG4gICAgY29uc3QgdG1wID0gVGFtaW5QZXJzaWFuRGF0ZS50YW1pblBlcnNpYW5EYXRlLnRvSmFsYWFsaShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSArIDEsIGRhdGUuZ2V0RGF0ZSgpKTtcclxuICAgIHJldHVybiBUYW1pblBlcnNpYW5EYXRlLkphbGFsaVRvR3JlZ29yaWFuKHRtcC5qeSwgdG1wLmptLCAxKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgR2V0TmV4dE1vbnRoKGRhdGU6IERhdGUpOiBEYXRlIHtcclxuICAgIGNvbnN0IHRtcCA9IFRhbWluUGVyc2lhbkRhdGUudGFtaW5QZXJzaWFuRGF0ZS50b0phbGFhbGkoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKSk7XHJcbiAgICBsZXQgbW9udGggPSB0bXAuam0gKyAxO1xyXG4gICAgbGV0IHllYXIgPSB0bXAuank7XHJcbiAgICBsZXQgZGF5ID0gdG1wLmpkO1xyXG5cclxuICAgIGlmIChtb250aCA+IDEyKSB7XHJcbiAgICAgIG1vbnRoID0gMTtcclxuICAgICAgeWVhciArPSAxO1xyXG4gICAgfVxyXG4gICAgIGlmIChtb250aCA+IDYgJiYgZGF5ID4gMzApIHtcclxuICAgICAgIGRheSA9IDMwO1xyXG4gICAgIH1cclxuXHJcbiAgICBpZiAobW9udGggPT09IDEyICYmIFRhbWluUGVyc2lhbkRhdGUudGFtaW5QZXJzaWFuRGF0ZS5pc0xlYXBKYWxhYWxpWWVhcih5ZWFyKSAmJiBkYXkgPiAyOSkge1xyXG4gICAgICBkYXkgPSAyOTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gVGFtaW5QZXJzaWFuRGF0ZS5KYWxhbGlUb0dyZWdvcmlhbih5ZWFyLCBtb250aCwgZGF5KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgR2V0UHJldk1vbnRoKGRhdGU6IERhdGUpOiBEYXRlIHtcclxuICAgIGNvbnN0IHRtcCA9IFRhbWluUGVyc2lhbkRhdGUudGFtaW5QZXJzaWFuRGF0ZS50b0phbGFhbGkoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKSk7XHJcbiAgICBsZXQgbW9udGggPSB0bXAuam0gLSAxO1xyXG4gICAgbGV0IHllYXIgPSB0bXAuank7XHJcbiAgICBsZXQgZGF5ID0gdG1wLmpkO1xyXG5cclxuICAgIGlmIChtb250aCA9PT0gMCkge1xyXG4gICAgICBtb250aCA9IDE7XHJcbiAgICAgIHllYXIgLT0gMTtcclxuICAgIH1cclxuICAgICBpZiAobW9udGggPiA2ICYmIGRheSA+IDMwKSB7XHJcbiAgICAgICBkYXkgPSAzMDtcclxuICAgICB9XHJcblxyXG4gICAgaWYgKG1vbnRoID09PSAxMiAmJiBUYW1pblBlcnNpYW5EYXRlLnRhbWluUGVyc2lhbkRhdGUuaXNMZWFwSmFsYWFsaVllYXIoeWVhcikgJiYgZGF5ID4gMjkpIHtcclxuICAgICAgZGF5ID0gMjk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIFRhbWluUGVyc2lhbkRhdGUuSmFsYWxpVG9HcmVnb3JpYW4oeWVhciwgbW9udGgsIGRheSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLypcclxuICBDb252ZXJ0cyBhIEdyZWdvcmlhbiBkYXRlIHRvIEphbGFhbGkuXHJcbiAgKi9cclxuICBwdWJsaWMgdG9KYWxhYWxpKGd5LCBnbSwgZ2QpIHtcclxuICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZ3kpID09PSAnW29iamVjdCBEYXRlXScpIHtcclxuICAgICAgZ2QgPSBneS5nZXREYXRlKCk7XHJcbiAgICAgIGdtID0gZ3kuZ2V0TW9udGgoKSArIDE7XHJcbiAgICAgIGd5ID0gZ3kuZ2V0RnVsbFllYXIoKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmQyaih0aGlzLmcyZChneSwgZ20sIGdkKSk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgQ29udmVydHMgYSBKYWxhYWxpIGRhdGUgdG8gR3JlZ29yaWFuLlxyXG4gICovXHJcbiAgcHVibGljIHRvR3JlZ29yaWFuKGp5LCBqbSwgamQpIHtcclxuICAgIHJldHVybiB0aGlzLmQyZyh0aGlzLmoyZChqeSwgam0sIGpkKSk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgQ2hlY2tzIHdoZXRoZXIgYSBKYWxhYWxpIGRhdGUgaXMgdmFsaWQgb3Igbm90LlxyXG4gICovXHJcbiAgcHVibGljIGlzVmFsaWRKYWxhYWxpRGF0ZShqeSwgam0sIGpkKSB7XHJcbiAgICByZXR1cm4gankgPj0gLTYxICYmIGp5IDw9IDMxNzcgJiZcclxuICAgICAgam0gPj0gMSAmJiBqbSA8PSAxMiAmJlxyXG4gICAgICBqZCA+PSAxICYmIGpkIDw9IHRoaXMuamFsYWFsaU1vbnRoTGVuZ3RoKGp5LCBqbSk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgSXMgdGhpcyBhIGxlYXAgeWVhciBvciBub3Q/XHJcbiAgKi9cclxuICBwdWJsaWMgaXNMZWFwSmFsYWFsaVllYXIoankpIHtcclxuICAgIHJldHVybiB0aGlzLmphbENhbExlYXAoankpID09PSAwO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgIE51bWJlciBvZiBkYXlzIGluIGEgZ2l2ZW4gbW9udGggaW4gYSBKYWxhYWxpIHllYXIuXHJcbiAgKi9cclxuICBwdWJsaWMgamFsYWFsaU1vbnRoTGVuZ3RoKGp5LCBqbSkge1xyXG4gICAgaWYgKGptIDw9IDYpIHtcclxuICAgICAgcmV0dXJuIDMxO1xyXG4gICAgfVxyXG4gICAgaWYgKGptIDw9IDExKSB7XHJcbiAgICAgIHJldHVybiAzMDtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmlzTGVhcEphbGFhbGlZZWFyKGp5KSkge1xyXG4gICAgICByZXR1cm4gMzA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMjk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgICBUaGlzIGZ1bmN0aW9uIGRldGVybWluZXMgaWYgdGhlIEphbGFhbGkgKFBlcnNpYW4pIHllYXIgaXNcclxuICAgICAgbGVhcCAoMzY2LWRheSBsb25nKSBvciBpcyB0aGUgY29tbW9uIHllYXIgKDM2NSBkYXlzKVxyXG5cclxuICAgICAgQHBhcmFtIGp5IEphbGFhbGkgY2FsZW5kYXIgeWVhciAoLTYxIHRvIDMxNzcpXHJcbiAgICAgIEByZXR1cm5zIG51bWJlciBvZiB5ZWFycyBzaW5jZSB0aGUgbGFzdCBsZWFwIHllYXIgKDAgdG8gNClcclxuICAgKi9cclxuICBwdWJsaWMgamFsQ2FsTGVhcChqeSkge1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1jb25zdFxyXG4gICAgbGV0IGJsID0gdGhpcy5icmVha3MubGVuZ3RoXHJcbiAgICAgICwganAgPSB0aGlzLmJyZWFrc1swXVxyXG4gICAgICAsIGptXHJcbiAgICAgICwganVtcFxyXG4gICAgICAsIGxlYXBcclxuICAgICAgLCBuXHJcbiAgICAgICwgaTtcclxuXHJcbiAgICBpZiAoankgPCBqcCB8fCBqeSA+PSB0aGlzLmJyZWFrc1tibCAtIDFdKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBKYWxhYWxpIHllYXIgJyArIGp5KTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGkgPSAxOyBpIDwgYmw7IGkgKz0gMSkge1xyXG4gICAgICBqbSA9IHRoaXMuYnJlYWtzW2ldO1xyXG4gICAgICBqdW1wID0gam0gLSBqcDtcclxuICAgICAgaWYgKGp5IDwgam0pIHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBqcCA9IGptO1xyXG4gICAgfVxyXG4gICAgbiA9IGp5IC0ganA7XHJcblxyXG4gICAgaWYgKGp1bXAgLSBuIDwgNikge1xyXG4gICAgICBuID0gbiAtIGp1bXAgKyB0aGlzLmRpdihqdW1wICsgNCwgMzMpICogMzM7XHJcbiAgICB9XHJcbiAgICBsZWFwID0gdGhpcy5tb2QodGhpcy5tb2QobiArIDEsIDMzKSAtIDEsIDQpO1xyXG4gICAgaWYgKGxlYXAgPT09IC0xKSB7XHJcbiAgICAgIGxlYXAgPSA0O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBsZWFwO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgIFRoaXMgZnVuY3Rpb24gZGV0ZXJtaW5lcyBpZiB0aGUgSmFsYWFsaSAoUGVyc2lhbikgeWVhciBpc1xyXG4gICAgbGVhcCAoMzY2LWRheSBsb25nKSBvciBpcyB0aGUgY29tbW9uIHllYXIgKDM2NSBkYXlzKSwgYW5kXHJcbiAgICBmaW5kcyB0aGUgZGF5IGluIE1hcmNoIChHcmVnb3JpYW4gY2FsZW5kYXIpIG9mIHRoZSBmaXJzdFxyXG4gICAgZGF5IG9mIHRoZSBKYWxhYWxpIHllYXIgKGp5KS5cclxuXHJcbiAgICBAcGFyYW0gankgSmFsYWFsaSBjYWxlbmRhciB5ZWFyICgtNjEgdG8gMzE3NylcclxuICAgIEBwYXJhbSB3aXRob3V0TGVhcCB3aGVuIGRvbid0IG5lZWQgbGVhcCAodHJ1ZSBvciBmYWxzZSkgZGVmYXVsdCBpcyBmYWxzZVxyXG4gICAgQHJldHVyblxyXG4gICAgICBsZWFwOiBudW1iZXIgb2YgeWVhcnMgc2luY2UgdGhlIGxhc3QgbGVhcCB5ZWFyICgwIHRvIDQpXHJcbiAgICAgIGd5OiBHcmVnb3JpYW4geWVhciBvZiB0aGUgYmVnaW5uaW5nIG9mIEphbGFhbGkgeWVhclxyXG4gICAgICBtYXJjaDogdGhlIE1hcmNoIGRheSBvZiBGYXJ2YXJkaW4gdGhlIDFzdCAoMXN0IGRheSBvZiBqeSlcclxuICAgIEBzZWU6IGh0dHA6Ly93d3cuYXN0cm8udW5pLnRvcnVuLnBsL35rYi9QYXBlcnMvRU1QL1BlcnNpYW5DLUVNUC5odG1cclxuICAgIEBzZWU6IGh0dHA6Ly93d3cuZm91cm1pbGFiLmNoL2RvY3VtZW50cy9jYWxlbmRhci9cclxuICAqL1xyXG4gIHB1YmxpYyBqYWxDYWwoanksIHdpdGhvdXRMZWFwKSB7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWNvbnN0XHJcbiAgICBsZXQgYmwgPSB0aGlzLmJyZWFrcy5sZW5ndGhcclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1jb25zdFxyXG4gICAgICAsIGd5ID0gankgKyA2MjFcclxuICAgICAgLCBsZWFwSiA9IC0xNFxyXG4gICAgICAsIGpwID0gdGhpcy5icmVha3NbMF1cclxuICAgICAgLCBqbVxyXG4gICAgICAsIGp1bXBcclxuICAgICAgLCBsZWFwXHJcbiAgICAgICwgbGVhcEdcclxuICAgICAgLCBtYXJjaFxyXG4gICAgICAsIG5cclxuICAgICAgLCBpO1xyXG5cclxuICAgIGlmIChqeSA8IGpwIHx8IGp5ID49IHRoaXMuYnJlYWtzW2JsIC0gMV0pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIEphbGFhbGkgeWVhciAnICsgankpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZpbmQgdGhlIGxpbWl0aW5nIHllYXJzIGZvciB0aGUgSmFsYWFsaSB5ZWFyIGp5LlxyXG4gICAgZm9yIChpID0gMTsgaSA8IGJsOyBpICs9IDEpIHtcclxuICAgICAgam0gPSB0aGlzLmJyZWFrc1tpXTtcclxuICAgICAganVtcCA9IGptIC0ganA7XHJcbiAgICAgIGlmIChqeSA8IGptKSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgbGVhcEogPSBsZWFwSiArIHRoaXMuZGl2KGp1bXAsIDMzKSAqIDggKyB0aGlzLmRpdih0aGlzLm1vZChqdW1wLCAzMyksIDQpO1xyXG4gICAgICBqcCA9IGptO1xyXG4gICAgfVxyXG4gICAgbiA9IGp5IC0ganA7XHJcblxyXG4gICAgLy8gRmluZCB0aGUgbnVtYmVyIG9mIGxlYXAgeWVhcnMgZnJvbSBBRCA2MjEgdG8gdGhlIGJlZ2lubmluZ1xyXG4gICAgLy8gb2YgdGhlIGN1cnJlbnQgSmFsYWFsaSB5ZWFyIGluIHRoZSBQZXJzaWFuIGNhbGVuZGFyLlxyXG4gICAgbGVhcEogPSBsZWFwSiArIHRoaXMuZGl2KG4sIDMzKSAqIDggKyB0aGlzLmRpdih0aGlzLm1vZChuLCAzMykgKyAzLCA0KTtcclxuICAgIGlmICh0aGlzLm1vZChqdW1wLCAzMykgPT09IDQgJiYganVtcCAtIG4gPT09IDQpIHtcclxuICAgICAgbGVhcEogKz0gMTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBbmQgdGhlIHNhbWUgaW4gdGhlIEdyZWdvcmlhbiBjYWxlbmRhciAodW50aWwgdGhlIHllYXIgZ3kpLlxyXG4gICAgbGVhcEcgPSB0aGlzLmRpdihneSwgNCkgLSB0aGlzLmRpdigodGhpcy5kaXYoZ3ksIDEwMCkgKyAxKSAqIDMsIDQpIC0gMTUwO1xyXG5cclxuICAgIC8vIERldGVybWluZSB0aGUgR3JlZ29yaWFuIGRhdGUgb2YgRmFydmFyZGluIHRoZSAxc3QuXHJcbiAgICBtYXJjaCA9IDIwICsgbGVhcEogLSBsZWFwRztcclxuXHJcbiAgICAvLyByZXR1cm4gd2l0aCBneSBhbmQgbWFyY2ggd2hlbiB3ZSBkb24ndCBuZWVkIGxlYXBcclxuICAgIGlmICh3aXRob3V0TGVhcCkge1xyXG4gICAgICByZXR1cm4ge2d5OiBneSwgbWFyY2g6IG1hcmNofTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gRmluZCBob3cgbWFueSB5ZWFycyBoYXZlIHBhc3NlZCBzaW5jZSB0aGUgbGFzdCBsZWFwIHllYXIuXHJcbiAgICBpZiAoanVtcCAtIG4gPCA2KSB7XHJcbiAgICAgIG4gPSBuIC0ganVtcCArIHRoaXMuZGl2KGp1bXAgKyA0LCAzMykgKiAzMztcclxuICAgIH1cclxuICAgIGxlYXAgPSB0aGlzLm1vZCh0aGlzLm1vZChuICsgMSwgMzMpIC0gMSwgNCk7XHJcbiAgICBpZiAobGVhcCA9PT0gLTEpIHtcclxuICAgICAgbGVhcCA9IDQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbGVhcDogbGVhcFxyXG4gICAgICAsIGd5OiBneVxyXG4gICAgICAsIG1hcmNoOiBtYXJjaFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICBDb252ZXJ0cyBhIGRhdGUgb2YgdGhlIEphbGFhbGkgY2FsZW5kYXIgdG8gdGhlIEp1bGlhbiBEYXkgbnVtYmVyLlxyXG5cclxuICAgIEBwYXJhbSBqeSBKYWxhYWxpIHllYXIgKDEgdG8gMzEwMClcclxuICAgIEBwYXJhbSBqbSBKYWxhYWxpIG1vbnRoICgxIHRvIDEyKVxyXG4gICAgQHBhcmFtIGpkIEphbGFhbGkgZGF5ICgxIHRvIDI5LzMxKVxyXG4gICAgQHJldHVybiBKdWxpYW4gRGF5IG51bWJlclxyXG4gICovXHJcbiAgcHVibGljIGoyZChqeSwgam0sIGpkKSB7XHJcbiAgICBjb25zdCByID0gdGhpcy5qYWxDYWwoanksIHRydWUpO1xyXG4gICAgcmV0dXJuIHRoaXMuZzJkKHIuZ3ksIDMsIHIubWFyY2gpICsgKGptIC0gMSkgKiAzMSAtIHRoaXMuZGl2KGptLCA3KSAqIChqbSAtIDcpICsgamQgLSAxO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgIENvbnZlcnRzIHRoZSBKdWxpYW4gRGF5IG51bWJlciB0byBhIGRhdGUgaW4gdGhlIEphbGFhbGkgY2FsZW5kYXIuXHJcblxyXG4gICAgQHBhcmFtIGpkbiBKdWxpYW4gRGF5IG51bWJlclxyXG4gICAgQHJldHVyblxyXG4gICAgICBqeTogSmFsYWFsaSB5ZWFyICgxIHRvIDMxMDApXHJcbiAgICAgIGptOiBKYWxhYWxpIG1vbnRoICgxIHRvIDEyKVxyXG4gICAgICBqZDogSmFsYWFsaSBkYXkgKDEgdG8gMjkvMzEpXHJcbiAgKi9cclxuICBwdWJsaWMgZDJqKGpkbikge1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1jb25zdFxyXG4gICAgbGV0IGd5ID0gdGhpcy5kMmcoamRuKS5neSAvLyBDYWxjdWxhdGUgR3JlZ29yaWFuIHllYXIgKGd5KS5cclxuICAgICAgLCBqeSA9IGd5IC0gNjIxXHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItY29uc3RcclxuICAgICAgLCByID0gdGhpcy5qYWxDYWwoanksIGZhbHNlKVxyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWNvbnN0XHJcbiAgICAgICwgamRuMWYgPSB0aGlzLmcyZChneSwgMywgci5tYXJjaClcclxuICAgICAgLCBqZFxyXG4gICAgICAsIGptXHJcbiAgICAgICwgaztcclxuXHJcbiAgICAvLyBGaW5kIG51bWJlciBvZiBkYXlzIHRoYXQgcGFzc2VkIHNpbmNlIDEgRmFydmFyZGluLlxyXG4gICAgayA9IGpkbiAtIGpkbjFmO1xyXG4gICAgaWYgKGsgPj0gMCkge1xyXG4gICAgICBpZiAoayA8PSAxODUpIHtcclxuICAgICAgICAvLyBUaGUgZmlyc3QgNiBtb250aHMuXHJcbiAgICAgICAgam0gPSAxICsgdGhpcy5kaXYoaywgMzEpO1xyXG4gICAgICAgIGpkID0gdGhpcy5tb2QoaywgMzEpICsgMTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgank6IGp5XHJcbiAgICAgICAgICAsIGptOiBqbVxyXG4gICAgICAgICAgLCBqZDogamRcclxuICAgICAgICB9O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIFRoZSByZW1haW5pbmcgbW9udGhzLlxyXG4gICAgICAgIGsgLT0gMTg2O1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBQcmV2aW91cyBKYWxhYWxpIHllYXIuXHJcbiAgICAgIGp5IC09IDE7XHJcbiAgICAgIGsgKz0gMTc5O1xyXG4gICAgICBpZiAoci5sZWFwID09PSAxKSB7XHJcbiAgICAgICAgayArPSAxO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBqbSA9IDcgKyB0aGlzLmRpdihrLCAzMCk7XHJcbiAgICBqZCA9IHRoaXMubW9kKGssIDMwKSArIDE7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBqeToganlcclxuICAgICAgLCBqbTogam1cclxuICAgICAgLCBqZDogamRcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgQ2FsY3VsYXRlcyB0aGUgSnVsaWFuIERheSBudW1iZXIgZnJvbSBHcmVnb3JpYW4gb3IgSnVsaWFuXHJcbiAgICBjYWxlbmRhciBkYXRlcy4gVGhpcyBpbnRlZ2VyIG51bWJlciBjb3JyZXNwb25kcyB0byB0aGUgbm9vbiBvZlxyXG4gICAgdGhlIGRhdGUgKGkuZS4gMTIgaG91cnMgb2YgVW5pdmVyc2FsIFRpbWUpLlxyXG4gICAgVGhlIHByb2NlZHVyZSB3YXMgdGVzdGVkIHRvIGJlIGdvb2Qgc2luY2UgMSBNYXJjaCwgLTEwMDEwMCAob2YgYm90aFxyXG4gICAgY2FsZW5kYXJzKSB1cCB0byBhIGZldyBtaWxsaW9uIHllYXJzIGludG8gdGhlIGZ1dHVyZS5cclxuXHJcbiAgICBAcGFyYW0gZ3kgQ2FsZW5kYXIgeWVhciAoeWVhcnMgQkMgbnVtYmVyZWQgMCwgLTEsIC0yLCAuLi4pXHJcbiAgICBAcGFyYW0gZ20gQ2FsZW5kYXIgbW9udGggKDEgdG8gMTIpXHJcbiAgICBAcGFyYW0gZ2QgQ2FsZW5kYXIgZGF5IG9mIHRoZSBtb250aCAoMSB0byAyOC8yOS8zMC8zMSlcclxuICAgIEByZXR1cm4gSnVsaWFuIERheSBudW1iZXJcclxuICAqL1xyXG4gIHB1YmxpYyBnMmQoZ3ksIGdtLCBnZCkge1xyXG4gICAgbGV0IGQgPSB0aGlzLmRpdigoZ3kgKyB0aGlzLmRpdihnbSAtIDgsIDYpICsgMTAwMTAwKSAqIDE0NjEsIDQpXHJcbiAgICAgICsgdGhpcy5kaXYoMTUzICogdGhpcy5tb2QoZ20gKyA5LCAxMikgKyAyLCA1KVxyXG4gICAgICArIGdkIC0gMzQ4NDA0MDg7XHJcbiAgICBkID0gZCAtIHRoaXMuZGl2KHRoaXMuZGl2KGd5ICsgMTAwMTAwICsgdGhpcy5kaXYoZ20gLSA4LCA2KSwgMTAwKSAqIDMsIDQpICsgNzUyO1xyXG4gICAgcmV0dXJuIGQ7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgQ2FsY3VsYXRlcyBHcmVnb3JpYW4gYW5kIEp1bGlhbiBjYWxlbmRhciBkYXRlcyBmcm9tIHRoZSBKdWxpYW4gRGF5IG51bWJlclxyXG4gICAgKGpkbikgZm9yIHRoZSBwZXJpb2Qgc2luY2UgamRuPS0zNDgzOTY1NSAoaS5lLiB0aGUgeWVhciAtMTAwMTAwIG9mIGJvdGhcclxuICAgIGNhbGVuZGFycykgdG8gc29tZSBtaWxsaW9ucyB5ZWFycyBhaGVhZCBvZiB0aGUgcHJlc2VudC5cclxuXHJcbiAgICBAcGFyYW0gamRuIEp1bGlhbiBEYXkgbnVtYmVyXHJcbiAgICBAcmV0dXJuXHJcbiAgICAgIGd5OiBDYWxlbmRhciB5ZWFyICh5ZWFycyBCQyBudW1iZXJlZCAwLCAtMSwgLTIsIC4uLilcclxuICAgICAgZ206IENhbGVuZGFyIG1vbnRoICgxIHRvIDEyKVxyXG4gICAgICBnZDogQ2FsZW5kYXIgZGF5IG9mIHRoZSBtb250aCBNICgxIHRvIDI4LzI5LzMwLzMxKVxyXG4gICovXHJcbiAgcHVibGljIGQyZyhqZG4pIHtcclxuICAgIGxldCBqXHJcbiAgICAgICwgaVxyXG4gICAgICAsIGdkXHJcbiAgICAgICwgZ21cclxuICAgICAgLCBneTtcclxuICAgIGogPSA0ICogamRuICsgMTM5MzYxNjMxO1xyXG4gICAgaiA9IGogKyB0aGlzLmRpdih0aGlzLmRpdig0ICogamRuICsgMTgzMTg3NzIwLCAxNDYwOTcpICogMywgNCkgKiA0IC0gMzkwODtcclxuICAgIGkgPSB0aGlzLmRpdih0aGlzLm1vZChqLCAxNDYxKSwgNCkgKiA1ICsgMzA4O1xyXG4gICAgZ2QgPSB0aGlzLmRpdih0aGlzLm1vZChpLCAxNTMpLCA1KSArIDE7XHJcbiAgICBnbSA9IHRoaXMubW9kKHRoaXMuZGl2KGksIDE1MyksIDEyKSArIDE7XHJcbiAgICBneSA9IHRoaXMuZGl2KGosIDE0NjEpIC0gMTAwMTAwICsgdGhpcy5kaXYoOCAtIGdtLCA2KTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGd5OiBneVxyXG4gICAgICAsIGdtOiBnbVxyXG4gICAgICAsIGdkOiBnZFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICBVdGlsaXR5IGhlbHBlciBmdW5jdGlvbnMuXHJcbiAgKi9cclxuICBwdWJsaWMgZGl2KGEsIGIpIHtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1iaXR3aXNlXHJcbiAgICByZXR1cm4gfn4oYSAvIGIpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vZChhLCBiKSB7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYml0d2lzZVxyXG4gICAgcmV0dXJuIGEgLSB+fihhIC8gYikgKiBiO1xyXG4gIH1cclxufVxyXG4iXX0=